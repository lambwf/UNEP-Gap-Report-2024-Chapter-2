## Aggregate emissions
data_countries <- data_edgar %>%
group_by(iso,country,sector_lv2,sector_lv2_order,year) %>%
summarise(value=sum(value,na.rm=T)/1e6) %>%
filter(year>=1990)
## Grassi et al. LULUCF data (https://zenodo.org/records/7190601)
data_countries_luc <- read.xlsx('sources/not public/Grassi_et_al_LULUCF.xlsx')
data_countries_luc <- gather(data_countries_luc,year,value,-country,-iso)
data_countries_luc <- data_countries_luc %>%
mutate(year=as.numeric(year)) %>%
filter(!is.na(year)) %>%
mutate(value=value) %>%
mutate(sector_lv2="Land use change (LULUCF)") %>%
select(iso,sector_lv2,year,value)
data_countries_luc_2 <- read.xlsx('sources/not public/LULUCF NGHGI data for UNEP 2024.xlsx',startRow = 3) %>%
rename(category=LAND.CATEGORY,country=UNFCCC.country,iso=country.code)
data_countries_luc_2 <- gather(data_countries_luc_2,year,value,`2000`:`2023`) %>%
filter(category=="LULUCF net") %>%
mutate(value=value) %>%
mutate(year=as.numeric(year)) %>%
mutate(sector_lv2="Land use change (LULUCF)") %>%
filter(!is.na(year)) %>%
filter(!is.na(iso)) %>%
select(iso,sector_lv2,year,value)
data_countries_luc <- rbind(data_countries_luc %>% filter(year<2000),data_countries_luc_2) %>%
mutate(sector_lv2_order=8)
data_countries <- rbind(data_countries,data_countries_luc)
data_countries <- data_countries %>%
ungroup() %>%
arrange(iso,year) %>%
mutate(country=na.locf(country))
data_countries$sector_lv2 <- as.factor(data_countries$sector_lv2)
data_countries$sector_lv2 <- fct_reorder(data_countries$sector_lv2,data_countries$sector_lv2_order)
data_countries <- data_countries %>%
arrange(iso,country,sector_lv2,year)
##
plot_country <- function(countries,data_countries) {
data_countries <- data_countries %>%
filter(country==countries)
totals <- data_countries %>%
group_by(year) %>%
summarise(value=sum(value,na.rm=T)) %>%
filter(year >= max(data_countries$year)-3)%>%
mutate(check=ifelse(value<0,1,0))
if (sum(totals$check)==4) {totals <- totals %>% mutate(value=abs(value))}
totals <- totals %>%
ungroup() %>%
mutate(change=growth_rate(year,value)$rate) %>%
mutate(change=change*100) %>%
mutate(change=signif(change,2)) %>%
mutate(change=ifelse(change>0,paste0("+",change,"%"),paste0("-",abs(change),"%"))) %>%
mutate(value=signif(value,3)) %>%
filter(year==max(data_countries$year))
plot <- data_countries %>%
ggplot(.,aes(x=year,y=value,fill=sector_lv2)) +
geom_col(color="#252525",linewidth=0.25,width=1) +
annotation_custom(grob = textGrob(paste0("Emissions in 2023: ",totals$value),
x = unit(1.0425, "npc"), y = unit(0.02, "npc"),hjust = 0, vjust = -1,
gp = gpar(col = "#636363", fontsize = 10)),
xmin = -Inf, xmax = Inf, ymin = -Inf, ymax = Inf) +
annotation_custom(grob = textGrob(paste0("Change since ",max(data_countries$year)-3,": ",totals$change),
x = unit(1.0425, "npc"), y = unit(-0.04, "npc"),hjust = 0, vjust = -1,
gp = gpar(col = "#636363", fontsize = 10)),
xmin = -Inf, xmax = Inf, ymin = -Inf, ymax = Inf) +
coord_cartesian(clip = "off") +
theme_wl_bar_trend() +
scale_fill_manual(values=colours_9_sectors) +
#scale_y_continuous(breaks=c(0,20,40,60),limits=c(0,70)) +
scale_x_continuous(breaks=c(1990,2000,2010,2020,max(data_countries$year)),
expand = expansion(mult = c(0.05, 0.01))) +
theme(axis.title = element_blank(),
legend.position = "right") +
labs(title=c,
subtitle=bquote(paste("MtCO"[2], "e/year")),
caption="⌂ UNEP Emissions Gap Report 2024    ⌂ Data: EDGAR v9, Grassi et al. 2024  \n⌂ Note: GWP100 AR6; net land use change (LULUCF) emissions based on inventories")
return(plot)
}
plot_country("United Kingdom",data_countries)
## Filter countries
countries <- data_countries %>%
select(iso,country) %>%
distinct() %>%
left_join(.,data_wdi_pop %>% filter(year==2023) %>% select(-country),by=join_by(iso)) %>%
filter(!is.na(population)) %>%
filter(population>=250000)
countries <- countries$country
countries <- countries[c(1,5,9)]
for (i in 1:length(countries)){
plot <- plot_country(countries[i],data_countries)
ggsave(plot,filename = paste0("UNEP-EGR-2024-",countries[i],"-trend.png"),
path = "results/standard/countries/",device = "png",height = 4,width=8,dpi=300)
ggsave(plot,filename = paste0("UNEP-EGR-2024-",countries[i],"-trend.pdf"),
path = "results/standard/countries/",device = cairo_pdf,height = 4,width=8)
ggsave(plot,filename = paste0("UNEP-EGR-2024-",countries[i],"-trend.svg"),
path = "results/standard/countries/",device = 'svg',height = 4,width=8)
}
## Save data
wb <- createWorkbook()
addWorksheet(wb,"info")
addWorksheet(wb,"data")
info = data.frame(a=c("Author","Contact","Data sources","See also"),
b=c("William F. Lamb",
"william.lamb@pik-potsdam.de",
"EDGARv9 (https://edgar.jrc.ec.europa.eu/report_2024); Grassi et al. 2024 (https://zenodo.org/records/7190601)",
"https://lambwf.github.io/UNEP-Gap-Report-2024-Chapter-2/"))
writeData(wb, sheet = "info",info,colNames = F, rowNames = F)
writeData(wb, sheet = "data",data_countries %>% select(-sector_lv2_order) %>% mutate(units="MtCO2e/year (GWP100 AR6)"),colNames = T, rowNames = F)
saveWorkbook(wb,paste0("results/standard/countries/UNEP-EGR-2024-countries.xlsx"),overwrite=T)
countries <- data_countries %>%
select(iso,country) %>%
distinct() %>%
left_join(.,data_wdi_pop %>% filter(year==2023) %>% select(-country),by=join_by(iso)) %>%
filter(!is.na(population)) %>%
filter(population>=250000)
countries <- countries$country
for (i in 1:length(countries)){
plot <- plot_country(countries[i],data_countries)
ggsave(plot,filename = paste0("UNEP-EGR-2024-",countries[i],"-trend.png"),
path = "results/standard/countries/",device = "png",height = 4,width=8,dpi=300)
ggsave(plot,filename = paste0("UNEP-EGR-2024-",countries[i],"-trend.pdf"),
path = "results/standard/countries/",device = cairo_pdf,height = 4,width=8)
ggsave(plot,filename = paste0("UNEP-EGR-2024-",countries[i],"-trend.svg"),
path = "results/standard/countries/",device = 'svg',height = 4,width=8)
}
plot_country("United Kingdom",data_countries)
rm(c)
plot_country("United Kingdom",data_countries)
plot_country <- function(countries,data_countries) {
data_countries <- data_countries %>%
filter(country==countries)
totals <- data_countries %>%
group_by(year) %>%
summarise(value=sum(value,na.rm=T)) %>%
filter(year >= max(data_countries$year)-3)%>%
mutate(check=ifelse(value<0,1,0))
if (sum(totals$check)==4) {totals <- totals %>% mutate(value=abs(value))}
totals <- totals %>%
ungroup() %>%
mutate(change=growth_rate(year,value)$rate) %>%
mutate(change=change*100) %>%
mutate(change=signif(change,2)) %>%
mutate(change=ifelse(change>0,paste0("+",change,"%"),paste0("-",abs(change),"%"))) %>%
mutate(value=signif(value,3)) %>%
filter(year==max(data_countries$year))
plot <- data_countries %>%
ggplot(.,aes(x=year,y=value,fill=sector_lv2)) +
geom_col(color="#252525",linewidth=0.25,width=1) +
annotation_custom(grob = textGrob(paste0("Emissions in 2023: ",totals$value),
x = unit(1.0425, "npc"), y = unit(0.02, "npc"),hjust = 0, vjust = -1,
gp = gpar(col = "#636363", fontsize = 10)),
xmin = -Inf, xmax = Inf, ymin = -Inf, ymax = Inf) +
annotation_custom(grob = textGrob(paste0("Change since ",max(data_countries$year)-3,": ",totals$change),
x = unit(1.0425, "npc"), y = unit(-0.04, "npc"),hjust = 0, vjust = -1,
gp = gpar(col = "#636363", fontsize = 10)),
xmin = -Inf, xmax = Inf, ymin = -Inf, ymax = Inf) +
coord_cartesian(clip = "off") +
theme_wl_bar_trend() +
scale_fill_manual(values=colours_9_sectors) +
#scale_y_continuous(breaks=c(0,20,40,60),limits=c(0,70)) +
scale_x_continuous(breaks=c(1990,2000,2010,2020,max(data_countries$year)),
expand = expansion(mult = c(0.05, 0.01))) +
theme(axis.title = element_blank(),
legend.position = "right") +
labs(title=countries,
subtitle=bquote(paste("MtCO"[2], "e/year")),
caption="⌂ UNEP Emissions Gap Report 2024    ⌂ Data: EDGAR v9, Grassi et al. 2024  \n⌂ Note: GWP100 AR6; net land use change (LULUCF) emissions based on inventories")
return(plot)
}
plot_country("United Kingdom",data_countries)
countries <- data_countries %>%
select(iso,country) %>%
distinct() %>%
left_join(.,data_wdi_pop %>% filter(year==2023) %>% select(-country),by=join_by(iso)) %>%
filter(!is.na(population)) %>%
filter(population>=250000)
countries <- countries$country
for (i in 1:length(countries)){
plot <- plot_country(countries[i],data_countries)
ggsave(plot,filename = paste0("UNEP-EGR-2024-",countries[i],"-trend.png"),
path = "results/standard/countries/",device = "png",height = 4,width=8,dpi=300)
ggsave(plot,filename = paste0("UNEP-EGR-2024-",countries[i],"-trend.pdf"),
path = "results/standard/countries/",device = cairo_pdf,height = 4,width=8)
ggsave(plot,filename = paste0("UNEP-EGR-2024-",countries[i],"-trend.svg"),
path = "results/standard/countries/",device = 'svg',height = 4,width=8)
}
countries <- data_countries %>%
select(iso,country) %>%
distinct() %>%
left_join(.,read.csv("https://raw.githubusercontent.com/openclimatedata/countrygroups/main/data/g20.csv") %>%
select(iso=Code) %>%
mutate(G20="1"))
View(countries)
countries <- data_countries %>%
select(iso,country) %>%
distinct() %>%
left_join(.,read.csv("https://raw.githubusercontent.com/openclimatedata/countrygroups/main/data/g20.csv") %>%
select(iso=Code) %>%
mutate(G20="1")) %>%
filter(G20==1)
countries <- data_countries %>%
select(iso,country) %>%
distinct() %>%
left_join(.,read.csv("https://raw.githubusercontent.com/openclimatedata/countrygroups/main/data/g20.csv") %>%
select(iso=Code) %>%
mutate(G20="1")) %>%
filter(G20==1)
countries <- countries$country
plot_country <- function(countries,data_countries) {
data_countries <- data_countries %>%
filter(country==countries)
totals <- data_countries %>%
group_by(year) %>%
summarise(value=sum(value,na.rm=T)) %>%
filter(year >= max(data_countries$year)-3) %>%
ungroup() %>%
mutate(change=growth_rate(year,value)$rate) %>%
mutate(change=change*100) %>%
mutate(change=signif(change,2)) %>%
mutate(change=ifelse(change>0,paste0("+",change,"%"),paste0("-",abs(change),"%"))) %>%
mutate(value=signif(value,3)) %>%
filter(year==max(data_countries$year))
plot <- data_countries %>%
ggplot(.,aes(x=year,y=value,fill=sector_lv2)) +
geom_col(color="#252525",linewidth=0.25,width=1) +
annotation_custom(grob = textGrob(paste0("Emissions in 2023: ",totals$value),
x = unit(1.0425, "npc"), y = unit(0.02, "npc"),hjust = 0, vjust = -1,
gp = gpar(col = "#636363", fontsize = 10)),
xmin = -Inf, xmax = Inf, ymin = -Inf, ymax = Inf) +
annotation_custom(grob = textGrob(paste0("Change since ",max(data_countries$year)-3,": ",totals$change),
x = unit(1.0425, "npc"), y = unit(-0.04, "npc"),hjust = 0, vjust = -1,
gp = gpar(col = "#636363", fontsize = 10)),
xmin = -Inf, xmax = Inf, ymin = -Inf, ymax = Inf) +
coord_cartesian(clip = "off") +
theme_wl_bar_trend() +
scale_fill_manual(values=colours_9_sectors) +
#scale_y_continuous(breaks=c(0,20,40,60),limits=c(0,70)) +
scale_x_continuous(breaks=c(1990,2000,2010,2020,max(data_countries$year)),
expand = expansion(mult = c(0.05, 0.01))) +
theme(axis.title = element_blank(),
legend.position = "right") +
labs(title=countries,
subtitle=bquote(paste("MtCO"[2], "e/year")),
caption="⌂ UNEP Emissions Gap Report 2024    ⌂ Data: EDGAR v9, Grassi et al. 2024  \n⌂ Note: GWP100 AR6; net land use change (LULUCF) emissions based on inventories")
return(plot)
}
plot_country("United Kingdom",data_countries)
countries <- data_countries %>%
select(iso,country) %>%
distinct() %>%
left_join(.,read.csv("https://raw.githubusercontent.com/openclimatedata/countrygroups/main/data/g20.csv") %>%
select(iso=Code) %>%
mutate(G20="1")) %>%
filter(G20==1)
countries <- countries$country
for (i in 1:length(countries)){
plot <- plot_country(countries[i],data_countries)
ggsave(plot,filename = paste0("UNEP-EGR-2024-",countries[i],"-trend.png"),
path = "results/standard/countries/",device = "png",height = 4,width=8,dpi=300)
ggsave(plot,filename = paste0("UNEP-EGR-2024-",countries[i],"-trend.pdf"),
path = "results/standard/countries/",device = cairo_pdf,height = 4,width=8)
ggsave(plot,filename = paste0("UNEP-EGR-2024-",countries[i],"-trend.svg"),
path = "results/standard/countries/",device = 'svg',height = 4,width=8)
}
data_countries <- data_edgar %>%
group_by(iso,country,sector_lv2,sector_lv2_order,year) %>%
summarise(value=sum(value,na.rm=T)/1e6) %>%
filter(year>=1990)
## Grassi et al. LULUCF data (https://zenodo.org/records/7190601)
data_countries_luc <- read.xlsx('sources/not public/Grassi_et_al_LULUCF.xlsx')
data_countries_luc <- gather(data_countries_luc,year,value,-country,-iso)
data_countries_luc <- data_countries_luc %>%
mutate(year=as.numeric(year)) %>%
filter(!is.na(year)) %>%
mutate(value=value) %>%
mutate(sector_lv2="Land use change (LULUCF)") %>%
select(iso,sector_lv2,year,value)
data_countries_luc_2 <- read.xlsx('sources/not public/LULUCF NGHGI data for UNEP 2024.xlsx',startRow = 3) %>%
rename(category=LAND.CATEGORY,country=UNFCCC.country,iso=country.code)
data_countries_luc_2 <- gather(data_countries_luc_2,year,value,`2000`:`2023`) %>%
filter(category=="LULUCF net") %>%
mutate(value=value) %>%
mutate(year=as.numeric(year)) %>%
mutate(sector_lv2="Land use change (LULUCF)") %>%
filter(!is.na(year)) %>%
filter(!is.na(iso)) %>%
select(iso,sector_lv2,year,value)
data_countries_luc <- rbind(data_countries_luc %>% filter(year<2000),data_countries_luc_2) %>%
mutate(sector_lv2_order=8)
data_countries <- rbind(data_countries,data_countries_luc)
data_countries <- data_countries %>%
ungroup() %>%
arrange(iso,year) %>%
mutate(country=na.locf(country))
View(data_countries)
data_countries_eu <- data_countries %>%
left_join(.,cc_EU,by="iso") %>%
filter(!is.na(EU)) %>%
mutate(iso="EU27",country="European Union") %>%
group_by(iso,country,sector_lv2,sector_lv2_order,year) %>%
summarise(value=sum(value))
View(data_countries_eu)
## Aggregate emissions
data_countries <- data_edgar %>%
group_by(iso,country,sector_lv2,sector_lv2_order,year) %>%
summarise(value=sum(value,na.rm=T)/1e6) %>%
filter(year>=1990)
## Grassi et al. LULUCF data (https://zenodo.org/records/7190601)
data_countries_luc <- read.xlsx('sources/not public/Grassi_et_al_LULUCF.xlsx')
data_countries_luc <- gather(data_countries_luc,year,value,-country,-iso)
data_countries_luc <- data_countries_luc %>%
mutate(year=as.numeric(year)) %>%
filter(!is.na(year)) %>%
mutate(value=value) %>%
mutate(sector_lv2="Land use change (LULUCF)") %>%
select(iso,sector_lv2,year,value)
data_countries_luc_2 <- read.xlsx('sources/not public/LULUCF NGHGI data for UNEP 2024.xlsx',startRow = 3) %>%
rename(category=LAND.CATEGORY,country=UNFCCC.country,iso=country.code)
data_countries_luc_2 <- gather(data_countries_luc_2,year,value,`2000`:`2023`) %>%
filter(category=="LULUCF net") %>%
mutate(value=value) %>%
mutate(year=as.numeric(year)) %>%
mutate(sector_lv2="Land use change (LULUCF)") %>%
filter(!is.na(year)) %>%
filter(!is.na(iso)) %>%
select(iso,sector_lv2,year,value)
data_countries_luc <- rbind(data_countries_luc %>% filter(year<2000),data_countries_luc_2) %>%
mutate(sector_lv2_order=8)
data_countries <- rbind(data_countries,data_countries_luc)
data_countries <- data_countries %>%
ungroup() %>%
arrange(iso,year) %>%
mutate(country=na.locf(country))
## Add Europe
data_countries_eu <- data_countries %>%
left_join(.,cc_EU,by="iso") %>%
filter(!is.na(EU)) %>%
mutate(iso="EU27",country="European Union") %>%
group_by(iso,country,sector_lv2,sector_lv2_order,year) %>%
summarise(value=sum(value))
data_countries <- rbind(data_countries,data_countries_eu)
data_countries$sector_lv2 <- as.factor(data_countries$sector_lv2)
data_countries$sector_lv2 <- fct_reorder(data_countries$sector_lv2,data_countries$sector_lv2_order)
data_countries <- data_countries %>%
arrange(iso,country,sector_lv2,year)
##
countries <- data_countries %>%
select(iso,country) %>%
distinct() %>%
left_join(.,read.csv("https://raw.githubusercontent.com/openclimatedata/countrygroups/main/data/g20.csv") %>%
select(iso=Code) %>%
mutate(G20="1")) %>%
filter(G20==1)
View(countries)
countries <- c(countries$country,"European Union")
for (i in 1:length(countries)){
plot <- plot_country(countries[i],data_countries)
ggsave(plot,filename = paste0("UNEP-EGR-2024-",countries[i],"-trend.png"),
path = "results/standard/countries/",device = "png",height = 4,width=8,dpi=300)
ggsave(plot,filename = paste0("UNEP-EGR-2024-",countries[i],"-trend.pdf"),
path = "results/standard/countries/",device = cairo_pdf,height = 4,width=8)
ggsave(plot,filename = paste0("UNEP-EGR-2024-",countries[i],"-trend.svg"),
path = "results/standard/countries/",device = 'svg',height = 4,width=8)
}
knitr::opts_chunk$set(echo = FALSE)
options(dplyr.summarise.inform = FALSE)
rm(list = ls())
library(tidyverse)
library(openxlsx)
library(countrycode)
library(ggrepel)
library(patchwork)
library(WDI)
library(grid)
library(zoo)
source("https://raw.githubusercontent.com/lambwf/Codebase/main/figure_style.R")
source("https://raw.githubusercontent.com/lambwf/Codebase/main/growth_rate.R")
load("data/data_edgar.RData")
load("data/data_gcb_luc.RData")
high_emitters <- c("China","United States","India","European Union","Russia","Brazil","World")
cc_EU <- read.csv("https://raw.githubusercontent.com/openclimatedata/countrygroups/main/data/european-union.csv") %>%
select(iso=Code) %>%
mutate(EU="1")
## Get population data from the World Bank
data_wdi_pop <- WDI(country = "all",indicator = "SP.POP.TOTL",start = 1970,end = 2023,extra=TRUE,language = "en") %>%
select(iso3c, country, year, SP.POP.TOTL) %>%
filter(!is.na(iso3c))
data_wdi_pop$population <- data_wdi_pop$SP.POP.TOTL
data_wdi_pop$iso <- data_wdi_pop$iso3c
data_wdi_pop<-data_wdi_pop %>% select(-SP.POP.TOTL,-iso3c)
wb <- createWorkbook()
addWorksheet(wb,"info")
addWorksheet(wb,"data")
info = data.frame(a=c("Author","Contact","Data sources","See also"),
b=c("William F. Lamb",
"william.lamb@pik-potsdam.de",
"EDGARv9 (https://edgar.jrc.ec.europa.eu/report_2024); GCB 2023 (https://globalcarbonbudget.org/carbonbudget2023/)",
"https://lambwf.github.io/UNEP-Gap-Report-2024-Chapter-2/"))
writeData(wb, sheet = "info",info,colNames = F, rowNames = F)
writeData(wb, sheet = "data",data_total %>% mutate(units="GtCO2e/year (GWP100 AR6)"),colNames = T, rowNames = F)
## Aggregate emissions
data_countries <- data_edgar %>%
group_by(iso,country,sector_lv2,sector_lv2_order,year) %>%
summarise(value=sum(value,na.rm=T)/1e6) %>%
filter(year>=1990)
## Grassi et al. LULUCF data (https://zenodo.org/records/7190601)
data_countries_luc <- read.xlsx('sources/not public/Grassi_et_al_LULUCF.xlsx')
data_countries_luc <- gather(data_countries_luc,year,value,-country,-iso)
data_countries_luc <- data_countries_luc %>%
mutate(year=as.numeric(year)) %>%
filter(!is.na(year)) %>%
mutate(value=value) %>%
mutate(sector_lv2="Land use change (LULUCF)") %>%
select(iso,sector_lv2,year,value)
data_countries_luc_2 <- read.xlsx('sources/not public/LULUCF NGHGI data for UNEP 2024.xlsx',startRow = 3) %>%
rename(category=LAND.CATEGORY,country=UNFCCC.country,iso=country.code)
data_countries_luc_2 <- gather(data_countries_luc_2,year,value,`2000`:`2023`) %>%
filter(category=="LULUCF net") %>%
mutate(value=value) %>%
mutate(year=as.numeric(year)) %>%
mutate(sector_lv2="Land use change (LULUCF)") %>%
filter(!is.na(year)) %>%
filter(!is.na(iso)) %>%
select(iso,sector_lv2,year,value)
data_countries_luc <- rbind(data_countries_luc %>% filter(year<2000),data_countries_luc_2) %>%
mutate(sector_lv2_order=8)
data_countries <- rbind(data_countries,data_countries_luc)
data_countries <- data_countries %>%
ungroup() %>%
arrange(iso,year) %>%
mutate(country=na.locf(country))
## Add Europe
data_countries_eu <- data_countries %>%
left_join(.,cc_EU,by="iso") %>%
filter(!is.na(EU)) %>%
mutate(iso="EU27",country="European Union") %>%
group_by(iso,country,sector_lv2,sector_lv2_order,year) %>%
summarise(value=sum(value))
data_countries <- rbind(data_countries,data_countries_eu)
data_countries$sector_lv2 <- as.factor(data_countries$sector_lv2)
data_countries$sector_lv2 <- fct_reorder(data_countries$sector_lv2,data_countries$sector_lv2_order)
data_countries <- data_countries %>%
arrange(iso,country,sector_lv2,year)
##
plot_country <- function(countries,data_countries) {
data_countries <- data_countries %>%
filter(country==countries)
totals <- data_countries %>%
group_by(year) %>%
summarise(value=sum(value,na.rm=T)) %>%
filter(year >= max(data_countries$year)-3) %>%
ungroup() %>%
mutate(change=growth_rate(year,value)$rate) %>%
mutate(change=change*100) %>%
mutate(change=signif(change,2)) %>%
mutate(change=ifelse(change>0,paste0("+",change,"%"),paste0("-",abs(change),"%"))) %>%
mutate(value=signif(value,3)) %>%
filter(year==max(data_countries$year))
plot <- data_countries %>%
ggplot(.,aes(x=year,y=value,fill=sector_lv2)) +
geom_col(color="#252525",linewidth=0.25,width=1) +
annotation_custom(grob = textGrob(paste0("Emissions in 2023: ",totals$value),
x = unit(1.0425, "npc"), y = unit(0.02, "npc"),hjust = 0, vjust = -1,
gp = gpar(col = "#636363", fontsize = 10)),
xmin = -Inf, xmax = Inf, ymin = -Inf, ymax = Inf) +
annotation_custom(grob = textGrob(paste0("Change since ",max(data_countries$year)-3,": ",totals$change),
x = unit(1.0425, "npc"), y = unit(-0.04, "npc"),hjust = 0, vjust = -1,
gp = gpar(col = "#636363", fontsize = 10)),
xmin = -Inf, xmax = Inf, ymin = -Inf, ymax = Inf) +
coord_cartesian(clip = "off") +
theme_wl_bar_trend() +
scale_fill_manual(values=colours_9_sectors) +
#scale_y_continuous(breaks=c(0,20,40,60),limits=c(0,70)) +
scale_x_continuous(breaks=c(1990,2000,2010,2020,max(data_countries$year)),
expand = expansion(mult = c(0.05, 0.01))) +
theme(axis.title = element_blank(),
legend.position = "right") +
labs(title=countries,
subtitle=bquote(paste("MtCO"[2], "e/year")),
caption="⌂ UNEP Emissions Gap Report 2024    ⌂ Data: EDGAR v9, Grassi et al. 2024  \n⌂ Note: GWP100 AR6; net land use change (LULUCF) emissions based on inventories")
return(plot)
}
plot_country("United Kingdom",data_countries)
## Filter to G20 countries
countries <- data_countries %>%
select(iso,country) %>%
distinct() %>%
left_join(.,read.csv("https://raw.githubusercontent.com/openclimatedata/countrygroups/main/data/g20.csv") %>%
select(iso=Code) %>%
mutate(G20="1")) %>%
filter(G20==1)
countries <- c(countries$country,"European Union")
for (i in 1:length(countries)){
plot <- plot_country(countries[i],data_countries)
ggsave(plot,filename = paste0("UNEP-EGR-2024-",countries[i],"-trend.png"),
path = "results/standard/countries/",device = "png",height = 4,width=8,dpi=300)
ggsave(plot,filename = paste0("UNEP-EGR-2024-",countries[i],"-trend.pdf"),
path = "results/standard/countries/",device = cairo_pdf,height = 4,width=8)
ggsave(plot,filename = paste0("UNEP-EGR-2024-",countries[i],"-trend.svg"),
path = "results/standard/countries/",device = 'svg',height = 4,width=8)
}
## Save data
wb <- createWorkbook()
addWorksheet(wb,"info")
addWorksheet(wb,"data")
info = data.frame(a=c("Author","Contact","Data sources","See also"),
b=c("William F. Lamb",
"william.lamb@pik-potsdam.de",
"EDGARv9 (https://edgar.jrc.ec.europa.eu/report_2024); Grassi et al. 2024 (https://zenodo.org/records/7190601)",
"https://lambwf.github.io/UNEP-Gap-Report-2024-Chapter-2/"))
writeData(wb, sheet = "info",info,colNames = F, rowNames = F)
writeData(wb, sheet = "data",data_countries %>% select(-sector_lv2_order) %>% mutate(units="MtCO2e/year (GWP100 AR6)"),colNames = T, rowNames = F)
saveWorkbook(wb,paste0("results/standard/countries/UNEP-EGR-2024-countries.xlsx"),overwrite=T)
