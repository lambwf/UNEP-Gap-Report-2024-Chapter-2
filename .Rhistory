x = unit(0.03, "npc"), y = unit(0.91, "npc"),hjust = 0, vjust = 0,
gp = gpar(col = "#636363", fontsize = 10, lineheight=0.9)),
xmin = -Inf, xmax = Inf, ymin = -Inf, ymax = Inf) +
scale_colour_manual(values=c("G20 (Annex I)" = "#659cccff","G20 (non-Annex I)" = "#17becfff","Non-G20"="#ff9055ff")) +
scale_y_continuous(limits = c(0,100)) +
scale_x_continuous(expand = expansion(mult = c(0, 0.05))) +
theme_wl_empty()
plot <- p1 + p2 + plot_layout(widths=c(5,1.5))
plot
p1 <- data_top_shares %>% ggplot(.,aes(x=year,y=share,fill=group)) +
geom_col(color='#252525',linewidth=0.25,width=1) +
theme_wl_bar_trend() +
scale_fill_manual(values=c("G20 (Annex I)" = "#659cccff","G20 (non-Annex I)" = "#17becfff","Non-G20"="#ff9055ff")) +
scale_x_continuous(breaks=c(1990,2000,2010,max(data_top_shares$year)),
expand = expansion(mult = c(0.05, 0.01))) +
theme(axis.title = element_blank(),
legend.position = "none") +
labs(title="Share of total greenhouse gas emissions",
subtitle=expression("%"),
caption="⌂ UNEP Emissions Gap Report 2024   ⌂ Data: EDGARv9, GCB 2023 \n⌂ Note: GWP100 AR6; net land use change (LULUCF) emissions based on bookkeeping conventions; \nG20 excludes the African Union")
p2 <- labels %>%
ggplot(.,aes(x=1,y=label_position,label=str_wrap(label,21),color=group)) +
geom_text_repel(
hjust=0,
direction = "y",
point.size = NA,
size=3.5,
show.legend = FALSE,
min.segment.length = Inf,
box.padding = 0.2,
force = 0.1,
lineheight=0.9) +
annotation_custom(grob = textGrob("Share in 2022:",
x = unit(0.03, "npc"), y = unit(0.91, "npc"),hjust = 0, vjust = 0,
gp = gpar(col = "#636363", fontsize = 10, lineheight=0.9)),
xmin = -Inf, xmax = Inf, ymin = -Inf, ymax = Inf) +
scale_colour_manual(values=c("G20 (Annex I)" = "#659cccff","G20 (non-Annex I)" = "#17becfff","Non-G20"="#ff9055ff")) +
scale_y_continuous(limits = c(0,100)) +
scale_x_continuous(expand = expansion(mult = c(0, 0.05))) +
theme_wl_empty()
plot <- p1 + p2 + plot_layout(widths=c(5,1.5))
plot
ggsave(plot,filename = "UNEP-EGR-2024-G20-shares.png",path = "results/standard/",device = "png",height = 4,width=8,dpi=300)
ggsave(plot,filename = "UNEP-EGR-2024-G20-shares.pdf",path = "results/standard/",device = cairo_pdf,height = 4,width=8)
ggsave(plot,filename = "UNEP-EGR-2024-G20-shares.svg",path = "results/standard/",device = 'svg',height = 4,width=8)
wb <- createWorkbook()
addWorksheet(wb,"info")
addWorksheet(wb,"data")
info = data.frame(a=c("Author","Contact","Data sources","See also"),
b=c("William F. Lamb",
"william.lamb@pik-potsdam.de",
"EDGARv9 (https://edgar.jrc.ec.europa.eu/report_2024); GCB 2023 (https://globalcarbonbudget.org/carbonbudget2023/)",
"https://lambwf.github.io/UNEP-Gap-Report-2024-Chapter-2/"))
writeData(wb, sheet = "info",info,colNames = F, rowNames = F)
# writeData(wb, sheet = "data",data_top_shares %>% ungroup() %>% select(group,year,value=share) %>%  mutate(units="% of total"),colNames = T, rowNames = F)
writeData(wb, sheet = "data",data_top_shares,colNames = T, rowNames = F)
saveWorkbook(wb,paste0("results/standard/UNEP-EGR-2024-G20-shares.xlsx"),overwrite=T)
## Aggregate emissions data
data_top_shares <- data_edgar %>%
filter(year>=1990) %>%
filter(year<=2022) %>%
group_by(iso,country,year) %>%
summarise(value=sum(value,na.rm=TRUE))
## Join land use change (LULUCF) emissions from GCB
data_top_shares <- data_top_shares %>%
left_join(.,data_gcb_luc %>% select(iso,year,value_luc=value),
by = join_by(iso, year)) %>%
rowwise() %>%
mutate(value = sum(value, value_luc, na.rm = TRUE)) %>%
ungroup() %>%
select(-value_luc)
data_top_shares <- data_top_shares %>%
mutate(value=value/1e9)
## Join EU
data_top_shares_eu <- left_join(data_top_shares,cc_EU,by="iso") %>%
filter(!is.na(EU)) %>%
mutate(iso="EU27") %>%
select(-EU) %>%
mutate(country="European Union") %>%
group_by(iso,country,year) %>%
summarise(value=sum(value,na.rm=T)) %>%
ungroup()
data_top_shares <- left_join(data_top_shares,cc_EU,by="iso") %>%
filter(is.na(EU)) %>%
bind_rows(.,data_top_shares_eu) %>%
select(-EU)
# ## Merge LDCs
#
# data_top_shares_ldcs <- left_join(data_top_shares,cc_LDC,by="iso") %>%
#   filter(!is.na(LDC)) %>%
#   mutate(iso="LDCS") %>%
#   select(-LDC) %>%
#   mutate(country="Least Developed Countries") %>%
#   group_by(iso,country,year) %>%
#   summarise(value=sum(value,na.rm=T)) %>%
#   ungroup()
#
# data_top_shares <- left_join(data_top_shares,cc_LDC,by="iso") %>%
#   filter(is.na(LDC)) %>%
#   bind_rows(.,data_top_shares_ldcs) %>%
#   select(-LDC)
## Get G20 and Annex I
data_top_shares <- data_top_shares %>%
left_join(.,read.csv("https://raw.githubusercontent.com/openclimatedata/countrygroups/main/data/g20.csv") %>%
select(iso=Code) %>%
mutate(G20="1")) %>%
left_join(.,read.csv("https://raw.githubusercontent.com/openclimatedata/countrygroups/main/data/annex-one.csv") %>%
select(iso=Code) %>%
mutate(AnnexI="1")) %>%
mutate(G20=ifelse(iso=="EU27","1",G20)) %>%
mutate(AnnexI=ifelse(iso=="EU27","1",AnnexI))
data_top_shares <- data_top_shares %>%
mutate(group=ifelse(G20=="1" & AnnexI=="1","G20 (Annex I)",NA)) %>%
mutate(group=ifelse(G20=="1" & is.na(AnnexI),"G20 (non-Annex I)",group)) %>%
mutate(group=ifelse(is.na(G20),"Non-G20",group))
knitr::opts_chunk$set(echo = FALSE)
options(dplyr.summarise.inform = FALSE)
rm(list = ls())
library(tidyverse)
library(openxlsx)
library(countrycode)
library(ggrepel)
library(patchwork)
library(WDI)
library(grid)
library(zoo)
source("https://raw.githubusercontent.com/lambwf/Codebase/main/figure_style.R")
source("https://raw.githubusercontent.com/lambwf/Codebase/main/growth_rate.R")
load("data/data_edgar.RData")
load("data/data_gcb_luc.RData")
load("data/data_gcb_co2_ffi.RData")
high_emitters <- c("China","United States","India","European Union","Russia","Brazil","World")
cc_EU <- read.csv("https://raw.githubusercontent.com/openclimatedata/countrygroups/main/data/european-union.csv") %>%
select(iso=Code) %>%
mutate(EU="1")
cc_LDC <- read.csv("https://raw.githubusercontent.com/openclimatedata/countrygroups/refs/heads/main/data/ldc.csv") %>%
select(iso=Code) %>%
mutate(LDC=1)
## Get population data from the World Bank
data_wdi_pop <- WDI(country = "all",indicator = "SP.POP.TOTL",start = 1970,end = 2023,extra=TRUE,language = "en") %>%
select(iso3c, country, year, SP.POP.TOTL) %>%
filter(!is.na(iso3c))
data_wdi_pop$population <- data_wdi_pop$SP.POP.TOTL
data_wdi_pop$iso <- data_wdi_pop$iso3c
data_wdi_pop<-data_wdi_pop %>% select(-SP.POP.TOTL,-iso3c)
## Load GCB land use change CO2 data (bookkeeping models)
source("https://raw.githubusercontent.com/lambwf/Codebase/main/load_gcb_countries_v2023.R")
data_luc_diff <- load_gcb_countries_luc(
readxl::read_xlsx('sources/National_LandUseChange_Carbon_Emissions_2023v1.0.xlsx',range="A8:GT182",sheet=2),
readxl::read_xlsx('sources/National_LandUseChange_Carbon_Emissions_2023v1.0.xlsx',range="A8:GT182",sheet=3),
readxl::read_xlsx('sources/National_LandUseChange_Carbon_Emissions_2023v1.0.xlsx',range="A8:GT182",sheet=4)) %>%
filter(country=="Global") %>%
rename(BLUE=blue,`H&N`=hn,OSCAR=oscar,`Bookkeeping average`=mean) %>%
select(-country,-iso)
## Join Grassi NGHGI land use change CO2 data (inventories)
data_luc_inv <- read.xlsx('sources/not public/LULUCF NGHGI data for UNEP 2024.xlsx',startRow = 3) %>%
rename(category=LAND.CATEGORY,country=UNFCCC.country,iso=country.code)
data_luc_inv <- gather(data_luc_inv,year,Inventories,`2000`:`2023`) %>%
filter(category=="LULUCF net") %>%
filter(country=="World") %>%
mutate(Inventories=Inventories/1000) %>%
select(year,Inventories)
data_luc_diff <- data_luc_diff %>%
left_join(.,data_luc_inv,by=join_by(year)) %>%
gather(.,var,value,-units,-year) %>%
mutate(year=as.numeric(year)) %>%
filter(year>=1990) %>%
select(year,var,value,units) %>%
mutate(units="GtCO2/year")
## Join FAO land use change CO2 data (inventory aligned, 3rd party)
data_fao <- read.csv("sources/FAO_Emissions_Totals_E_All_Data_NOFLAG.csv")
data_fao <- gather(data_fao,year,value,Y1961:Y2050)
data_fao$year <- gsub("Y","",data_fao$year)
data_fao <- data_fao %>%
select(country=Area,sector=Item,sector_code=Item.Code,gas=Element,units=Unit,source=Source,year,value)
data_fao <- data_fao %>%
filter(country=="World") %>%
filter(sector=="LULUCF") %>%
filter(gas=="Emissions (CO2)") %>%
filter(source=="FAO TIER 1") %>%
filter(year>=1990) %>%
filter(year!=2030) %>%
filter(year!=2050) %>%
mutate(year=as.numeric(year)) %>%
mutate(value=value/1e6) %>%
mutate(var="FAO") %>%
mutate(units="GtCO2/year") %>%
select(year,var,value,units)
data_luc_diff <- data_luc_diff %>%
rbind(.,data_fao)
## Get minmax of the bookkeeping data
data_luc_minmax <- data_luc_diff %>%
filter(grepl("H&N",var) | grepl("BLUE",var) | grepl("OSCAR",var)) %>%
group_by(year) %>%
summarise(min=min(value),max=max(value))
## Create sequence in 5 year intervals for plotting dots
year_higlight <- seq(1990, max(data_luc_diff$year), by = 5)
if (!max(data_luc_diff$year) %in% year_higlight) {
year_higlight <- c(year_higlight, max(data_luc_diff$year))
}
labels <- data_luc_diff %>%
filter(year>=max(data_luc_diff$year)-9) %>%
filter(var %in% c("Bookkeeping average","Inventories")) %>%
group_by(var) %>%
summarise(value_end=last(value),value=mean(value)) %>%
mutate(year=paste0(max(data_luc_diff$year)-9,"-",max(data_luc_diff$year))) %>%
group_by(year) %>%
mutate(difference=first(value)-last(value))
data_luc_diff$var <- as.factor(data_luc_diff$var)
data_luc_diff$var <- fct_relevel(data_luc_diff$var,"Inventories","Bookkeeping average","BLUE","H&N","OSCAR","FAO")
p1 <- data_luc_diff %>% ggplot(.,aes(x=year,y=value,colour=var)) +
geom_ribbon(data=data_luc_minmax,inherit.aes = FALSE,aes(x=year,ymin=min,ymax=max),fill="#74a6d4ff",alpha=0.25) +
geom_path(size=1,fill="none") +
geom_hline(yintercept=0,color="#636363",size = 0.25) +
geom_point(data=data_luc_diff %>%
filter(year %in% year_higlight),
shape=21,fill="white") +
theme_wl() +
scale_colour_manual(values=c("#7dd396ff","#3a5e91ff","#74a6d4ff","#74a6d4ff","#74a6d4ff","#4f8455ff")) +
scale_x_continuous(expand = expansion(mult = c(0.05, 0.01))) +
scale_y_continuous(breaks =c(-2,0,2,4,6,8)) +
theme(axis.title = element_blank(),
legend.position = "none") +
labs(title="Differences in net land use change (LULUCF) estimates",
subtitle=bquote(paste("GtCO"[2], "/year")),
caption="⌂ UNEP Emissions Gap Report 2024    ⌂ Data: GCB 2023, FAO 2024, Grassi et al. 2024  \n⌂ Note: bookkeeping and inventory estimates differ due to alternative system boundary definitions, see Grassi et al. 2023 ESSD")
p2 <- data_luc_diff %>%
filter(year==max(data_luc_diff$year)) %>%
mutate(value=ifelse(var=="OSCAR",value+0.4,value)) %>%
ggplot(.) +
geom_segment(aes(x=3.9,xend=3.9,y=labels$value_end[1],yend=labels$value_end[2]),color="#636363",size = 0.25) +
geom_segment(aes(x=3.75,xend=3.9,y=labels$value_end[1],yend=labels$value_end[1]),color="#636363",size = 0.25) +
geom_segment(aes(x=3.75,xend=3.9,y=labels$value_end[2],yend=labels$value_end[2]),color="#636363",size = 0.25) +
annotate("text",x=4,y=sum(labels$value_end),label=str_wrap(paste0("10 year avg. difference: ",signif(labels$difference,2), " Gt"),20),hjust=0,vjust=1,size=3.5,colour="#636363") +
geom_text(aes(x=1,y=value,label=var,colour=var),hjust=0,size=3.5) +
scale_colour_manual(values=c("#7dd396ff","#3a5e91ff","#74a6d4ff","#74a6d4ff","#74a6d4ff","#4f8455ff")) +
scale_y_continuous(limits = layer_scales(p1)$y$range$range) +
scale_x_continuous(expand = expansion(mult = c(0, 0.01)),limits=c(1,6)) +
theme_wl_empty() +
theme(legend.position="none")
plot <- p1 + p2 + plot_layout(widths = c(5,2.9))
plot
ggsave(plot,filename = "UNEP-EGR-2024-total-luc-differences.png",path = "results/standard/",device = "png",height = 4,width=8,dpi=300)
ggsave(plot,filename = "UNEP-EGR-2024-total-luc-differences.pdf",path = "results/standard/",device = cairo_pdf,height = 4,width=8)
ggsave(plot,filename = "UNEP-EGR-2024-total-luc-differences.svg",path = "results/standard/",device = 'svg',height = 4,width=8)
## Save data
wb <- createWorkbook()
addWorksheet(wb,"info")
addWorksheet(wb,"data")
info = data.frame(a=c("Author","Contact","Data sources","See also"),
b=c("William F. Lamb",
"william.lamb@pik-potsdam.de",
"GCB 2023 (https://globalcarbonbudget.org/carbonbudget2023/); Grassi et al. 2024 (https://zenodo.org/records/7190601)",
"https://lambwf.github.io/UNEP-Gap-Report-2024-Chapter-2/"))
writeData(wb, sheet = "info",info,colNames = F, rowNames = F)
writeData(wb, sheet = "data",data_luc_diff,colNames = T, rowNames = F)
saveWorkbook(wb,paste0("results/standard/UNEP-EGR-2024-total-luc-differences.xlsx"),overwrite=T)
View(data_fao)
knitr::opts_chunk$set(echo = FALSE)
options(dplyr.summarise.inform = FALSE)
rm(list = ls())
library(tidyverse)
library(openxlsx)
library(countrycode)
library(ggrepel)
library(patchwork)
library(WDI)
library(grid)
library(zoo)
source("https://raw.githubusercontent.com/lambwf/Codebase/main/figure_style.R")
source("https://raw.githubusercontent.com/lambwf/Codebase/main/growth_rate.R")
load("data/data_edgar.RData")
load("data/data_gcb_luc.RData")
load("data/data_gcb_co2_ffi.RData")
high_emitters <- c("China","United States","India","European Union","Russia","Brazil","World")
cc_EU <- read.csv("https://raw.githubusercontent.com/openclimatedata/countrygroups/main/data/european-union.csv") %>%
select(iso=Code) %>%
mutate(EU="1")
cc_LDC <- read.csv("https://raw.githubusercontent.com/openclimatedata/countrygroups/refs/heads/main/data/ldc.csv") %>%
select(iso=Code) %>%
mutate(LDC=1)
## Get population data from the World Bank
data_wdi_pop <- WDI(country = "all",indicator = "SP.POP.TOTL",start = 1970,end = 2023,extra=TRUE,language = "en") %>%
select(iso3c, country, year, SP.POP.TOTL) %>%
filter(!is.na(iso3c))
data_wdi_pop$population <- data_wdi_pop$SP.POP.TOTL
data_wdi_pop$iso <- data_wdi_pop$iso3c
data_wdi_pop<-data_wdi_pop %>% select(-SP.POP.TOTL,-iso3c)
source("https://raw.githubusercontent.com/lambwf/Codebase/main/load_gcb_countries_v2023.R")
data_luc_diff <- load_gcb_countries_luc(
readxl::read_xlsx('sources/National_LandUseChange_Carbon_Emissions_2023v1.0.xlsx',range="A8:GT182",sheet=2),
readxl::read_xlsx('sources/National_LandUseChange_Carbon_Emissions_2023v1.0.xlsx',range="A8:GT182",sheet=3),
readxl::read_xlsx('sources/National_LandUseChange_Carbon_Emissions_2023v1.0.xlsx',range="A8:GT182",sheet=4)) %>%
filter(country=="Global") %>%
rename(BLUE=blue,`H&N`=hn,OSCAR=oscar,`Bookkeeping average`=mean) %>%
select(-country,-iso)
data_luc_inv <- read.xlsx('sources/not public/LULUCF NGHGI data for UNEP 2024.xlsx',startRow = 3) %>%
rename(category=LAND.CATEGORY,country=UNFCCC.country,iso=country.code)
data_luc_inv <- gather(data_luc_inv,year,value,`2000`:`2023`) %>%
filter(category=="LULUCF net") %>%
filter(country=="World") %>%
mutate(value=value/1000) %>%
select(year,`Grassi NGHGI (inventories)`=value)
data_luc_diff <- data_luc_diff %>%
left_join(.,data_luc_inv,by=join_by(year)) %>%
gather(.,var,value,-units,-year) %>%
mutate(year=as.numeric(year)) %>%
filter(year>=1990) %>%
select(year,var,value,units) %>%
mutate(units="GtCO2/year")
data_fao <- read.csv("sources/FAO_Emissions_Totals_E_All_Data_NOFLAG.csv")
data_fao <- read.csv("sources/FAO_Emissions_Totals_E_All_Data_NOFLAG.csv")
data_fao <- gather(data_fao,year,value,Y1961:Y2050)
data_fao$year <- gsub("Y","",data_fao$year)
data_fao <- data_fao %>%
select(country=Area,sector=Item,sector_code=Item.Code,gas=Element,units=Unit,source=Source,year,value)
data_fao <- data_fao %>%
filter(country=="World") %>%
filter(sector=="LULUCF") %>%
filter(gas=="Emissions (CO2)") %>%
filter(source=="FAO TIER 1") %>%
filter(year>=1990) %>%
filter(year!=2030) %>%
filter(year!=2050) %>%
mutate(year=as.numeric(year)) %>%
mutate(value=value/1e6) %>%
mutate(var="FAO") %>%
mutate(units="GtCO2/year") %>%
select(year,var,value,units)
data_luc_diff <- data_luc_diff %>%
rbind(.,data_fao)
data_luc_minmax <- data_luc_diff %>%
filter(grepl("H&N",var) | grepl("BLUE",var) | grepl("OSCAR",var)) %>%
group_by(year) %>%
summarise(min=min(value),max=max(value))
year_higlight <- seq(1990, max(data_luc_diff$year), by = 5)
if (!max(data_luc_diff$year) %in% year_higlight) {
year_higlight <- c(year_higlight, max(data_luc_diff$year))
}
labels <- data_luc_diff %>%
filter(year>=max(data_luc_diff$year)-9) %>%
filter(var %in% c("Bookkeeping average","Grassi NGHGI (inventories)")) %>%
group_by(var) %>%
summarise(value_end=last(value),value=mean(value)) %>%
mutate(year=paste0(max(data_luc_diff$year)-9,"-",max(data_luc_diff$year))) %>%
group_by(year) %>%
mutate(difference=first(value)-last(value))
data_luc_diff$var <- as.factor(data_luc_diff$var)
data_luc_diff$var <- fct_relevel(data_luc_diff$var,"Grassi NGHGI (inventories)","Bookkeeping average","BLUE","H&N","OSCAR","FAO")
p1 <- data_luc_diff %>% ggplot(.,aes(x=year,y=value,colour=var)) +
geom_ribbon(data=data_luc_minmax,inherit.aes = FALSE,aes(x=year,ymin=min,ymax=max),fill="#74a6d4ff",alpha=0.25) +
geom_path(size=1,fill="none") +
geom_hline(yintercept=0,color="#636363",size = 0.25) +
geom_point(data=data_luc_diff %>%
filter(year %in% year_higlight),
shape=21,fill="white") +
theme_wl() +
scale_colour_manual(values=c("#7dd396ff","#3a5e91ff","#74a6d4ff","#74a6d4ff","#74a6d4ff","#4f8455ff")) +
scale_x_continuous(expand = expansion(mult = c(0.05, 0.01))) +
scale_y_continuous(breaks =c(-2,0,2,4,6,8)) +
theme(axis.title = element_blank(),
legend.position = "none") +
labs(title="Differences in net land use change (LULUCF) estimates",
subtitle=bquote(paste("GtCO"[2], "/year")),
caption="⌂ UNEP Emissions Gap Report 2024    ⌂ Data: GCB 2023, FAO 2024, Grassi et al. 2024  \n⌂ Note: bookkeeping and inventory estimates differ due to alternative system boundary definitions, see Grassi et al. 2023 ESSD")
p2 <- data_luc_diff %>%
filter(year==max(data_luc_diff$year)) %>%
mutate(value=ifelse(var=="OSCAR",value+0.4,value)) %>%
ggplot(.) +
geom_segment(aes(x=3.9,xend=3.9,y=labels$value_end[1],yend=labels$value_end[2]),color="#636363",size = 0.25) +
geom_segment(aes(x=3.75,xend=3.9,y=labels$value_end[1],yend=labels$value_end[1]),color="#636363",size = 0.25) +
geom_segment(aes(x=3.75,xend=3.9,y=labels$value_end[2],yend=labels$value_end[2]),color="#636363",size = 0.25) +
annotate("text",x=4,y=sum(labels$value_end),label=str_wrap(paste0("10 year avg. difference: ",signif(labels$difference,2), " Gt"),20),hjust=0,vjust=1,size=3.5,colour="#636363") +
geom_text(aes(x=1,y=value,label=var,colour=var),hjust=0,size=3.5) +
scale_colour_manual(values=c("#7dd396ff","#3a5e91ff","#74a6d4ff","#74a6d4ff","#74a6d4ff","#4f8455ff")) +
scale_y_continuous(limits = layer_scales(p1)$y$range$range) +
scale_x_continuous(expand = expansion(mult = c(0, 0.01)),limits=c(1,6)) +
theme_wl_empty() +
theme(legend.position="none")
plot <- p1 + p2 + plot_layout(widths = c(5,2.9))
plot
p2 <- data_luc_diff %>%
filter(year==max(data_luc_diff$year)) %>%
mutate(value=ifelse(var=="OSCAR",value+0.4,value)) %>%
ggplot(.) +
geom_segment(aes(x=3.9,xend=3.9,y=labels$value_end[1],yend=labels$value_end[2]),color="#636363",size = 0.25) +
geom_segment(aes(x=3.75,xend=3.9,y=labels$value_end[1],yend=labels$value_end[1]),color="#636363",size = 0.25) +
geom_segment(aes(x=3.75,xend=3.9,y=labels$value_end[2],yend=labels$value_end[2]),color="#636363",size = 0.25) +
annotate("text",x=4,y=sum(labels$value_end),label=str_wrap(paste0("10 year avg. difference: ",signif(labels$difference,2), " Gt"),20),hjust=0,vjust=1,size=3.5,colour="#636363") +
geom_text(aes(x=1,y=value,label=str_wrap(var,20),colour=var),hjust=0,size=3.5) +
scale_colour_manual(values=c("#7dd396ff","#3a5e91ff","#74a6d4ff","#74a6d4ff","#74a6d4ff","#4f8455ff")) +
scale_y_continuous(limits = layer_scales(p1)$y$range$range) +
scale_x_continuous(expand = expansion(mult = c(0, 0.01)),limits=c(1,6)) +
theme_wl_empty() +
theme(legend.position="none")
plot <- p1 + p2 + plot_layout(widths = c(5,2.9))
plot
plot
## Load GCB land use change CO2 data (bookkeeping models)
source("https://raw.githubusercontent.com/lambwf/Codebase/main/load_gcb_countries_v2023.R")
data_luc_diff <- load_gcb_countries_luc(
readxl::read_xlsx('sources/National_LandUseChange_Carbon_Emissions_2023v1.0.xlsx',range="A8:GT182",sheet=2),
readxl::read_xlsx('sources/National_LandUseChange_Carbon_Emissions_2023v1.0.xlsx',range="A8:GT182",sheet=3),
readxl::read_xlsx('sources/National_LandUseChange_Carbon_Emissions_2023v1.0.xlsx',range="A8:GT182",sheet=4)) %>%
filter(country=="Global") %>%
rename(BLUE=blue,`H&N`=hn,OSCAR=oscar,`Bookkeeping average`=mean) %>%
select(-country,-iso)
## Join Grassi NGHGI land use change CO2 data (inventories)
data_luc_inv <- read.xlsx('sources/not public/LULUCF NGHGI data for UNEP 2024.xlsx',startRow = 3) %>%
rename(category=LAND.CATEGORY,country=UNFCCC.country,iso=country.code)
data_luc_inv <- gather(data_luc_inv,year,value,`2000`:`2023`) %>%
filter(category=="LULUCF net") %>%
filter(country=="World") %>%
mutate(value=value/1000) %>%
select(year,`Grassi NGHGI (inventories)`=value)
data_luc_diff <- data_luc_diff %>%
left_join(.,data_luc_inv,by=join_by(year)) %>%
gather(.,var,value,-units,-year) %>%
mutate(year=as.numeric(year)) %>%
filter(year>=1990) %>%
select(year,var,value,units) %>%
mutate(units="GtCO2/year")
## Join FAO land use change CO2 data (inventory aligned, 3rd party)
data_fao <- read.csv("sources/FAO_Emissions_Totals_E_All_Data_NOFLAG.csv")
data_fao <- gather(data_fao,year,value,Y1961:Y2050)
data_fao$year <- gsub("Y","",data_fao$year)
data_fao <- data_fao %>%
select(country=Area,sector=Item,sector_code=Item.Code,gas=Element,units=Unit,source=Source,year,value)
data_fao <- data_fao %>%
filter(country=="World") %>%
filter(sector=="LULUCF") %>%
filter(gas=="Emissions (CO2)") %>%
filter(source=="FAO TIER 1") %>%
filter(year>=1990) %>%
filter(year!=2030) %>%
filter(year!=2050) %>%
mutate(year=as.numeric(year)) %>%
mutate(value=value/1e6) %>%
mutate(var="FAOSTAT") %>%
mutate(units="GtCO2/year") %>%
select(year,var,value,units)
data_luc_diff <- data_luc_diff %>%
rbind(.,data_fao)
## Get minmax of the bookkeeping data
data_luc_minmax <- data_luc_diff %>%
filter(grepl("H&N",var) | grepl("BLUE",var) | grepl("OSCAR",var)) %>%
group_by(year) %>%
summarise(min=min(value),max=max(value))
## Create sequence in 5 year intervals for plotting dots
year_higlight <- seq(1990, max(data_luc_diff$year), by = 5)
if (!max(data_luc_diff$year) %in% year_higlight) {
year_higlight <- c(year_higlight, max(data_luc_diff$year))
}
labels <- data_luc_diff %>%
filter(year>=max(data_luc_diff$year)-9) %>%
filter(var %in% c("Bookkeeping average","Grassi NGHGI (inventories)")) %>%
group_by(var) %>%
summarise(value_end=last(value),value=mean(value)) %>%
mutate(year=paste0(max(data_luc_diff$year)-9,"-",max(data_luc_diff$year))) %>%
group_by(year) %>%
mutate(difference=first(value)-last(value))
data_luc_diff$var <- as.factor(data_luc_diff$var)
data_luc_diff$var <- fct_relevel(data_luc_diff$var,"Grassi NGHGI (inventories)","Bookkeeping average","BLUE","H&N","OSCAR","FAOSTAT")
p1 <- data_luc_diff %>% ggplot(.,aes(x=year,y=value,colour=var)) +
geom_ribbon(data=data_luc_minmax,inherit.aes = FALSE,aes(x=year,ymin=min,ymax=max),fill="#74a6d4ff",alpha=0.25) +
geom_path(size=1,fill="none") +
geom_hline(yintercept=0,color="#636363",size = 0.25) +
geom_point(data=data_luc_diff %>%
filter(year %in% year_higlight),
shape=21,fill="white") +
theme_wl() +
scale_colour_manual(values=c("#7dd396ff","#3a5e91ff","#74a6d4ff","#74a6d4ff","#74a6d4ff","#4f8455ff")) +
scale_x_continuous(expand = expansion(mult = c(0.05, 0.01))) +
scale_y_continuous(breaks =c(-2,0,2,4,6,8)) +
theme(axis.title = element_blank(),
legend.position = "none") +
labs(title="Differences in net land use change (LULUCF) estimates",
subtitle=bquote(paste("GtCO"[2], "/year")),
caption="⌂ UNEP Emissions Gap Report 2024    ⌂ Data: GCB 2023, FAO 2024, Grassi et al. 2024  \n⌂ Note: bookkeeping and inventory estimates differ due to alternative system boundary definitions, see Grassi et al. 2023 ESSD")
p2 <- data_luc_diff %>%
filter(year==max(data_luc_diff$year)) %>%
mutate(value=ifelse(var=="OSCAR",value+0.4,value)) %>%
ggplot(.) +
geom_segment(aes(x=3.9,xend=3.9,y=labels$value_end[1],yend=labels$value_end[2]),color="#636363",size = 0.25) +
geom_segment(aes(x=3.75,xend=3.9,y=labels$value_end[1],yend=labels$value_end[1]),color="#636363",size = 0.25) +
geom_segment(aes(x=3.75,xend=3.9,y=labels$value_end[2],yend=labels$value_end[2]),color="#636363",size = 0.25) +
annotate("text",x=4,y=sum(labels$value_end),label=str_wrap(paste0("10 year avg. difference: ",signif(labels$difference,2), " Gt"),20),hjust=0,vjust=1,size=3.5,colour="#636363") +
geom_text(aes(x=1,y=value,label=str_wrap(var,20),colour=var),hjust=0,size=3.5) +
scale_colour_manual(values=c("#7dd396ff","#3a5e91ff","#74a6d4ff","#74a6d4ff","#74a6d4ff","#4f8455ff")) +
scale_y_continuous(limits = layer_scales(p1)$y$range$range) +
scale_x_continuous(expand = expansion(mult = c(0, 0.01)),limits=c(1,6)) +
theme_wl_empty() +
theme(legend.position="none")
plot <- p1 + p2 + plot_layout(widths = c(5,2.9))
plot
ggsave(plot,filename = "UNEP-EGR-2024-total-luc-differences.png",path = "results/standard/",device = "png",height = 4,width=8,dpi=300)
ggsave(plot,filename = "UNEP-EGR-2024-total-luc-differences.pdf",path = "results/standard/",device = cairo_pdf,height = 4,width=8)
ggsave(plot,filename = "UNEP-EGR-2024-total-luc-differences.svg",path = "results/standard/",device = 'svg',height = 4,width=8)
## Save data
wb <- createWorkbook()
addWorksheet(wb,"info")
addWorksheet(wb,"data")
info = data.frame(a=c("Author","Contact","Data sources","See also"),
b=c("William F. Lamb",
"william.lamb@pik-potsdam.de",
"GCB 2023 (https://globalcarbonbudget.org/carbonbudget2023/); Grassi et al. 2024 (https://zenodo.org/records/7190601)",
"https://lambwf.github.io/UNEP-Gap-Report-2024-Chapter-2/"))
writeData(wb, sheet = "info",info,colNames = F, rowNames = F)
writeData(wb, sheet = "data",data_luc_diff,colNames = T, rowNames = F)
saveWorkbook(wb,paste0("results/standard/UNEP-EGR-2024-total-luc-differences.xlsx"),overwrite=T)
gwps_ar6 <- read.csv("https://raw.githubusercontent.com/chrisroadmap/ar6/main/data_output/7sm/metrics_supplement_cleaned.csv")
View(gwps_ar6)
