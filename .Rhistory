aes(x=x,y=y),
color="black",size=1)} +
geom_image(aes(x=2.375+ifelse(sector_lv2=="AFOLU: LULUCF",str_length(sector_lv2)+3,str_length(sector_lv2))/26,image=sector_lv2_icons),by = "height",size=0.06)+
geom_text(hjust=0,aes(x=2.2,label=sector_lv2),color='#636363',vjust=0.5) +
{if(is_crf) geom_text(data=data.frame(label="Inventory (excl. LULUCF)"),
inherit.aes=FALSE,
aes(x=2.2,y=0,label=label),
color='#636363',vjust=0.5,hjust=0)} +
theme_wl() +
scale_fill_manual(values = rev(labels_colours$sector_lv2_colours)) +
scale_x_continuous(limits=c(1.8,3.5),expand = c(0,0)) +
scale_y_continuous(limits=c(-0.5,9.5),expand = c(0,0)) +
theme(axis.title = element_blank(),
panel.border = element_blank(),
legend.position="none",
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks = element_blank(),
panel.grid.major = element_blank(),
plot.title.position = "plot",
plot.title = element_text(size=11,colour='#bdbdbd',hjust=1,face = "plain"),
plot.background = element_blank(),
plot.margin = unit(c(0,0,0,0),"cm"))
p <-  wrap_elements(p1 + p2 + plot_layout(widths=c(7,1))) +
wrap_elements(plot_spacer() / p3 / plot_spacer() + plot_layout(heights=c(2,10,ifelse(is_crf=="T",1,0.5)))) +
plot_layout(widths=c(6,3.8))
p
p1 <- data_countries %>%
ggplot(aes(x=year,y=value,fill=sector_lv2)) +
geom_area(color="#636363") +
{if(is_crf) geom_path(data=data_countries_crfs,
inherit.aes=FALSE,
aes(x=year,y=value,group=iso),
size=1)} +
theme_wl() +
scale_fill_manual(values = labels_colours$sector_lv2_colours,limits = levels(labels_colours$sector_lv2)) +
theme(axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.grid.major.x = element_blank(),
legend.position = "none",
panel.background = element_blank(),
panel.spacing = unit(0.5,"cm"),
panel.border = element_blank(),
axis.line.x=element_line(colour='#636363'),
axis.line.y=element_line(colour='#636363')) +
labs(title=data_countries$country,
subtitle=bquote("GHG Emissions (Mt" ~CO[2]* "e/year)"),
caption=str_wrap(paste0(indicator_text,"\nSources: EDGAR v9, Grassi et al. 2021, UNFCCC, GCB 2023")),50)
p2 <- data_countries %>%
filter(year==2023) %>%
ggplot(aes(x=as.factor(year),y=value,fill=sector_lv2)) +
geom_col(color="#636363") +
theme_wl() +
ylim(layer_scales(p1)$y$range$range) +
scale_fill_manual(values = labels_colours$sector_lv2_colours,
limits = levels(labels_colours$sector_lv2)) +
theme(axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.ticks.y = element_blank(),
axis.text.y = element_blank(),
panel.grid.major.x = element_blank(),
legend.position = "none",
panel.background = element_blank(),
panel.spacing = unit(0.5,"cm"),
panel.border = element_blank(),
axis.line.x=element_line(colour='#636363'),
plot.background = element_blank())
labels_colours <- labels_colours %>%
arrange(sector_lv2_order)
p3 <- labels_colours %>%
arrange(sector_lv2_order) %>%
ggplot(.,aes(y=rev(sector_lv2_order))) +
geom_text(aes(x=1.9,label=label)) +
geom_point(aes(x=2.1,fill=as.factor(rev(sector_lv2_order))),
shape=22,size=4,color='#636363') +
{if(is_crf) geom_line(data=data.frame(x=c(2.05,2.15),y=c(0,0)),
inherit.aes=FALSE,
aes(x=x,y=y),
color="black",size=1)} +
geom_image(aes(x=2.375+ifelse(sector_lv2=="AFOLU: LULUCF",str_length(sector_lv2)+3,str_length(sector_lv2))/26,image=sector_lv2_icons),by = "height",size=0.06)+
geom_text(hjust=0,aes(x=2.2,label=sector_lv2),color='#636363',vjust=0.5) +
{if(is_crf) geom_text(data=data.frame(label="Inventory (excl. LULUCF)"),
inherit.aes=FALSE,
aes(x=2.2,y=0,label=label),
color='#636363',vjust=0.5,hjust=0)} +
theme_wl() +
scale_fill_manual(values = rev(labels_colours$sector_lv2_colours)) +
scale_x_continuous(limits=c(1.8,3.5),expand = c(0,0)) +
scale_y_continuous(limits=c(-0.5,9.5),expand = c(0,0)) +
theme(axis.title = element_blank(),
panel.border = element_blank(),
legend.position="none",
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks = element_blank(),
panel.grid.major = element_blank(),
plot.title.position = "plot",
plot.title = element_text(size=11,colour='#bdbdbd',hjust=1,face = "plain"),
plot.background = element_blank(),
plot.margin = unit(c(0,0,0,0),"cm"))
p <-  wrap_elements(p1 + p2 + plot_layout(widths=c(7,1))) +
wrap_elements(plot_spacer() / p3 / plot_spacer() + plot_layout(heights=c(2,10,ifelse(is_crf=="T",1,0.5)))) +
plot_layout(widths=c(6,3.8))
p
p1 <- data_countries %>%
ggplot(aes(x=year,y=value,fill=sector_lv2)) +
geom_area(color="#636363") +
{if(is_crf) geom_path(data=data_countries_crfs,
inherit.aes=FALSE,
aes(x=year,y=value,group=iso),
size=1)} +
theme_wl() +
scale_fill_manual(values = labels_colours$sector_lv2_colours,limits = levels(labels_colours$sector_lv2)) +
theme(axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.grid.major.x = element_blank(),
legend.position = "none",
panel.background = element_blank(),
panel.spacing = unit(0.5,"cm"),
panel.border = element_blank(),
axis.line.x=element_line(colour='#636363'),
axis.line.y=element_line(colour='#636363')) +
labs(title=data_countries$country,
subtitle=bquote("GHG Emissions (Mt" ~CO[2]* "e/year)"),
caption=str_wrap(paste0(indicator_text,"\nSources: EDGAR v9, Grassi et al. 2021, UNFCCC, GCB 2023")),90)
p <-  wrap_elements(p1 + p2 + plot_layout(widths=c(7,1))) +
wrap_elements(plot_spacer() / p3 / plot_spacer() + plot_layout(heights=c(2,10,ifelse(is_crf=="T",1,0.5)))) +
plot_layout(widths=c(6,3.8))
p
p1 <- data_countries %>%
ggplot(aes(x=year,y=value,fill=sector_lv2)) +
geom_area(color="#636363") +
{if(is_crf) geom_path(data=data_countries_crfs,
inherit.aes=FALSE,
aes(x=year,y=value,group=iso),
size=1)} +
theme_wl() +
scale_fill_manual(values = labels_colours$sector_lv2_colours,limits = levels(labels_colours$sector_lv2)) +
theme(axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.grid.major.x = element_blank(),
legend.position = "none",
panel.background = element_blank(),
panel.spacing = unit(0.5,"cm"),
panel.border = element_blank(),
axis.line.x=element_line(colour='#636363'),
axis.line.y=element_line(colour='#636363')) +
labs(title=data_countries$country,
subtitle=bquote("GHG Emissions (Mt" ~CO[2]* "e/year)"))
p <-  wrap_elements(p1 + p2 + plot_layout(widths=c(7,1))) +
wrap_elements(plot_spacer() / p3 / plot_spacer() + plot_layout(heights=c(2,10,ifelse(is_crf=="T",1,0.5)))) +
plot_layout(widths=c(6,3.8))
p + labs(caption=paste0(indicator_text,"\nSources: EDGAR v9, Grassi et al. 2021, UNFCCC, GCB 2023"))
wrap_elements(p) + labs(caption=paste0(indicator_text,"\nSources: EDGAR v9, Grassi et al. 2021, UNFCCC, GCB 2023"))
p <-  wrap_elements(p1 + p2 + plot_layout(widths=c(7,1))) +
wrap_elements(plot_spacer() / p3 / plot_spacer() + plot_layout(heights=c(2,10,ifelse(is_crf=="T",1,0.5)))) +
plot_layout(widths=c(6,3.8))
p4 <- ggplot(indicator_text,aes(x=1,y=1,label=V1)) +
geom_text()
p4 <- ggplot(data.frame(label=indicator_text),aes(x=1,y=1,label=V1)) +
geom_text()
p <-  wrap_elements(p1 + p2 + plot_layout(widths=c(7,1))) +
wrap_elements(plot_spacer() / p3 / plot_spacer() + plot_layout(heights=c(2,10,ifelse(is_crf=="T",1,0.5)))) +
plot_layout(widths=c(6,3.8))
p / p4
p4 <- ggplot(data.frame(label=indicator_text),aes(x=1,y=1,label=label)) +
geom_text()
p <-  wrap_elements(p1 + p2 + plot_layout(widths=c(7,1))) +
wrap_elements(plot_spacer() / p3 / plot_spacer() + plot_layout(heights=c(2,10,ifelse(is_crf=="T",1,0.5)))) +
plot_layout(widths=c(6,3.8))
p / p4
p <-  wrap_elements(p1 + p2 + plot_layout(widths=c(7,1))) +
wrap_elements(plot_spacer() / p3 / plot_spacer() + plot_layout(heights=c(2,10,ifelse(is_crf=="T",1,0.5)))) +
plot_layout(widths=c(6,3.8))
p / plot_spacer() + labs(caption=indicator_text)
p + plot_annotation(caption=indicator_text)
p + plot_annotation(caption=str_wrap(indicator_text,100))
p1 <- data_countries %>%
ggplot(aes(x=year,y=value,fill=sector_lv2)) +
geom_area(color="#636363") +
{if(is_crf) geom_path(data=data_countries_crfs,
inherit.aes=FALSE,
aes(x=year,y=value,group=iso),
size=1)} +
theme_wl() +
scale_fill_manual(values = labels_colours$sector_lv2_colours,limits = levels(labels_colours$sector_lv2)) +
theme(axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.grid.major.x = element_blank(),
legend.position = "none",
panel.background = element_blank(),
panel.spacing = unit(0.5,"cm"),
panel.border = element_blank(),
axis.line.x=element_line(colour='#636363'),
axis.line.y=element_line(colour='#636363')) +
labs(title=data_countries$country,
subtitle=bquote("GHG Emissions (Mt" ~CO[2]* "e/year)"),
caption=str_wrap(indicator_text,100))
p2 <- data_countries %>%
filter(year==2023) %>%
ggplot(aes(x=as.factor(year),y=value,fill=sector_lv2)) +
geom_col(color="#636363") +
theme_wl() +
ylim(layer_scales(p1)$y$range$range) +
scale_fill_manual(values = labels_colours$sector_lv2_colours,
limits = levels(labels_colours$sector_lv2)) +
theme(axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.ticks.y = element_blank(),
axis.text.y = element_blank(),
panel.grid.major.x = element_blank(),
legend.position = "none",
panel.background = element_blank(),
panel.spacing = unit(0.5,"cm"),
panel.border = element_blank(),
axis.line.x=element_line(colour='#636363'),
plot.background = element_blank())
labels_colours <- labels_colours %>%
arrange(sector_lv2_order)
p3 <- labels_colours %>%
arrange(sector_lv2_order) %>%
ggplot(.,aes(y=rev(sector_lv2_order))) +
geom_text(aes(x=1.9,label=label)) +
geom_point(aes(x=2.1,fill=as.factor(rev(sector_lv2_order))),
shape=22,size=4,color='#636363') +
{if(is_crf) geom_line(data=data.frame(x=c(2.05,2.15),y=c(0,0)),
inherit.aes=FALSE,
aes(x=x,y=y),
color="black",size=1)} +
geom_image(aes(x=2.375+ifelse(sector_lv2=="AFOLU: LULUCF",str_length(sector_lv2)+3,str_length(sector_lv2))/26,image=sector_lv2_icons),by = "height",size=0.06)+
geom_text(hjust=0,aes(x=2.2,label=sector_lv2),color='#636363',vjust=0.5) +
{if(is_crf) geom_text(data=data.frame(label="Inventory (excl. LULUCF)"),
inherit.aes=FALSE,
aes(x=2.2,y=0,label=label),
color='#636363',vjust=0.5,hjust=0)} +
theme_wl() +
scale_fill_manual(values = rev(labels_colours$sector_lv2_colours)) +
scale_x_continuous(limits=c(1.8,3.5),expand = c(0,0)) +
scale_y_continuous(limits=c(-0.5,9.5),expand = c(0,0)) +
theme(axis.title = element_blank(),
panel.border = element_blank(),
legend.position="none",
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks = element_blank(),
panel.grid.major = element_blank(),
plot.title.position = "plot",
plot.title = element_text(size=11,colour='#bdbdbd',hjust=1,face = "plain"),
plot.background = element_blank(),
plot.margin = unit(c(0,0,0,0),"cm"))
p <-  wrap_elements(p1 + p2 + plot_layout(widths=c(7,1))) +
wrap_elements(plot_spacer() / p3 / plot_spacer() + plot_layout(heights=c(2,10,ifelse(is_crf=="T",1,0.5)))) +
plot_layout(widths=c(6,3.8))
p
p <-  wrap_elements(p1 + p2 + plot_layout(widths=c(7,1))) +
wrap_elements(plot_spacer() / p3 / plot_spacer() + plot_layout(heights=c(2,10,ifelse(is_crf=="T",1,0.5)))) +
plot_layout(widths=c(6,3.8)) + plot_annotation(theme = theme(plot_background=element_blank()))
p
p <-  wrap_elements(p1 + p2 + plot_layout(widths=c(7,1))) +
wrap_elements(plot_spacer() / p3 / plot_spacer() + plot_layout(heights=c(2,10,ifelse(is_crf=="T",1,0.5)))) +
plot_layout(widths=c(6,3.8)) + plot_annotation(theme = theme(plot.background=element_blank()))
p
p <-  wrap_elements(p1 + p2 + plot_layout(widths=c(7,1))) +
wrap_elements(plot_spacer() / p3 / plot_spacer() + plot_layout(heights=c(2,10,ifelse(is_crf=="T",1,0.5)))) +
plot_layout(widths=c(6,3.8)) & plot_annotation(theme = theme(plot.background=element_blank()))
p
p <-  wrap_elements(p1 + p2 + plot_layout(widths=c(7,1))) +
wrap_elements(plot_spacer() / p3 / plot_spacer() + plot_layout(heights=c(2,10,ifelse(is_crf=="T",1,0.5))) & theme(plot.backgroun=element_blank())) +
plot_layout(widths=c(6,3.8)) & plot_annotation(theme = theme(plot.background=element_blank()))
p
p <-  wrap_elements(p1 + p2 + plot_layout(widths=c(7,1))) +
wrap_elements(plot_spacer() / p3 / plot_spacer() + plot_layout(heights=c(2,10,ifelse(is_crf=="T",1,0.5))) & theme(plot.backgroun=element_blank())) +
plot_layout(widths=c(6,3.8))
p
p1 <- data_countries %>%
ggplot(aes(x=year,y=value,fill=sector_lv2)) +
geom_area(color="#636363") +
{if(is_crf) geom_path(data=data_countries_crfs,
inherit.aes=FALSE,
aes(x=year,y=value,group=iso),
size=1)} +
theme_wl() +
scale_fill_manual(values = labels_colours$sector_lv2_colours,limits = levels(labels_colours$sector_lv2)) +
theme(axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.grid.major.x = element_blank(),
legend.position = "none",
panel.background = element_blank(),
panel.spacing = unit(0.5,"cm"),
panel.border = element_blank(),
axis.line.x=element_line(colour='#636363'),
axis.line.y=element_line(colour='#636363')) +
labs(title=data_countries$country,
subtitle=bquote("GHG Emissions (Mt" ~CO[2]* "e/year)"),
caption=str_wrap(indicator_text,150))
p <-  wrap_elements(p1 + p2 + plot_layout(widths=c(7,1))) +
wrap_elements(plot_spacer() / p3 / plot_spacer() + plot_layout(heights=c(2,10,ifelse(is_crf=="T",1,0.5))) & theme(plot.backgroun=element_blank())) +
plot_layout(widths=c(6,3.8))
p
p1 <- data_countries %>%
ggplot(aes(x=year,y=value,fill=sector_lv2)) +
geom_area(color="#636363") +
{if(is_crf) geom_path(data=data_countries_crfs,
inherit.aes=FALSE,
aes(x=year,y=value,group=iso),
size=1)} +
theme_wl() +
scale_fill_manual(values = labels_colours$sector_lv2_colours,limits = levels(labels_colours$sector_lv2)) +
theme(axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.grid.major.x = element_blank(),
legend.position = "none",
panel.background = element_blank(),
panel.spacing = unit(0.5,"cm"),
panel.border = element_blank(),
axis.line.x=element_line(colour='#636363'),
axis.line.y=element_line(colour='#636363')) +
labs(title=data_countries$country,
subtitle=bquote("GHG Emissions (Mt" ~CO[2]* "e/year)"),
caption=str_wrap(indicator_text,125))
p <-  wrap_elements(p1 + p2 + plot_layout(widths=c(7,1))) +
wrap_elements(plot_spacer() / p3 / plot_spacer() + plot_layout(heights=c(2,10,ifelse(is_crf=="T",1,0.5))) & theme(plot.backgroun=element_blank())) +
plot_layout(widths=c(6,3.8))
p
p1 <- data_countries %>%
ggplot(aes(x=year,y=value,fill=sector_lv2)) +
geom_area(color="#636363") +
{if(is_crf) geom_path(data=data_countries_crfs,
inherit.aes=FALSE,
aes(x=year,y=value,group=iso),
size=1)} +
theme_wl() +
scale_fill_manual(values = labels_colours$sector_lv2_colours,limits = levels(labels_colours$sector_lv2)) +
theme(axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.grid.major.x = element_blank(),
legend.position = "none",
panel.background = element_blank(),
panel.spacing = unit(0.5,"cm"),
panel.border = element_blank(),
axis.line.x=element_line(colour='#636363'),
axis.line.y=element_line(colour='#636363')) +
labs(title=data_countries$country,
subtitle=bquote("GHG Emissions (Mt" ~CO[2]* "e/year)"),
caption=str_wrap(paste0(indicator_text,"\nSources: asd"),125))
p <-  wrap_elements(p1 + p2 + plot_layout(widths=c(7,1))) +
wrap_elements(plot_spacer() / p3 / plot_spacer() + plot_layout(heights=c(2,10,ifelse(is_crf=="T",1,0.5))) & theme(plot.backgroun=element_blank())) +
plot_layout(widths=c(6,3.8))
p
p1 <- data_countries %>%
ggplot(aes(x=year,y=value,fill=sector_lv2)) +
geom_area(color="#636363") +
{if(is_crf) geom_path(data=data_countries_crfs,
inherit.aes=FALSE,
aes(x=year,y=value,group=iso),
size=1)} +
theme_wl() +
scale_fill_manual(values = labels_colours$sector_lv2_colours,limits = levels(labels_colours$sector_lv2)) +
theme(axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.grid.major.x = element_blank(),
legend.position = "none",
panel.background = element_blank(),
panel.spacing = unit(0.5,"cm"),
panel.border = element_blank(),
axis.line.x=element_line(colour='#636363'),
axis.line.y=element_line(colour='#636363')) +
labs(title=data_countries$country,
subtitle=bquote("GHG Emissions (Mt" ~CO[2]* "e/year)"),
caption=str_wrap(paste0(indicator_text,"\nSources: EDGAR v9, GCB 2023, UNFCCC, Grassi et al. 2021"),125))
p <-  wrap_elements(p1 + p2 + plot_layout(widths=c(7,1))) +
wrap_elements(plot_spacer() / p3 / plot_spacer() + plot_layout(heights=c(2,10,ifelse(is_crf=="T",1,0.5))) & theme(plot.backgroun=element_blank())) +
plot_layout(widths=c(6,3.8))
p
plot_country <- function(country_iso,data_ghg,data_crfs,data_indicators) {
data_countries <- data_ghg %>%
filter(iso==country_iso) %>%
filter(year>=1990) %>%
group_by(iso,country,sector_lv2,sector_lv2_colours,sector_lv2_order,sector_lv2_icons,year) %>%
summarise(value=sum(value,na.rm=TRUE)/1e6)
### join LULUCF data if EU country (as these are not in Grassi's dataset)
if (sum(grepl(country_iso,cc_EU$iso))==1) {
data_crf_lulucf <- data_crfs %>%
filter(year>=1990) %>%
filter(iso==country_iso) %>%
filter(gas=="CO2 LULUCF") %>%
mutate(value=value/1e6) %>%
select(iso,country,year,value) %>%
mutate(sector_lv2="AFOLU: LULUCF") %>%
mutate(sector_lv2_colours="#a6d854") %>%
mutate(sector_lv2_order=8) %>%
mutate(sector_lv2_icons="C:/Users/lamw/ownCloud/Projects/UNEP Gap Report 2024/sources/icons/Land use.png")
data_countries <- rbind(data_countries,data_crf_lulucf)
data_countries$sector_lv2 <- fct_reorder(data_countries$sector_lv2,data_countries$sector_lv2_order)
}
data_countries$sector_lv2 <- fct_relevel(data_countries$sector_lv2,"AFOLU: LULUCF")
labels_colours <- data_ghg %>%
filter(iso=="CHN") %>%
group_by(iso,country,sector_lv2,sector_lv2_colours,sector_lv2_order,sector_lv2_icons,year) %>%
summarise(value=sum(value,na.rm=TRUE)/1e6)
labels_colours$sector_lv2 <- fct_relevel(labels_colours$sector_lv2,"AFOLU: LULUCF")
labels_colours <- labels_colours %>%
ungroup() %>%
filter(year==2021) %>%
arrange((sector_lv2)) %>%
mutate(position=1) %>%
mutate(position=cumsum(position)) %>%
select(-value)
labels_colours <- left_join(labels_colours,data_countries %>%
ungroup() %>%
filter(year==2023) %>%
select(sector_lv2,value),by="sector_lv2")
labels_colours <- labels_colours %>%
mutate(total=sum(data_countries$value[data_countries$year==2023])) %>%
mutate(share=value/total) %>%
mutate(share=round(share*100)) %>%
mutate(label=paste0(share,"% "))
labels_colours$label <- gsub("NA%"," - ",labels_colours$label)
data_countries_crfs=data_crfs %>%
filter(year>=1990) %>%
filter(iso==country_iso) %>%
filter(gas!="CO2 LULUCF") %>%
group_by(iso,country,year) %>%
summarise(value=sum(value,na.rm=T)/1e6)
is_crf <- ifelse(!is.na(data_countries_crfs$iso[1]),"T","F")
indicator_text <- data_indicators %>% filter(iso==country_iso)
#bquote("GHG Emissions (Mt" ~CO[2]* "e/year)"),
indicator_text = paste0(data_countries$country[1]," released an estimated ",indicator_text$ghg_total[1]," MtCO2e in 2023, a change of ",indicator_text$change_rel[1]," % compared to the previous year. Per capita GHG emissions were ",indicator_text$ghg_per_capita[1], " tCO2e in 2023, while cumulative historic CO2 emissions were ",indicator_text$co2_historic[1]," GtCO2, representing ",indicator_text$co2_historic_fraction[1], "% of global emissions to date.")
p1 <- data_countries %>%
ggplot(aes(x=year,y=value,fill=sector_lv2)) +
geom_area(color="#636363") +
{if(is_crf) geom_path(data=data_countries_crfs,
inherit.aes=FALSE,
aes(x=year,y=value,group=iso),
size=1)} +
theme_wl() +
scale_fill_manual(values = labels_colours$sector_lv2_colours,limits = levels(labels_colours$sector_lv2)) +
theme(axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.grid.major.x = element_blank(),
legend.position = "none",
panel.background = element_blank(),
panel.spacing = unit(0.5,"cm"),
panel.border = element_blank(),
axis.line.x=element_line(colour='#636363'),
axis.line.y=element_line(colour='#636363')) +
labs(title=data_countries$country,
subtitle=bquote("GHG Emissions (Mt" ~CO[2]* "e/year)"),
caption=str_wrap(paste0(indicator_text,"\nSources: EDGAR v9, GCB 2023, UNFCCC, Grassi et al. 2021"),125))
p2 <- data_countries %>%
filter(year==2023) %>%
ggplot(aes(x=as.factor(year),y=value,fill=sector_lv2)) +
geom_col(color="#636363") +
theme_wl() +
ylim(layer_scales(p1)$y$range$range) +
scale_fill_manual(values = labels_colours$sector_lv2_colours,
limits = levels(labels_colours$sector_lv2)) +
theme(axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.ticks.y = element_blank(),
axis.text.y = element_blank(),
panel.grid.major.x = element_blank(),
legend.position = "none",
panel.background = element_blank(),
panel.spacing = unit(0.5,"cm"),
panel.border = element_blank(),
axis.line.x=element_line(colour='#636363'),
plot.background = element_blank())
labels_colours <- labels_colours %>%
arrange(sector_lv2_order)
p3 <- labels_colours %>%
arrange(sector_lv2_order) %>%
ggplot(.,aes(y=rev(sector_lv2_order))) +
geom_text(aes(x=1.9,label=label)) +
geom_point(aes(x=2.1,fill=as.factor(rev(sector_lv2_order))),
shape=22,size=4,color='#636363') +
{if(is_crf) geom_line(data=data.frame(x=c(2.05,2.15),y=c(0,0)),
inherit.aes=FALSE,
aes(x=x,y=y),
color="black",size=1)} +
geom_image(aes(x=2.375+ifelse(sector_lv2=="AFOLU: LULUCF",str_length(sector_lv2)+3,str_length(sector_lv2))/26,image=sector_lv2_icons),by = "height",size=0.06)+
geom_text(hjust=0,aes(x=2.2,label=sector_lv2),color='#636363',vjust=0.5) +
{if(is_crf) geom_text(data=data.frame(label="Inventory (excl. LULUCF)"),
inherit.aes=FALSE,
aes(x=2.2,y=0,label=label),
color='#636363',vjust=0.5,hjust=0)} +
theme_wl() +
scale_fill_manual(values = rev(labels_colours$sector_lv2_colours)) +
scale_x_continuous(limits=c(1.8,3.5),expand = c(0,0)) +
scale_y_continuous(limits=c(-0.5,9.5),expand = c(0,0)) +
theme(axis.title = element_blank(),
panel.border = element_blank(),
legend.position="none",
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks = element_blank(),
panel.grid.major = element_blank(),
plot.title.position = "plot",
plot.title = element_text(size=11,colour='#bdbdbd',hjust=1,face = "plain"),
plot.background = element_blank(),
plot.margin = unit(c(0,0,0,0),"cm"))
p <-  wrap_elements(p1 + p2 + plot_layout(widths=c(7,1))) +
wrap_elements(plot_spacer() / p3 / plot_spacer() + plot_layout(heights=c(2,10,ifelse(is_crf=="T",1,0.5))) & theme(plot.backgroun=element_blank())) +
plot_layout(widths=c(6,3.8))
p
return(p)
}
plot_country("BRA",data_ghg,data_crfs)
plot_country("BRA",data_ghg,data_crfs,data_indicators)
plot_country("DEU",data_ghg,data_crfs,data_indicators)
plot_country("DEU",data_ghg,data_crfs,data_indicators)
plot_country("AIA",data_ghg,data_crfs,data_indicators)
