data_edgar_fgas <- data_edgar_fgas %>%
select(iso=Country_code_A3,country=Name,code=ipcc_code_2006_for_standard_report,code_description=ipcc_code_2006_for_standard_report_name,gas=Substance,fossil_bio,year,value)
data_edgar <- rbind(data_edgar_co2_ffi,data_edgar_ch4)
data_edgar <- rbind(data_edgar,data_edgar_n2o)
data_edgar <- rbind(data_edgar,data_edgar_fgas)
## join GWPs and calculate CO2e
gwps <- read.csv("https://raw.githubusercontent.com/openclimatedata/globalwarmingpotentials/main/globalwarmingpotentials.csv",skip = 9)
data_edgar$gas <- gsub("-","",data_edgar$gas)
data_edgar <- left_join(data_edgar,gwps %>% select(gas=Species,AR6GWP100)) %>%
mutate(AR6GWP100=ifelse(gas=="CO2",1,AR6GWP100))
# check all gwps joined
check <- data_edgar %>% filter(is.na(AR6GWP100))
check <- data_edgar %>% select(gas,AR6GWP100) %>% distinct()
data_edgar <- data_edgar %>%
mutate(value_gwp=value*AR6GWP100)
# list_fgases <- data.frame(gas=unique(data_edgar$gas))
# list_fgases <- list_fgases %>%
#   mutate(group=ifelse(grepl("CFC",gas),"ODS F-gases",NA)) %>%
#   mutate(group=ifelse(grepl("HCFC",gas),"ODS F-gases",group)) %>%
#   mutate(group=ifelse(grepl("HFC",gas),"UNFCCC F-gases",group)) %>%
#   mutate(group=ifelse(grepl("Halon",gas),"ODS F-gases",group)) %>%
#   mutate(group=ifelse(grepl("NF3",gas),"UNFCCC F-gases",group)) %>%
#   mutate(group=ifelse(grepl("SF6",gas),"UNFCCC F-gases",group)) #%>%
#   mutate(group=ifelse(is.na(group),"UNFCCC F-gases",group))
list_fgases <- data_edgar %>%
select(gas) %>%
distinct() %>%
mutate(group=ifelse(gas=="CO2","CO2",NA)) %>%
mutate(group=ifelse(gas=="CH4","CH4",group)) %>%
mutate(group=ifelse(gas=="N2O","N2O",group)) %>%
mutate(group=ifelse(is.na(group),"Fgases",group))
data_edgar <- left_join(data_edgar,list_fgases,by="gas")
data_edgar <- data_edgar %>%
mutate(gas=group) %>%
group_by(iso,country,code,code_description,gas,year) %>%
summarise(value=sum(value_gwp,na.rm=TRUE))
# check global totals
check <- data_edgar %>% filter(year==2022) %>% group_by(gas) %>% summarise(value=sum(value,na.rm=T))
### aggregate sectors
write.xlsx(data_edgar %>% ungroup() %>% select(code,code_description) %>% distinct() %>% arrange(code),"cc_sectors.xlsx")
data_edgar <- left_join(data_edgar,read.xlsx("sources/cc_sectors.xlsx"))
data_edgar$gas <- as.factor(data_edgar$gas)
data_edgar$gas <- fct_relevel(data_edgar$gas,"CO2","CH4","N2O","Fgases")
data_edgar$sector <- as.factor(data_edgar$sector)
data_edgar$sector <- fct_reorder(data_edgar$sector,data_edgar$sector_order)
data_edgar <- data_edgar %>%
mutate(year=as.numeric(year)) %>%
group_by(iso,country,sector,sector_codes,subsector,gas,year) %>%
summarise(value=sum(value,na.rm=TRUE))
knitr::opts_chunk$set(echo = FALSE)
rm(list = ls())
library(tidyverse)
library(openxlsx)
library(countrycode)
library(ggrepel)
library(patchwork)
library(zoo)
library(RColorBrewer)
library(WDI)
library(labelled)
source("https://raw.githubusercontent.com/lambwf/Codebase/main/figure_style.R")
source("https://raw.githubusercontent.com/lambwf/Codebase/main/reshape_with_labels.R")
source("https://raw.githubusercontent.com/lambwf/Codebase/main/locate_shares.R")
source("https://raw.githubusercontent.com/lambwf/Codebase/main/load_gcb_countries.R")
## load EDGAR data (https://edgar.jrc.ec.europa.eu/dataset_ghg80)
data_edgar_co2_ffi <- read.xlsx("sources/IEA_EDGAR_CO2_1970_2022.xlsx",sheet=2,startRow = 10)
data_edgar_co2_ffi <- gather(data_edgar_co2_ffi,year,value,Y_1970:Y_2022)
data_edgar_co2_ffi$year <- gsub("Y_","",data_edgar_co2_ffi$year)
data_edgar_co2_ffi <- data_edgar_co2_ffi %>%
select(iso=Country_code_A3,country=Name,code=ipcc_code_2006_for_standard_report,code_description=ipcc_code_2006_for_standard_report_name,gas=Substance,fossil_bio,year,value)
data_edgar_ch4 <- read.xlsx("sources/EDGAR_CH4_1970_2022.xlsx",sheet=2,startRow = 10)
data_edgar_ch4 <- gather(data_edgar_ch4,year,value,Y_1970:Y_2022)
data_edgar_ch4$year <- gsub("Y_","",data_edgar_ch4$year)
data_edgar_ch4 <- data_edgar_ch4 %>%
select(iso=Country_code_A3,country=Name,code=ipcc_code_2006_for_standard_report,code_description=ipcc_code_2006_for_standard_report_name,gas=Substance,fossil_bio,year,value)
data_edgar_n2o <- read.xlsx("sources/EDGAR_N2O_1970_2022.xlsx",sheet=2,startRow = 10)
data_edgar_n2o <- gather(data_edgar_n2o,year,value,Y_1970:Y_2022)
data_edgar_n2o$year <- gsub("Y_","",data_edgar_n2o$year)
data_edgar_n2o <- data_edgar_n2o %>%
select(iso=Country_code_A3,country=Name,code=ipcc_code_2006_for_standard_report,code_description=ipcc_code_2006_for_standard_report_name,gas=Substance,fossil_bio,year,value)
data_edgar_fgas <- read.xlsx("sources/EDGAR_F-gases_1990_2022.xlsx",sheet=2,startRow = 10)
data_edgar_fgas <- gather(data_edgar_fgas,year,value,Y_1990:Y_2022)
data_edgar_fgas$year <- gsub("Y_","",data_edgar_fgas$year)
data_edgar_fgas <- data_edgar_fgas %>%
select(iso=Country_code_A3,country=Name,code=ipcc_code_2006_for_standard_report,code_description=ipcc_code_2006_for_standard_report_name,gas=Substance,fossil_bio,year,value)
data_edgar <- rbind(data_edgar_co2_ffi,data_edgar_ch4)
data_edgar <- rbind(data_edgar,data_edgar_n2o)
data_edgar <- rbind(data_edgar,data_edgar_fgas)
## join GWPs and calculate CO2e
gwps <- read.csv("https://raw.githubusercontent.com/openclimatedata/globalwarmingpotentials/main/globalwarmingpotentials.csv",skip = 9)
data_edgar$gas <- gsub("-","",data_edgar$gas)
data_edgar <- left_join(data_edgar,gwps %>% select(gas=Species,AR6GWP100)) %>%
mutate(AR6GWP100=ifelse(gas=="CO2",1,AR6GWP100))
# check all gwps joined
check <- data_edgar %>% filter(is.na(AR6GWP100))
check <- data_edgar %>% select(gas,AR6GWP100) %>% distinct()
data_edgar <- data_edgar %>%
mutate(value_gwp=value*AR6GWP100)
# list_fgases <- data.frame(gas=unique(data_edgar$gas))
# list_fgases <- list_fgases %>%
#   mutate(group=ifelse(grepl("CFC",gas),"ODS F-gases",NA)) %>%
#   mutate(group=ifelse(grepl("HCFC",gas),"ODS F-gases",group)) %>%
#   mutate(group=ifelse(grepl("HFC",gas),"UNFCCC F-gases",group)) %>%
#   mutate(group=ifelse(grepl("Halon",gas),"ODS F-gases",group)) %>%
#   mutate(group=ifelse(grepl("NF3",gas),"UNFCCC F-gases",group)) %>%
#   mutate(group=ifelse(grepl("SF6",gas),"UNFCCC F-gases",group)) #%>%
#   mutate(group=ifelse(is.na(group),"UNFCCC F-gases",group))
list_fgases <- data_edgar %>%
select(gas) %>%
distinct() %>%
mutate(group=ifelse(gas=="CO2","CO2",NA)) %>%
mutate(group=ifelse(gas=="CH4","CH4",group)) %>%
mutate(group=ifelse(gas=="N2O","N2O",group)) %>%
mutate(group=ifelse(is.na(group),"Fgases",group))
data_edgar <- left_join(data_edgar,list_fgases,by="gas")
data_edgar <- data_edgar %>%
mutate(gas=group) %>%
group_by(iso,country,code,code_description,gas,year) %>%
summarise(value=sum(value_gwp,na.rm=TRUE))
# check global totals
check <- data_edgar %>% filter(year==2022) %>% group_by(gas) %>% summarise(value=sum(value,na.rm=T))
### aggregate sectors
write.xlsx(data_edgar %>% ungroup() %>% select(code,code_description) %>% distinct() %>% arrange(code),"cc_sectors.xlsx")
data_edgar <- left_join(data_edgar,read.xlsx("sources/cc_sectors.xlsx"))
data_edgar$gas <- as.factor(data_edgar$gas)
data_edgar$gas <- fct_relevel(data_edgar$gas,"CO2","CH4","N2O","Fgases")
data_edgar$sector <- as.factor(data_edgar$sector)
data_edgar$sector <- fct_reorder(data_edgar$sector,data_edgar$sector_order)
data_edgar <- data_edgar %>%
mutate(year=as.numeric(year)) %>%
group_by(iso,country,sector,sector_codes,subsector,gas,year) %>%
summarise(value=sum(value,na.rm=TRUE))
data_wdi_pop<-WDI(country = "all",indicator = "SP.POP.TOTL",start = 1970,end = 2022,extra=TRUE,language = "en")%>%
select(iso3c, country, year, SP.POP.TOTL) %>%
filter(!is.na(iso3c))
data_wdi_pop$population <- data_wdi_pop$SP.POP.TOTL
data_wdi_pop$iso <- data_wdi_pop$iso3c
data_wdi_pop<-data_wdi_pop %>% select(-SP.POP.TOTL,-iso3c)
## Global Carbon Project CO2 FFI (https://globalcarbonbudget.org/carbonbudget2023/)
data_gcb_co2_ffi <- load_gcb_countries_ffi(read.xlsx("sources/National_Fossil_Carbon_Emissions_2023v1.0.xlsx",sheet=2,startRow = 12))
## Global Carbon Project CO2 LUC (https://globalcarbonbudget.org/carbonbudget2023/)
data_gcb_luc <- load_gcb_countries_luc(
readxl::read_xlsx('Sources/National_LandUseChange_Carbon_Emissions_2023v1.0.xlsx',range="A8:HK181",sheet=2),
readxl::read_xlsx('Sources/National_LandUseChange_Carbon_Emissions_2023v1.0.xlsx',range="A8:HK181",sheet=3),
readxl::read_xlsx('Sources/National_LandUseChange_Carbon_Emissions_2023v1.0.xlsx',range="A8:HK181",sheet=4)
)
View(data_gcb_luc)
View(load_gcb_countries_luc)
knitr::opts_chunk$set(echo = FALSE)
rm(list = ls())
library(tidyverse)
library(openxlsx)
library(countrycode)
library(ggrepel)
library(patchwork)
library(zoo)
library(RColorBrewer)
library(WDI)
library(labelled)
source("https://raw.githubusercontent.com/lambwf/Codebase/main/figure_style.R")
source("https://raw.githubusercontent.com/lambwf/Codebase/main/reshape_with_labels.R")
source("https://raw.githubusercontent.com/lambwf/Codebase/main/locate_shares.R")
source("https://raw.githubusercontent.com/lambwf/Codebase/main/load_gcb_countries.R")
View(load_gcb_countries_luc)
knitr::opts_chunk$set(echo = FALSE)
rm(list = ls())
library(tidyverse)
library(openxlsx)
library(countrycode)
library(ggrepel)
library(patchwork)
library(zoo)
library(RColorBrewer)
library(WDI)
library(labelled)
source("https://raw.githubusercontent.com/lambwf/Codebase/main/figure_style.R")
source("https://raw.githubusercontent.com/lambwf/Codebase/main/reshape_with_labels.R")
source("https://raw.githubusercontent.com/lambwf/Codebase/main/locate_shares.R")
source("https://raw.githubusercontent.com/lambwf/Codebase/main/load_gcb_countries_v2023.R")
## load EDGAR data (https://edgar.jrc.ec.europa.eu/dataset_ghg80)
data_edgar_co2_ffi <- read.xlsx("sources/IEA_EDGAR_CO2_1970_2022.xlsx",sheet=2,startRow = 10)
data_edgar_co2_ffi <- gather(data_edgar_co2_ffi,year,value,Y_1970:Y_2022)
data_edgar_co2_ffi$year <- gsub("Y_","",data_edgar_co2_ffi$year)
data_edgar_co2_ffi <- data_edgar_co2_ffi %>%
select(iso=Country_code_A3,country=Name,code=ipcc_code_2006_for_standard_report,code_description=ipcc_code_2006_for_standard_report_name,gas=Substance,fossil_bio,year,value)
data_edgar_ch4 <- read.xlsx("sources/EDGAR_CH4_1970_2022.xlsx",sheet=2,startRow = 10)
data_edgar_ch4 <- gather(data_edgar_ch4,year,value,Y_1970:Y_2022)
data_edgar_ch4$year <- gsub("Y_","",data_edgar_ch4$year)
data_edgar_ch4 <- data_edgar_ch4 %>%
select(iso=Country_code_A3,country=Name,code=ipcc_code_2006_for_standard_report,code_description=ipcc_code_2006_for_standard_report_name,gas=Substance,fossil_bio,year,value)
data_edgar_n2o <- read.xlsx("sources/EDGAR_N2O_1970_2022.xlsx",sheet=2,startRow = 10)
data_edgar_n2o <- gather(data_edgar_n2o,year,value,Y_1970:Y_2022)
data_edgar_n2o$year <- gsub("Y_","",data_edgar_n2o$year)
data_edgar_n2o <- data_edgar_n2o %>%
select(iso=Country_code_A3,country=Name,code=ipcc_code_2006_for_standard_report,code_description=ipcc_code_2006_for_standard_report_name,gas=Substance,fossil_bio,year,value)
data_edgar_fgas <- read.xlsx("sources/EDGAR_F-gases_1990_2022.xlsx",sheet=2,startRow = 10)
data_edgar_fgas <- gather(data_edgar_fgas,year,value,Y_1990:Y_2022)
data_edgar_fgas$year <- gsub("Y_","",data_edgar_fgas$year)
data_edgar_fgas <- data_edgar_fgas %>%
select(iso=Country_code_A3,country=Name,code=ipcc_code_2006_for_standard_report,code_description=ipcc_code_2006_for_standard_report_name,gas=Substance,fossil_bio,year,value)
data_edgar <- rbind(data_edgar_co2_ffi,data_edgar_ch4)
data_edgar <- rbind(data_edgar,data_edgar_n2o)
data_edgar <- rbind(data_edgar,data_edgar_fgas)
## join GWPs and calculate CO2e
gwps <- read.csv("https://raw.githubusercontent.com/openclimatedata/globalwarmingpotentials/main/globalwarmingpotentials.csv",skip = 9)
data_edgar$gas <- gsub("-","",data_edgar$gas)
data_edgar <- left_join(data_edgar,gwps %>% select(gas=Species,AR6GWP100)) %>%
mutate(AR6GWP100=ifelse(gas=="CO2",1,AR6GWP100))
# check all gwps joined
check <- data_edgar %>% filter(is.na(AR6GWP100))
check <- data_edgar %>% select(gas,AR6GWP100) %>% distinct()
data_edgar <- data_edgar %>%
mutate(value_gwp=value*AR6GWP100)
# list_fgases <- data.frame(gas=unique(data_edgar$gas))
# list_fgases <- list_fgases %>%
#   mutate(group=ifelse(grepl("CFC",gas),"ODS F-gases",NA)) %>%
#   mutate(group=ifelse(grepl("HCFC",gas),"ODS F-gases",group)) %>%
#   mutate(group=ifelse(grepl("HFC",gas),"UNFCCC F-gases",group)) %>%
#   mutate(group=ifelse(grepl("Halon",gas),"ODS F-gases",group)) %>%
#   mutate(group=ifelse(grepl("NF3",gas),"UNFCCC F-gases",group)) %>%
#   mutate(group=ifelse(grepl("SF6",gas),"UNFCCC F-gases",group)) #%>%
#   mutate(group=ifelse(is.na(group),"UNFCCC F-gases",group))
list_fgases <- data_edgar %>%
select(gas) %>%
distinct() %>%
mutate(group=ifelse(gas=="CO2","CO2",NA)) %>%
mutate(group=ifelse(gas=="CH4","CH4",group)) %>%
mutate(group=ifelse(gas=="N2O","N2O",group)) %>%
mutate(group=ifelse(is.na(group),"Fgases",group))
data_edgar <- left_join(data_edgar,list_fgases,by="gas")
data_edgar <- data_edgar %>%
mutate(gas=group) %>%
group_by(iso,country,code,code_description,gas,year) %>%
summarise(value=sum(value_gwp,na.rm=TRUE))
# check global totals
check <- data_edgar %>% filter(year==2022) %>% group_by(gas) %>% summarise(value=sum(value,na.rm=T))
### aggregate sectors
write.xlsx(data_edgar %>% ungroup() %>% select(code,code_description) %>% distinct() %>% arrange(code),"cc_sectors.xlsx")
data_edgar <- left_join(data_edgar,read.xlsx("sources/cc_sectors.xlsx"))
data_edgar$gas <- as.factor(data_edgar$gas)
data_edgar$gas <- fct_relevel(data_edgar$gas,"CO2","CH4","N2O","Fgases")
data_edgar$sector <- as.factor(data_edgar$sector)
data_edgar$sector <- fct_reorder(data_edgar$sector,data_edgar$sector_order)
data_edgar <- data_edgar %>%
mutate(year=as.numeric(year)) %>%
group_by(iso,country,sector,sector_codes,subsector,gas,year) %>%
summarise(value=sum(value,na.rm=TRUE))
## Population data from the World Bank
data_wdi_pop<-WDI(country = "all",indicator = "SP.POP.TOTL",start = 1970,end = 2022,extra=TRUE,language = "en")%>%
select(iso3c, country, year, SP.POP.TOTL) %>%
filter(!is.na(iso3c))
data_wdi_pop$population <- data_wdi_pop$SP.POP.TOTL
data_wdi_pop$iso <- data_wdi_pop$iso3c
data_wdi_pop<-data_wdi_pop %>% select(-SP.POP.TOTL,-iso3c)
## Global Carbon Project CO2 FFI (https://globalcarbonbudget.org/carbonbudget2023/)
data_gcb_co2_ffi <- load_gcb_countries_ffi(read.xlsx("sources/National_Fossil_Carbon_Emissions_2023v1.0.xlsx",sheet=2,startRow = 12))
## Global Carbon Project CO2 LUC (https://globalcarbonbudget.org/carbonbudget2023/)
data_gcb_luc <- load_gcb_countries_luc(
readxl::read_xlsx('Sources/National_LandUseChange_Carbon_Emissions_2023v1.0.xlsx',range="A8:HK181",sheet=2),
readxl::read_xlsx('Sources/National_LandUseChange_Carbon_Emissions_2023v1.0.xlsx',range="A8:HK181",sheet=3),
readxl::read_xlsx('Sources/National_LandUseChange_Carbon_Emissions_2023v1.0.xlsx',range="A8:HK181",sheet=4)
)
load_gcb_countries_luc <- function(sheet_blue,sheet_hn,sheet_oscar){
colnames(sheet_blue)[1] <- "year"
colnames(sheet_hn)[1] <- "year"
colnames(sheet_oscar)[1] <- "year"
sheet_blue <- gather(sheet_blue,country,blue,-year)
sheet_hn <- gather(sheet_hn,country,hn,-year)
sheet_oscar <- gather(sheet_oscar,country,oscar,-year)
data_gcb_luc <- left_join(sheet_blue,sheet_hn,
by = join_by(year, country))
data_gcb_luc <- left_join(data_gcb_luc,sheet_oscar,
by = join_by(year, country))
data_gcb_luc <- data_gcb_luc %>%
filter(year!="QF") %>%
mutate(blue=as.numeric(blue)) %>%
mutate(hn=as.numeric(hn)) %>%
mutate(oscar=as.numeric(oscar)) %>%
mutate(mean=(blue+hn+oscar)/3) %>%
mutate(iso=countrycode(country,"country.name","iso3c")) %>%
mutate(iso=ifelse(country=="Netherlands Antilles","ANT",iso))
data_gcb_luc <- gather(data_gcb_luc,key,value,blue,hn,oscar,mean) %>%
mutate(value=value/1000) %>%
mutate(value=value*(44/12))
data_gcb_luc <- spread(data_gcb_luc,key,value) %>%
mutate(units="GtCO2") %>%
select(country,iso,units,year,blue,hn,oscar,mean,value)
return(data_gcb_luc)
}
data_gcb_luc <- load_gcb_countries_luc(
readxl::read_xlsx('Sources/National_LandUseChange_Carbon_Emissions_2023v1.0.xlsx',range="A8:HK181",sheet=2),
readxl::read_xlsx('Sources/National_LandUseChange_Carbon_Emissions_2023v1.0.xlsx',range="A8:HK181",sheet=3),
readxl::read_xlsx('Sources/National_LandUseChange_Carbon_Emissions_2023v1.0.xlsx',range="A8:HK181",sheet=4)
)
sheet_blue <- readxl::read_xlsx('Sources/National_LandUseChange_Carbon_Emissions_2023v1.0.xlsx',range="A8:HK181",sheet=2)
sheet_hn <- readxl::read_xlsx('Sources/National_LandUseChange_Carbon_Emissions_2023v1.0.xlsx',range="A8:HK181",sheet=3)
sheet_oscar <- readxl::read_xlsx('Sources/National_LandUseChange_Carbon_Emissions_2023v1.0.xlsx',range="A8:HK181",sheet=4)
colnames(sheet_blue)[1] <- "year"
colnames(sheet_hn)[1] <- "year"
colnames(sheet_oscar)[1] <- "year"
sheet_blue <- gather(sheet_blue,country,blue,-year)
sheet_hn <- gather(sheet_hn,country,hn,-year)
sheet_oscar <- gather(sheet_oscar,country,oscar,-year)
data_gcb_luc <- left_join(sheet_blue,sheet_hn,
by = join_by(year, country))
data_gcb_luc <- left_join(data_gcb_luc,sheet_oscar,
by = join_by(year, country))
data_gcb_luc <- data_gcb_luc %>%
filter(year!="QF") %>%
mutate(blue=as.numeric(blue)) %>%
mutate(hn=as.numeric(hn)) %>%
mutate(oscar=as.numeric(oscar)) %>%
mutate(mean=(blue+hn+oscar)/3) %>%
mutate(iso=countrycode(country,"country.name","iso3c")) %>%
mutate(iso=ifelse(country=="Netherlands Antilles","ANT",iso))
data_gcb_luc <- gather(data_gcb_luc,key,value,blue,hn,oscar,mean) %>%
mutate(value=value/1000) %>%
mutate(value=value*(44/12))
data_gcb_luc <- spread(data_gcb_luc,key,value) %>%
mutate(units="GtCO2") %>%
select(country,iso,units,year,blue,hn,oscar,mean,value)
data_gcb_luc <- spread(data_gcb_luc,key,value) %>%
mutate(units="GtCO2") %>%
select(country,iso,units,year,blue,hn,oscar,mean)
sheet_blue <- readxl::read_xlsx('Sources/National_LandUseChange_Carbon_Emissions_2023v1.0.xlsx',range="A8:GT182",sheet=2)
sheet_hn <- readxl::read_xlsx('Sources/National_LandUseChange_Carbon_Emissions_2023v1.0.xlsx',range="A8:GT182",sheet=3)
sheet_oscar <- readxl::read_xlsx('Sources/National_LandUseChange_Carbon_Emissions_2023v1.0.xlsx',range="A8:GT182",sheet=4)
load_gcb_countries_luc <- function(sheet_blue,sheet_hn,sheet_oscar){
colnames(sheet_blue)[1] <- "year"
colnames(sheet_hn)[1] <- "year"
colnames(sheet_oscar)[1] <- "year"
sheet_blue <- gather(sheet_blue,country,blue,-year)
sheet_hn <- gather(sheet_hn,country,hn,-year)
sheet_oscar <- gather(sheet_oscar,country,oscar,-year)
data_gcb_luc <- left_join(sheet_blue,sheet_hn,
by = join_by(year, country))
data_gcb_luc <- left_join(data_gcb_luc,sheet_oscar,
by = join_by(year, country))
data_gcb_luc <- data_gcb_luc %>%
filter(year!="QF") %>%
mutate(blue=as.numeric(blue)) %>%
mutate(hn=as.numeric(hn)) %>%
mutate(oscar=as.numeric(oscar)) %>%
mutate(mean=(blue+hn+oscar)/3) %>%
mutate(iso=countrycode(country,"country.name","iso3c")) %>%
mutate(iso=ifelse(country=="Netherlands Antilles","ANT",iso))
data_gcb_luc <- gather(data_gcb_luc,key,value,blue,hn,oscar,mean) %>%
mutate(value=value/1000) %>%
mutate(value=value*(44/12))
data_gcb_luc <- spread(data_gcb_luc,key,value) %>%
mutate(units="GtCO2") %>%
select(country,iso,units,year,blue,hn,oscar,mean)
return(data_gcb_luc)
}
colnames(sheet_blue)[1] <- "year"
colnames(sheet_hn)[1] <- "year"
colnames(sheet_oscar)[1] <- "year"
sheet_blue <- gather(sheet_blue,country,blue,-year)
sheet_hn <- gather(sheet_hn,country,hn,-year)
sheet_oscar <- gather(sheet_oscar,country,oscar,-year)
data_gcb_luc <- left_join(sheet_blue,sheet_hn,
by = join_by(year, country))
data_gcb_luc <- left_join(data_gcb_luc,sheet_oscar,
by = join_by(year, country))
data_gcb_luc <- data_gcb_luc %>%
filter(year!="QF") %>%
mutate(blue=as.numeric(blue)) %>%
mutate(hn=as.numeric(hn)) %>%
mutate(oscar=as.numeric(oscar)) %>%
mutate(mean=(blue+hn+oscar)/3) %>%
mutate(iso=countrycode(country,"country.name","iso3c")) %>%
mutate(iso=ifelse(country=="Netherlands Antilles","ANT",iso))
data_gcb_luc <- gather(data_gcb_luc,key,value,blue,hn,oscar,mean) %>%
mutate(value=value/1000) %>%
mutate(value=value*(44/12))
data_gcb_luc <- spread(data_gcb_luc,key,value) %>%
mutate(units="GtCO2") %>%
select(country,iso,units,year,blue,hn,oscar,mean)
knitr::opts_chunk$set(echo = FALSE)
rm(list = ls())
library(tidyverse)
library(openxlsx)
library(countrycode)
library(ggrepel)
library(patchwork)
library(zoo)
library(RColorBrewer)
library(WDI)
library(labelled)
source("https://raw.githubusercontent.com/lambwf/Codebase/main/figure_style.R")
source("https://raw.githubusercontent.com/lambwf/Codebase/main/reshape_with_labels.R")
source("https://raw.githubusercontent.com/lambwf/Codebase/main/locate_shares.R")
source("https://raw.githubusercontent.com/lambwf/Codebase/main/load_gcb_countries_v2023.R")
## load EDGAR data (https://edgar.jrc.ec.europa.eu/dataset_ghg80)
data_edgar_co2_ffi <- read.xlsx("sources/IEA_EDGAR_CO2_1970_2022.xlsx",sheet=2,startRow = 10)
data_edgar_co2_ffi <- gather(data_edgar_co2_ffi,year,value,Y_1970:Y_2022)
data_edgar_co2_ffi$year <- gsub("Y_","",data_edgar_co2_ffi$year)
data_edgar_co2_ffi <- data_edgar_co2_ffi %>%
select(iso=Country_code_A3,country=Name,code=ipcc_code_2006_for_standard_report,code_description=ipcc_code_2006_for_standard_report_name,gas=Substance,fossil_bio,year,value)
data_edgar_ch4 <- read.xlsx("sources/EDGAR_CH4_1970_2022.xlsx",sheet=2,startRow = 10)
data_edgar_ch4 <- gather(data_edgar_ch4,year,value,Y_1970:Y_2022)
data_edgar_ch4$year <- gsub("Y_","",data_edgar_ch4$year)
data_edgar_ch4 <- data_edgar_ch4 %>%
select(iso=Country_code_A3,country=Name,code=ipcc_code_2006_for_standard_report,code_description=ipcc_code_2006_for_standard_report_name,gas=Substance,fossil_bio,year,value)
data_edgar_n2o <- read.xlsx("sources/EDGAR_N2O_1970_2022.xlsx",sheet=2,startRow = 10)
data_edgar_n2o <- gather(data_edgar_n2o,year,value,Y_1970:Y_2022)
data_edgar_n2o$year <- gsub("Y_","",data_edgar_n2o$year)
data_edgar_n2o <- data_edgar_n2o %>%
select(iso=Country_code_A3,country=Name,code=ipcc_code_2006_for_standard_report,code_description=ipcc_code_2006_for_standard_report_name,gas=Substance,fossil_bio,year,value)
data_edgar_fgas <- read.xlsx("sources/EDGAR_F-gases_1990_2022.xlsx",sheet=2,startRow = 10)
data_edgar_fgas <- gather(data_edgar_fgas,year,value,Y_1990:Y_2022)
data_edgar_fgas$year <- gsub("Y_","",data_edgar_fgas$year)
data_edgar_fgas <- data_edgar_fgas %>%
select(iso=Country_code_A3,country=Name,code=ipcc_code_2006_for_standard_report,code_description=ipcc_code_2006_for_standard_report_name,gas=Substance,fossil_bio,year,value)
data_edgar <- rbind(data_edgar_co2_ffi,data_edgar_ch4)
data_edgar <- rbind(data_edgar,data_edgar_n2o)
data_edgar <- rbind(data_edgar,data_edgar_fgas)
## join GWPs and calculate CO2e
gwps <- read.csv("https://raw.githubusercontent.com/openclimatedata/globalwarmingpotentials/main/globalwarmingpotentials.csv",skip = 9)
data_edgar$gas <- gsub("-","",data_edgar$gas)
data_edgar <- left_join(data_edgar,gwps %>% select(gas=Species,AR6GWP100)) %>%
mutate(AR6GWP100=ifelse(gas=="CO2",1,AR6GWP100))
# check all gwps joined
check <- data_edgar %>% filter(is.na(AR6GWP100))
check <- data_edgar %>% select(gas,AR6GWP100) %>% distinct()
data_edgar <- data_edgar %>%
mutate(value_gwp=value*AR6GWP100)
# list_fgases <- data.frame(gas=unique(data_edgar$gas))
# list_fgases <- list_fgases %>%
#   mutate(group=ifelse(grepl("CFC",gas),"ODS F-gases",NA)) %>%
#   mutate(group=ifelse(grepl("HCFC",gas),"ODS F-gases",group)) %>%
#   mutate(group=ifelse(grepl("HFC",gas),"UNFCCC F-gases",group)) %>%
#   mutate(group=ifelse(grepl("Halon",gas),"ODS F-gases",group)) %>%
#   mutate(group=ifelse(grepl("NF3",gas),"UNFCCC F-gases",group)) %>%
#   mutate(group=ifelse(grepl("SF6",gas),"UNFCCC F-gases",group)) #%>%
#   mutate(group=ifelse(is.na(group),"UNFCCC F-gases",group))
list_fgases <- data_edgar %>%
select(gas) %>%
distinct() %>%
mutate(group=ifelse(gas=="CO2","CO2",NA)) %>%
mutate(group=ifelse(gas=="CH4","CH4",group)) %>%
mutate(group=ifelse(gas=="N2O","N2O",group)) %>%
mutate(group=ifelse(is.na(group),"Fgases",group))
data_edgar <- left_join(data_edgar,list_fgases,by="gas")
data_edgar <- data_edgar %>%
mutate(gas=group) %>%
group_by(iso,country,code,code_description,gas,year) %>%
summarise(value=sum(value_gwp,na.rm=TRUE))
# check global totals
check <- data_edgar %>% filter(year==2022) %>% group_by(gas) %>% summarise(value=sum(value,na.rm=T))
### aggregate sectors
write.xlsx(data_edgar %>% ungroup() %>% select(code,code_description) %>% distinct() %>% arrange(code),"cc_sectors.xlsx")
data_edgar <- left_join(data_edgar,read.xlsx("sources/cc_sectors.xlsx"))
data_edgar$gas <- as.factor(data_edgar$gas)
data_edgar$gas <- fct_relevel(data_edgar$gas,"CO2","CH4","N2O","Fgases")
data_edgar$sector <- as.factor(data_edgar$sector)
data_edgar$sector <- fct_reorder(data_edgar$sector,data_edgar$sector_order)
data_edgar <- data_edgar %>%
mutate(year=as.numeric(year)) %>%
group_by(iso,country,sector,sector_codes,subsector,gas,year) %>%
summarise(value=sum(value,na.rm=TRUE))
## Population data from the World Bank
data_wdi_pop<-WDI(country = "all",indicator = "SP.POP.TOTL",start = 1970,end = 2022,extra=TRUE,language = "en")%>%
select(iso3c, country, year, SP.POP.TOTL) %>%
filter(!is.na(iso3c))
data_wdi_pop$population <- data_wdi_pop$SP.POP.TOTL
data_wdi_pop$iso <- data_wdi_pop$iso3c
data_wdi_pop<-data_wdi_pop %>% select(-SP.POP.TOTL,-iso3c)
## Global Carbon Project CO2 FFI (https://globalcarbonbudget.org/carbonbudget2023/)
data_gcb_co2_ffi <- load_gcb_countries_ffi(read.xlsx("sources/National_Fossil_Carbon_Emissions_2023v1.0.xlsx",sheet=2,startRow = 12))
## Global Carbon Project CO2 LUC (https://globalcarbonbudget.org/carbonbudget2023/)
data_gcb_luc <- load_gcb_countries_luc(
readxl::read_xlsx('Sources/National_LandUseChange_Carbon_Emissions_2023v1.0.xlsx',range="A8:GT182",sheet=2),
readxl::read_xlsx('Sources/National_LandUseChange_Carbon_Emissions_2023v1.0.xlsx',range="A8:GT182",sheet=3),
readxl::read_xlsx('Sources/National_LandUseChange_Carbon_Emissions_2023v1.0.xlsx',range="A8:GT182",sheet=4)
)
# # Note for coding simplicity I average the bookkeeping models at the national level, before aggregating to regions later on. Results would be slightly different if emissions were summed by model and region, then averaged. NAs ignored
#
#
# data_gcb_lulucf_ntl <- data_gcb_lulucf_ntl %>%
#   group_by(country,year,units) %>%
#   summarise(value=mean(value,na.rm=TRUE))
#
# data_gcb_lulucf_ntl <- spread(data_gcb_lulucf_ntl,year,value)
# data_gcb_lulucf_ntl <- data_gcb_lulucf_ntl %>%
#   mutate(iso=countrycode(country,"country.name","iso3c")) %>%
#   mutate(iso=ifelse(country=="Netherlands Antilles","ANT",iso))
data_indicators <- data_edgar %>%
filter(year==2022) %>%
group_by(iso,country) %>%
summarise(ghg_total=sum(value,na.rm=TRUE)/1e3)
## Per capita GHG emissions
data_indicators <- left_join(data_indicators,data_wdi_pop %>% filter(year==2022) %>% select(iso,population),by = join_by(iso))
data_indicators <- data_indicators %>%
mutate(ghg_per_capita=ghg_total/population*1e6)
## Historic cumulative emissions
data_indicators <- left_join(data_indicators,data_gcb_co2_ffi %>% group_by(iso) %>% summarise(co2_ffi_historic=sum(value,na.rm=TRUE)))
View(load_gcb_countries_ffi)
View(data_gcb_co2_ffi)
View(load_gcb_countries_luc)
data_gcb_co2_ffi <- load_gcb_countries_ffi(read.xlsx("sources/National_Fossil_Carbon_Emissions_2023v1.0.xlsx",sheet=2,startRow = 12))
sheet_ffi <- read.xlsx("sources/National_Fossil_Carbon_Emissions_2023v1.0.xlsx",sheet=2,startRow = 12)
data_gcb_co2_ffi <- gather(sheet_ffi,country,value,-X1)
data_gcb_co2_ffi <- data_gcb_co2_ffi %>%
rename(year=X1) %>%
mutate(iso=countrycode(country,"country.name","iso3c")) %>%
mutate(iso=ifelse(country=="Netherlands Antilles","ANT",iso)) %>%
mutate(iso=ifelse(country=="Türkiye","TUR",iso)) %>%
mutate(value=value/1000) %>%
mutate(value=value*(44/12)) %>%
mutate(units="GtCO2") %>%
select(country,iso,units,year,value)
