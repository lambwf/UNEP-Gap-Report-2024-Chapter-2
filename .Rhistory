ungroup() %>%
select(sector) %>%
distinct() %>%
arrange(sector),my_colours)
p1 <- data_countries %>% ggplot(aes(x=year,y=value,fill=sector)) +
geom_area(color="#636363") +
theme_wl() +
scale_fill_manual(values = my_colours$colour) +
ylab("GHG Emissions (MtCO2e/year)") +
theme(axis.title.x = element_blank(),
panel.grid.major.x = element_blank(),
panel.border = element_blank(),
axis.line.x=element_line(colour='#636363'),
axis.line.y=element_line(colour='#636363'),
legend.position = "none",panel.background = element_blank())
p2 <- labels %>%  ggplot(.,aes(y=position,label=sector)) +
geom_point(aes(x=ifelse(sector %in% c("Energy","Industrial processes","AFOLU","Waste & Other"),1.9,2),fill=sector),
shape=22,size=3,color='#636363') +
geom_text(hjust=0,aes(x=2.1),color='#636363',vjust=0.5) +
geom_vline(xintercept = 4,color='#636363') +
theme_wl() +
#scale_color_manual(values = c("white",'#636363','#636363','#636363','#636363','#636363','#636363','#636363','#636363','#636363','#636363')) +
scale_fill_manual(values = c(labels$colour)) +
scale_x_continuous(limits=c(1.9,4)) +
theme(axis.title = element_blank(),
panel.border = element_blank(),
legend.position="none",
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks = element_blank(),
panel.grid.major = element_blank(),
plot.background = element_blank(),
plot.margin = unit(c(0,0,0,0),"cm"))
## indicators plot
p3 <- data_indicators %>%
ungroup() %>%
filter(iso==country_iso) %>%
add_row(var="empty",label="",value="") %>%
ggplot(.,aes(x=1,y=label,label=value)) +
geom_text(size=10*(0.36),hjust=0,vjust=1,color='#636363')  +
scale_y_discrete(labels = function(x) str_wrap(x, width = 20))+
scale_x_continuous(limits=c(1,3)) +
theme_wl()+
theme(axis.title = element_blank(),
axis.ticks = element_blank(),
panel.background = element_blank(),
panel.border = element_blank(),
panel.grid = element_blank(),
axis.text.x = element_blank(),
axis.text.y = element_text(size=10),
plot.caption = element_text(size=11,colour='#bdbdbd',hjust=1)) +
labs(caption='Sources: EDGAR | GCB | Grassi et al.')
name <- countrycode(sourcevar = country_iso,origin="iso3c","country.name")
p <- p1 + p2 + wrap_elements(p3) + plot_layout(widths=c(4.4,2.4,3.8)) +
plot_annotation(title=name,
subtitle="Emissions trends and indicators",
#caption = 'Sources: EDGAR | GCB | Grassi et al.',
theme = theme_wl() +
theme(plot.title=element_text(vjust=1,size=16),
plot.background = element_rect(fill = NA, colour = '#636363', size = 0.5),
plot.caption = element_text(size=11,colour='#bdbdbd',hjust=1)))
return(p)
}
countries <- data_indicators %>% filter(!is.na(population)) %>% filter(!is.na(co2_consumption)) %>% select(iso) %>% distinct()
countries <- countries %>%
mutate(country=countrycode(iso,"iso3c","country.name"))
for (i in 1:length(countries$iso)) {
ggsave(plot_country(countries$iso[i],data_ghg,data_indicators),filename = paste0(countries$country[i],".png"),path = "results/countries/",device = "png",height = 4,width=10,dpi=300)
ggsave(plot_country(countries$iso[i],data_ghg,data_indicators),filename = paste0(countries$country[i],".pdf"),path = "results/countries/",device = "pdf",height = 4,width=10)
}
p3 <- data_indicators %>%
ungroup() %>%
filter(iso==country_iso) %>%
add_row(var="empty",label="",value="") %>%
ggplot(.,aes(x=1,y=label,label=value)) +
geom_text(size=10*(0.36),hjust=0,vjust=1,color='#636363')  +
scale_y_discrete(labels = function(x) str_wrap(x, width = 20))+
scale_x_continuous(limits=c(1,3)) +
theme_wl()+
theme(axis.title = element_blank(),
axis.ticks = element_blank(),
panel.background = element_blank(),
panel.border = element_blank(),
panel.grid = element_blank(),
axis.text.x = element_blank(),
axis.text.y = element_text(size=10),
plot.caption = element_text(size=11,colour='#bdbdbd',hjust=0.5)) +
labs(caption='Sources: EDGAR | GCB | Grassi et al.')
p <- p1 + p2 + wrap_elements(p3) + plot_layout(widths=c(4.4,2.4,3.8)) +
plot_annotation(title=name,
subtitle="Emissions trends and indicators",
#caption = 'Sources: EDGAR | GCB | Grassi et al.',
theme = theme_wl() +
theme(plot.title=element_text(vjust=1,size=16),
plot.background = element_rect(fill = NA, colour = '#636363', size = 0.5),
plot.caption = element_text(size=11,colour='#bdbdbd',hjust=1)))
country_iso=c("CHN")
plot_country <- function(country_iso,data_ghg,data_indicators) {
## GHG emissions trend plot
data_countries <- data_ghg %>%
filter(iso==country_iso) %>%
filter(year>=1990) %>%
rename(sector=sector_tier_2) %>%
group_by(iso,country,sector,year) %>%
summarise(value=sum(value,na.rm=TRUE)/1e6)
labels <- read.xlsx("sources/cc_sectors.xlsx",sheet=2)
labels <- labels %>%
arrange(desc(position)) %>%
mutate(position=1) %>%
mutate(position=cumsum(position))
labels$sector <- fct_reorder(labels$sector,labels$position)
data_countries$sector <- fct_relevel(data_countries$sector,"Land use")
my_colours <- labels %>% select(sector,colour)
my_colours$sector <- gsub("   ","",my_colours$sector)
my_colours <- left_join(data_countries %>%
ungroup() %>%
select(sector) %>%
distinct() %>%
arrange(sector),my_colours)
p1 <- data_countries %>% ggplot(aes(x=year,y=value,fill=sector)) +
geom_area(color="#636363") +
theme_wl() +
scale_fill_manual(values = my_colours$colour) +
ylab("GHG Emissions (MtCO2e/year)") +
theme(axis.title.x = element_blank(),
panel.grid.major.x = element_blank(),
panel.border = element_blank(),
axis.line.x=element_line(colour='#636363'),
axis.line.y=element_line(colour='#636363'),
legend.position = "none",panel.background = element_blank())
p2 <- labels %>%  ggplot(.,aes(y=position,label=sector)) +
geom_point(aes(x=ifelse(sector %in% c("Energy","Industrial processes","AFOLU","Waste & Other"),1.9,2),fill=sector),
shape=22,size=3,color='#636363') +
geom_text(hjust=0,aes(x=2.1),color='#636363',vjust=0.5) +
geom_vline(xintercept = 4,color='#636363') +
theme_wl() +
#scale_color_manual(values = c("white",'#636363','#636363','#636363','#636363','#636363','#636363','#636363','#636363','#636363','#636363')) +
scale_fill_manual(values = c(labels$colour)) +
scale_x_continuous(limits=c(1.9,4)) +
theme(axis.title = element_blank(),
panel.border = element_blank(),
legend.position="none",
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks = element_blank(),
panel.grid.major = element_blank(),
plot.background = element_blank(),
plot.margin = unit(c(0,0,0,0),"cm"))
## indicators plot
p3 <- data_indicators %>%
ungroup() %>%
filter(iso==country_iso) %>%
add_row(var="empty",label="",value="") %>%
ggplot(.,aes(x=1,y=label,label=value)) +
geom_text(size=10*(0.36),hjust=0,vjust=1,color='#636363')  +
scale_y_discrete(labels = function(x) str_wrap(x, width = 20))+
scale_x_continuous(limits=c(1,3)) +
theme_wl()+
theme(axis.title = element_blank(),
axis.ticks = element_blank(),
panel.background = element_blank(),
panel.border = element_blank(),
panel.grid = element_blank(),
axis.text.x = element_blank(),
axis.text.y = element_text(size=10),
plot.caption = element_text(size=11,colour='#bdbdbd',hjust=0.5)) +
labs(caption='Sources: EDGAR | GCB | Grassi et al.')
name <- countrycode(sourcevar = country_iso,origin="iso3c","country.name")
p <- p1 + p2 + wrap_elements(p3) + plot_layout(widths=c(4.4,2.4,3.8)) +
plot_annotation(title=name,
subtitle="Emissions trends and indicators",
#caption = 'Sources: EDGAR | GCB | Grassi et al.',
theme = theme_wl() +
theme(plot.title=element_text(vjust=1,size=16),
plot.background = element_rect(fill = NA, colour = '#636363', size = 0.5),
plot.caption = element_text(size=11,colour='#bdbdbd',hjust=1)))
return(p)
}
plot_country("RUS",data_ghg,data_indicators)
country_iso=c("CHN")
plot_country <- function(country_iso,data_ghg,data_indicators) {
## GHG emissions trend plot
data_countries <- data_ghg %>%
filter(iso==country_iso) %>%
filter(year>=1990) %>%
rename(sector=sector_tier_2) %>%
group_by(iso,country,sector,year) %>%
summarise(value=sum(value,na.rm=TRUE)/1e6)
labels <- read.xlsx("sources/cc_sectors.xlsx",sheet=2)
labels <- labels %>%
arrange(desc(position)) %>%
mutate(position=1) %>%
mutate(position=cumsum(position))
labels$sector <- fct_reorder(labels$sector,labels$position)
data_countries$sector <- fct_relevel(data_countries$sector,"Land use")
my_colours <- labels %>% select(sector,colour)
my_colours$sector <- gsub("   ","",my_colours$sector)
my_colours <- left_join(data_countries %>%
ungroup() %>%
select(sector) %>%
distinct() %>%
arrange(sector),my_colours)
p1 <- data_countries %>% ggplot(aes(x=year,y=value,fill=sector)) +
geom_area(color="#636363") +
theme_wl() +
scale_fill_manual(values = my_colours$colour) +
ylab("GHG Emissions (MtCO2e/year)") +
theme(axis.title.x = element_blank(),
panel.grid.major.x = element_blank(),
panel.border = element_blank(),
axis.line.x=element_line(colour='#636363'),
axis.line.y=element_line(colour='#636363'),
legend.position = "none",panel.background = element_blank())
p2 <- labels %>%  ggplot(.,aes(y=position,label=sector)) +
geom_point(aes(x=ifelse(sector %in% c("Energy","Industrial processes","AFOLU","Waste & Other"),1.9,2),fill=sector),
shape=22,size=3,color='#636363') +
geom_text(hjust=0,aes(x=2.1),color='#636363',vjust=0.5) +
geom_vline(xintercept = 4,color='#636363') +
theme_wl() +
#scale_color_manual(values = c("white",'#636363','#636363','#636363','#636363','#636363','#636363','#636363','#636363','#636363','#636363')) +
scale_fill_manual(values = c(labels$colour)) +
scale_x_continuous(limits=c(1.9,4)) +
theme(axis.title = element_blank(),
panel.border = element_blank(),
legend.position="none",
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks = element_blank(),
panel.grid.major = element_blank(),
plot.background = element_blank(),
plot.margin = unit(c(0,0,0,0),"cm"))
## indicators plot
p3 <- data_indicators %>%
ungroup() %>%
filter(iso==country_iso) %>%
add_row(var="empty",label="",value="") %>%
ggplot(.,aes(x=1,y=label,label=value)) +
geom_text(size=10*(0.36),hjust=0,vjust=1,color='#636363')  +
scale_y_discrete(labels = function(x) str_wrap(x, width = 20))+
scale_x_continuous(limits=c(1,3)) +
theme_wl()+
theme(axis.title = element_blank(),
axis.ticks = element_blank(),
panel.background = element_blank(),
panel.border = element_blank(),
panel.grid = element_blank(),
axis.text.x = element_blank(),
axis.text.y = element_text(size=10),
plot.caption = element_text(size=11,colour='#bdbdbd')) +
labs(caption='Sources: EDGAR | GCB | Grassi et al.')
name <- countrycode(sourcevar = country_iso,origin="iso3c","country.name")
p <- p1 + p2 + wrap_elements(p3) + plot_layout(widths=c(4.4,2.4,3.8)) +
plot_annotation(title=name,
subtitle="Emissions trends and indicators",
#caption = 'Sources: EDGAR | GCB | Grassi et al.',
theme = theme_wl() +
theme(plot.title=element_text(vjust=1,size=16),
plot.background = element_rect(fill = NA, colour = '#636363', size = 0.5),
plot.caption = element_text(size=11,colour='#bdbdbd',hjust=1)))
return(p)
}
plot_country("RUS",data_ghg,data_indicators)
country_iso=c("CHN")
plot_country <- function(country_iso,data_ghg,data_indicators) {
## GHG emissions trend plot
data_countries <- data_ghg %>%
filter(iso==country_iso) %>%
filter(year>=1990) %>%
rename(sector=sector_tier_2) %>%
group_by(iso,country,sector,year) %>%
summarise(value=sum(value,na.rm=TRUE)/1e6)
labels <- read.xlsx("sources/cc_sectors.xlsx",sheet=2)
labels <- labels %>%
arrange(desc(position)) %>%
mutate(position=1) %>%
mutate(position=cumsum(position))
labels$sector <- fct_reorder(labels$sector,labels$position)
data_countries$sector <- fct_relevel(data_countries$sector,"Land use")
my_colours <- labels %>% select(sector,colour)
my_colours$sector <- gsub("   ","",my_colours$sector)
my_colours <- left_join(data_countries %>%
ungroup() %>%
select(sector) %>%
distinct() %>%
arrange(sector),my_colours)
p1 <- data_countries %>% ggplot(aes(x=year,y=value,fill=sector)) +
geom_area(color="#636363") +
theme_wl() +
scale_fill_manual(values = my_colours$colour) +
ylab("GHG Emissions (MtCO2e/year)") +
theme(axis.title.x = element_blank(),
panel.grid.major.x = element_blank(),
panel.border = element_blank(),
axis.line.x=element_line(colour='#636363'),
axis.line.y=element_line(colour='#636363'),
legend.position = "none",panel.background = element_blank())
p2 <- labels %>%  ggplot(.,aes(y=position,label=sector)) +
geom_point(aes(x=ifelse(sector %in% c("Energy","Industrial processes","AFOLU","Waste & Other"),1.9,2),fill=sector),
shape=22,size=3,color='#636363') +
geom_text(hjust=0,aes(x=2.1),color='#636363',vjust=0.5) +
geom_vline(xintercept = 4,color='#636363') +
theme_wl() +
#scale_color_manual(values = c("white",'#636363','#636363','#636363','#636363','#636363','#636363','#636363','#636363','#636363','#636363')) +
scale_fill_manual(values = c(labels$colour)) +
scale_x_continuous(limits=c(1.9,4)) +
theme(axis.title = element_blank(),
panel.border = element_blank(),
legend.position="none",
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks = element_blank(),
panel.grid.major = element_blank(),
plot.background = element_blank(),
plot.margin = unit(c(0,0,0,0),"cm"))
## indicators plot
p3 <- data_indicators %>%
ungroup() %>%
filter(iso==country_iso) %>%
add_row(var="empty",label="",value="") %>%
ggplot(.,aes(x=1,y=label,label=value)) +
geom_text(size=10*(0.36),hjust=0,vjust=1,color='#636363')  +
scale_y_discrete(labels = function(x) str_wrap(x, width = 20))+
scale_x_continuous(limits=c(1,3)) +
theme_wl()+
theme(axis.title = element_blank(),
axis.ticks = element_blank(),
panel.background = element_blank(),
panel.border = element_blank(),
panel.grid = element_blank(),
axis.text.x = element_blank(),
axis.text.y = element_text(size=10),
plot.caption = element_text(size=11,colour='#bdbdbd',hjust=0)) +
labs(caption='Sources: EDGAR | GCB | Grassi et al.')
name <- countrycode(sourcevar = country_iso,origin="iso3c","country.name")
p <- p1 + p2 + wrap_elements(p3) + plot_layout(widths=c(4.4,2.4,3.8)) +
plot_annotation(title=name,
subtitle="Emissions trends and indicators",
#caption = 'Sources: EDGAR | GCB | Grassi et al.',
theme = theme_wl() +
theme(plot.title=element_text(vjust=1,size=16),
plot.background = element_rect(fill = NA, colour = '#636363', size = 0.5),
plot.caption = element_text(size=11,colour='#bdbdbd',hjust=1)))
return(p)
}
plot_country("RUS",data_ghg,data_indicators)
country_iso=c("CHN")
plot_country <- function(country_iso,data_ghg,data_indicators) {
## GHG emissions trend plot
data_countries <- data_ghg %>%
filter(iso==country_iso) %>%
filter(year>=1990) %>%
rename(sector=sector_tier_2) %>%
group_by(iso,country,sector,year) %>%
summarise(value=sum(value,na.rm=TRUE)/1e6)
labels <- read.xlsx("sources/cc_sectors.xlsx",sheet=2)
labels <- labels %>%
arrange(desc(position)) %>%
mutate(position=1) %>%
mutate(position=cumsum(position))
labels$sector <- fct_reorder(labels$sector,labels$position)
data_countries$sector <- fct_relevel(data_countries$sector,"Land use")
my_colours <- labels %>% select(sector,colour)
my_colours$sector <- gsub("   ","",my_colours$sector)
my_colours <- left_join(data_countries %>%
ungroup() %>%
select(sector) %>%
distinct() %>%
arrange(sector),my_colours)
p1 <- data_countries %>% ggplot(aes(x=year,y=value,fill=sector)) +
geom_area(color="#636363") +
theme_wl() +
scale_fill_manual(values = my_colours$colour) +
ylab("GHG Emissions (MtCO2e/year)") +
theme(axis.title.x = element_blank(),
panel.grid.major.x = element_blank(),
panel.border = element_blank(),
axis.line.x=element_line(colour='#636363'),
axis.line.y=element_line(colour='#636363'),
legend.position = "none",panel.background = element_blank())
p2 <- labels %>%  ggplot(.,aes(y=position,label=sector)) +
geom_point(aes(x=ifelse(sector %in% c("Energy","Industrial processes","AFOLU","Waste & Other"),1.9,2),fill=sector),
shape=22,size=3,color='#636363') +
geom_text(hjust=0,aes(x=2.1),color='#636363',vjust=0.5) +
geom_vline(xintercept = 4,color='#636363') +
theme_wl() +
#scale_color_manual(values = c("white",'#636363','#636363','#636363','#636363','#636363','#636363','#636363','#636363','#636363','#636363')) +
scale_fill_manual(values = c(labels$colour)) +
scale_x_continuous(limits=c(1.9,4)) +
theme(axis.title = element_blank(),
panel.border = element_blank(),
legend.position="none",
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks = element_blank(),
panel.grid.major = element_blank(),
plot.background = element_blank(),
plot.margin = unit(c(0,0,0,0),"cm"))
## indicators plot
p3 <- data_indicators %>%
ungroup() %>%
filter(iso==country_iso) %>%
add_row(var="empty",label="",value="") %>%
ggplot(.,aes(x=1,y=label,label=value)) +
geom_text(size=10*(0.36),hjust=0,vjust=1,color='#636363')  +
scale_y_discrete(labels = function(x) str_wrap(x, width = 20))+
scale_x_continuous(limits=c(1,3)) +
theme_wl()+
theme(axis.title = element_blank(),
axis.ticks = element_blank(),
panel.background = element_blank(),
panel.border = element_blank(),
panel.grid = element_blank(),
axis.text.x = element_blank(),
axis.text.y = element_text(size=10),
plot.caption = element_text(size=11,colour='#bdbdbd',hjust=1)) +
labs(caption='Sources: EDGAR | GCB | Grassi et al.')
name <- countrycode(sourcevar = country_iso,origin="iso3c","country.name")
p <- p1 + p2 + wrap_elements(p3) + plot_layout(widths=c(4.4,2.4,3.8)) +
plot_annotation(title=name,
subtitle="Emissions trends and indicators",
#caption = 'Sources: EDGAR | GCB | Grassi et al.',
theme = theme_wl() +
theme(plot.title=element_text(vjust=1,size=16),
plot.background = element_rect(fill = NA, colour = '#636363', size = 0.5),
plot.caption = element_text(size=11,colour='#bdbdbd',hjust=1)))
return(p)
}
plot_country("RUS",data_ghg,data_indicators)
plot_country("RUS",data_ghg,data_indicators)
country_iso=c("CHN")
plot_country <- function(country_iso,data_ghg,data_indicators) {
## GHG emissions trend plot
data_countries <- data_ghg %>%
filter(iso==country_iso) %>%
filter(year>=1990) %>%
rename(sector=sector_tier_2) %>%
group_by(iso,country,sector,year) %>%
summarise(value=sum(value,na.rm=TRUE)/1e6)
labels <- read.xlsx("sources/cc_sectors.xlsx",sheet=2)
labels <- labels %>%
arrange(desc(position)) %>%
mutate(position=1) %>%
mutate(position=cumsum(position))
labels$sector <- fct_reorder(labels$sector,labels$position)
data_countries$sector <- fct_relevel(data_countries$sector,"Land use")
my_colours <- labels %>% select(sector,colour)
my_colours$sector <- gsub("   ","",my_colours$sector)
my_colours <- left_join(data_countries %>%
ungroup() %>%
select(sector) %>%
distinct() %>%
arrange(sector),my_colours)
p1 <- data_countries %>% ggplot(aes(x=year,y=value,fill=sector)) +
geom_area(color="#636363") +
theme_wl() +
scale_fill_manual(values = my_colours$colour) +
ylab("GHG Emissions (MtCO2e/year)") +
theme(axis.title.x = element_blank(),
panel.grid.major.x = element_blank(),
panel.border = element_blank(),
axis.line.x=element_line(colour='#636363'),
axis.line.y=element_line(colour='#636363'),
legend.position = "none",panel.background = element_blank())
p2 <- labels %>%  ggplot(.,aes(y=position,label=sector)) +
geom_point(aes(x=ifelse(sector %in% c("Energy","Industrial processes","AFOLU","Waste & Other"),1.9,2),fill=sector),
shape=22,size=3,color='#636363') +
geom_text(hjust=0,aes(x=2.1),color='#636363',vjust=0.5) +
geom_vline(xintercept = 4,color='#636363') +
theme_wl() +
#scale_color_manual(values = c("white",'#636363','#636363','#636363','#636363','#636363','#636363','#636363','#636363','#636363','#636363')) +
scale_fill_manual(values = c(labels$colour)) +
scale_x_continuous(limits=c(1.9,4)) +
theme(axis.title = element_blank(),
panel.border = element_blank(),
legend.position="none",
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks = element_blank(),
panel.grid.major = element_blank(),
plot.background = element_blank(),
plot.margin = unit(c(0,0,0,0),"cm"))
## indicators plot
p3 <- data_indicators %>%
ungroup() %>%
filter(iso==country_iso) %>%
add_row(var="empty",label="",value="") %>%
ggplot(.,aes(x=1,y=label,label=value)) +
geom_text(size=10*(0.36),hjust=0,vjust=1,color='#636363')  +
scale_y_discrete(labels = function(x) str_wrap(x, width = 20))+
scale_x_continuous(limits=c(1,3)) +
theme_wl()+
theme(axis.title = element_blank(),
axis.ticks = element_blank(),
panel.background = element_blank(),
panel.border = element_blank(),
panel.grid = element_blank(),
axis.text.x = element_blank(),
axis.text.y = element_text(size=10),
plot.caption = element_text(size=11,colour='#bdbdbd',hjust=1)) +
labs(caption='Sources: EDGAR | GCB | Grassi et al.')
name <- countrycode(sourcevar = country_iso,origin="iso3c","country.name")
p <- p1 + p2 + wrap_elements(p3) + plot_layout(widths=c(4.4,2.4,3.8)) +
plot_annotation(title=name,
subtitle="Emissions trends and indicators",
#caption = 'Sources: EDGAR | GCB | Grassi et al.',
theme = theme_wl() +
theme(plot.title=element_text(vjust=1,size=16),
plot.background = element_rect(fill = NA, colour = '#636363', size = 0.5),
plot.caption = element_text(size=11,colour='#bdbdbd',hjust=1)))
return(p)
}
plot_country("RUS",data_ghg,data_indicators)
