#   theme(axis.title=element_blank(),
#         legend.title=element_blank()) +
#   labs(title="Buildings sector",
#        subtitle="Final energy consumption (EJ)") +
#   #scale_fill_manual(values=c("#bf812d","#f0f0f0","#c7eae5","#35978f"))
#   scale_fill_manual(values=c("#bf812d","#dfc27d","#f6e8c3","#f0f0f0","#c7eae5","#35978f"))
#
# p4 <- wd_data_plot %>%
#   filter(sector=="Transport") %>%
#   filter(var %in% c("Contribution by source in 2019 (%)","Change by source from 2010-2019")) %>%
#   ggplot(.,aes(x=value,y=country,fill=category)) +
#   geom_col(color="#636363",position = position_stack(reverse = TRUE)) +
#   geom_blank(data=wd_data_plot %>%
#                filter(sector=="Transport") %>%
#                filter(iso=="WLD") %>%
#                filter(var=="Change by source from 2010-2019") %>%
#                filter(value>0) %>%
#                group_by(sector,iso,var) %>%
#                summarise(value=sum(value)),
#              inherit.aes=FALSE,aes(x = -value)) +
#   geom_vline(data=wd_data_plot %>% filter(var=="Change by source from 2010-2019"),aes(xintercept = 0),color="#525252",linewidth=0.75) +
#   facet_grid(.~var,scales="free") +
#   theme_wl() +
#   theme(axis.title=element_blank(),
#         legend.title=element_blank()) +
#   labs(title="Transport sector",
#        subtitle="Final energy consumption (EJ)") +
#   #scale_fill_manual(values=c("#bf812d","#f0f0f0","#c7eae5","#35978f"))
#   scale_fill_manual(values=c("#dfc27d","#f6e8c3","#f0f0f0","#c7eae5","#35978f"))
#
# p1 / p2 / p3 / p4
#
#
# blarg <- wd_data_plot %>%
#                filter(sector=="Transport") %>%
#                filter(iso=="WLD") %>%
#                filter(var=="Change by source from 2010-2019")
wd_stats <- wd_data %>%
group_by(country,iso,sector,units,year) %>%
summarise(value=sum(value)) %>%
filter(year>=2017) %>%
filter(year<=2021)
View(wd_stats)
View(growth_rate)
wd_stats <- wd_stats %>%
group_by(country,sector) %>%
mutate(change=growth_rate(year,value)$rate)
wd_stats <- wd_stats %>%
group_by(country,sector) %>%
mutate(change=growth_rate(year,value)$rate) %>%
mutate(change=round(change*100,2))
wd_stats <- wd_stats %>%
group_by(country,sector) %>%
mutate(change=growth_rate(year,value)$rate) %>%
mutate(change=round(change*100,2)) %>%
mutate(change=ifelse(change>0,paste0("+",change),paste0(change)))
wd_stats <- wd_stats %>%
group_by(country,sector) %>%
mutate(change=growth_rate(year,value)$rate) %>%
mutate(change=round(change*100,2)) %>%
mutate(change=ifelse(change>0,paste0("+",change),paste0(change))) %>%
filter(year==2021)
wd_stats <- wd_data %>%
group_by(country,iso,sector,units,year) %>%
summarise(value=sum(value)) %>%
filter(year>=2017) %>%
filter(year<=2021)
wd_stats <- wd_stats %>%
group_by(country,sector) %>%
mutate(change=growth_rate(year,value)$rate) %>%
mutate(change=round(change*100,2)) %>%
mutate(change=ifelse(change>0,paste0("+",change),paste0(change))) %>%
filter(year==2021)
wd_stats$sector <- fct_relevel(wd_stats$sector,"Power","Industry","Buildings","Transport")
wd_stats <- wd_stats %>%
arrange(sector)
wd_stats <- spread(wd_stats,country,change)
wd_stats <- wd_data %>%
group_by(country,iso,sector,units,year) %>%
summarise(value=sum(value)) %>%
filter(year>=2017) %>%
filter(year<=2021)
wd_stats <- wd_stats %>%
group_by(country,sector) %>%
mutate(change=growth_rate(year,value)$rate) %>%
mutate(change=round(change*100,2)) %>%
mutate(change=ifelse(change>0,paste0("+",change),paste0(change))) %>%
filter(year==2021)
wd_stats$sector <- as.factor(wd_stats$sector)
wd_stats$sector <- fct_relevel(wd_stats$sector,"Power","Industry","Buildings","Transport")
wd_stats <- wd_stats %>%
arrange(sector) %>%
select(-value,-units)
wd_stats <- spread(wd_stats,country,change)
wd_stats <- wd_data %>%
group_by(country,iso,sector,units,year) %>%
summarise(value=sum(value)) %>%
filter(year>=2017) %>%
filter(year<=2021)
wd_stats <- wd_stats %>%
group_by(country,sector) %>%
mutate(change=growth_rate(year,value)$rate) %>%
mutate(change=round(change*100,2)) %>%
mutate(change=ifelse(change>0,paste0("+",change),paste0(change))) %>%
filter(year==2021)
wd_stats$sector <- as.factor(wd_stats$sector)
wd_stats$sector <- fct_relevel(wd_stats$sector,"Power","Industry","Buildings","Transport")
wd_stats <- wd_stats %>%
arrange(sector) %>%
select(-value,-units,-iso)
wd_stats <- spread(wd_stats,country,change)
wd_stats <- wd_stats %>%
arrange(sector) %>%
select(-value,-units,-iso,-year)
wd_stats <- wd_data %>%
group_by(country,iso,sector,units,year) %>%
summarise(value=sum(value)) %>%
filter(year>=2017) %>%
filter(year<=2021)
wd_stats <- wd_stats %>%
group_by(country,sector) %>%
mutate(change=growth_rate(year,value)$rate) %>%
mutate(change=round(change*100,2)) %>%
mutate(change=ifelse(change>0,paste0("+",change),paste0(change))) %>%
filter(year==2021)
wd_stats$sector <- as.factor(wd_stats$sector)
wd_stats$sector <- fct_relevel(wd_stats$sector,"Power","Industry","Buildings","Transport")
wd_stats <- wd_stats %>%
arrange(sector) %>%
select(-value,-units,-iso,-year)
wd_stats <- spread(wd_stats,country,change)
write.xlsx(wd_stats,"UNEP-Gap-Report-2024-Sector-Demand-Change.xlsx")
write.xlsx(wd_stats,"results/UNEP-Gap-Report-2024-Sector-Demand-Change.xlsx")
wd_stats <- wd_data %>%
group_by(country,iso,sector,units,year) %>%
summarise(value=sum(value)) %>%
filter(year>=2017) %>%
filter(year<=2021)
wd_stats <- wd_stats %>%
group_by(country,sector) %>%
mutate(change=growth_rate(year,value)$rate) %>%
mutate(change=round(change*100,1)) %>%
mutate(change=ifelse(change>0,paste0("+",change),paste0(change))) %>%
filter(year==2021)
wd_stats$sector <- as.factor(wd_stats$sector)
wd_stats$sector <- fct_relevel(wd_stats$sector,"Power","Industry","Buildings","Transport")
wd_stats <- wd_stats %>%
arrange(sector) %>%
select(-value,-units,-iso,-year)
wd_stats <- spread(wd_stats,country,change)
write.xlsx(wd_stats,"results/UNEP-Gap-Report-2024-Sector-Demand-Change.xlsx")
wd_stats <- wd_data %>%
group_by(country,iso,sector,units,year) %>%
summarise(value=sum(value)) %>%
filter(year>=2017) %>%
filter(year<=2021)
wd_stats <- wd_stats %>%
group_by(country,sector) %>%
mutate(change=growth_rate(year,value)$rate) %>%
mutate(change=round(change*100,1)) %>%
mutate(change=ifelse(change>0,paste0("+",change),paste0(change))) %>%
filter(year==2021)
wd_stats$sector <- as.factor(wd_stats$sector)
wd_stats$sector <- fct_relevel(wd_stats$sector,"Power","Industry","Buildings","Transport")
wd_stats <- wd_stats %>%
arrange(sector) %>%
select(-value,-units,-iso,-year)
wd_stats <- spread(wd_stats,country,change)
write.xlsx(wd_stats,"results/UNEP-Gap-Report-2024-Sector-Demand-Change.xlsx")
wd_stats <- wd_data #%>%
View(wd_stats)
wd_stats <- wd_data %>%
filter(category!="Total") %>%
group_by(country,iso,sector,units,year) %>%
summarise(value=sum(value)) %>%
filter(year>=2017) %>%
filter(year<=2021)
wd_stats <- wd_stats %>%
group_by(country,sector) %>%
mutate(change=growth_rate(year,value)$rate) %>%
mutate(change=round(change*100,1)) %>%
mutate(change=ifelse(change>0,paste0("+",change),paste0(change))) %>%
filter(year==2021)
wd_stats$sector <- as.factor(wd_stats$sector)
wd_stats$sector <- fct_relevel(wd_stats$sector,"Power","Industry","Buildings","Transport")
wd_stats <- wd_stats %>%
arrange(sector) %>%
select(-value,-units,-iso,-year)
wd_stats <- spread(wd_stats,country,change)
write.xlsx(wd_stats,"results/UNEP-Gap-Report-2024-Sector-Demand-Change.xlsx")
wd_stats <- wd_data %>%
filter(category!="Total") %>%
mutate(category_group=ifelse(grepl("Fossil",category,"Fossil","non-Fossil")))
wd_stats <- wd_data %>%
filter(category!="Total") %>%
mutate(category_group=ifelse(grepl("Fossil",category),"Fossil","non-Fossil"))
wd_stats <- wd_data %>%
filter(category!="Total") %>%
mutate(category_group=ifelse(grepl("Fossil",category),"Fossil","non-Fossil")) %>%
filter(year==2021)
wd_stats <- wd_data %>%
filter(category!="Total") %>%
mutate(category_group=ifelse(grepl("Fossil",category),"Fossil","non-Fossil")) %>%
group_by(country,iso,sector,category_group,units,year) %>%
summarise(value=sum(value)) %>%
filter(year>=2017) %>%
filter(year<=2021)
wd_stats <- wd_stats %>%
group_by(country,iso,sector,units,year) %>%
mutate(sector_total=sum(value))
wd_stats <- wd_stats %>%
group_by(country,iso,sector,units,year) %>%
mutate(sector_total=sum(value)) %>%
ungroup() %>%
mutate(sector_ratio=(value/sector_total)*100)
wd_stats <- wd_stats %>%
filter(year==2021) %>%
arrange(sector) %>%
select(-value,-units,-iso,-year)
wd_stats <- wd_data %>%
filter(category!="Total") %>%
mutate(category_group=ifelse(grepl("Fossil",category),"Fossil","non-Fossil")) %>%
group_by(country,iso,sector,category_group,units,year) %>%
summarise(value=sum(value)) %>%
filter(year>=2017) %>%
filter(year<=2021)
wd_stats <- wd_stats %>%
group_by(country,iso,sector,units,year) %>%
mutate(sector_total=sum(value)) %>%
ungroup() %>%
mutate(sector_ratio=(value/sector_total)*100)
wd_stats$sector <- as.factor(wd_stats$sector)
wd_stats$sector <- fct_relevel(wd_stats$sector,"Power","Industry","Buildings","Transport")
wd_stats <- wd_stats %>%
filter(year==2021) %>%
filter(category_share=="Fossil") %>%
arrange(sector) %>%
select(-value,-units,-iso,-year,-category_share)
wd_stats <- wd_stats %>%
filter(year==2021) %>%
filter(category_group=="Fossil") %>%
arrange(sector) %>%
select(-value,-units,-iso,-year,-category_group)
wd_stats <- wd_data %>%
filter(category!="Total") %>%
group_by(country,iso,sector,units,year) %>%
summarise(value=sum(value)) %>%
filter(year>=2017) %>%
filter(year<=2021)
wd_stats <- wd_stats %>%
group_by(country,sector) %>%
mutate(change=growth_rate(year,value)$rate) %>%
mutate(change=round(change*100,1)) %>%
mutate(change=ifelse(change>0,paste0("+",change),paste0(change))) %>%
filter(year==2021)
wd_stats$sector <- as.factor(wd_stats$sector)
wd_stats$sector <- fct_relevel(wd_stats$sector,"Power","Industry","Buildings","Transport")
wd_stats <- wd_stats %>%
arrange(sector) %>%
select(-value,-units,-iso,-year)
wd_stats <- spread(wd_stats,country,change)
write.xlsx(wd_stats,"results/UNEP-Gap-Report-2024-Sector-Demand-Change.xlsx")
## fossil vs non-fossil
wd_stats <- wd_data %>%
filter(category!="Total") %>%
mutate(category_group=ifelse(grepl("Fossil",category),"Fossil","non-Fossil")) %>%
group_by(country,iso,sector,category_group,units,year) %>%
summarise(value=sum(value)) %>%
filter(year>=2017) %>%
filter(year<=2021)
wd_stats <- wd_stats %>%
group_by(country,iso,sector,units,year) %>%
mutate(sector_total=sum(value)) %>%
ungroup() %>%
mutate(sector_ratio=(value/sector_total)*100)
wd_stats$sector <- as.factor(wd_stats$sector)
wd_stats$sector <- fct_relevel(wd_stats$sector,"Power","Industry","Buildings","Transport")
wd_stats <- wd_stats %>%
filter(year==2021) %>%
filter(category_group=="Fossil") %>%
arrange(sector) %>%
select(-value,-units,-iso,-year,-category_group,-sector_total)
wd_stats <- spread(wd_stats,country,sector_ratio)
wd_stats <- wd_data %>%
filter(category!="Total") %>%
group_by(country,iso,sector,units,year) %>%
summarise(value=sum(value)) %>%
filter(year>=2017) %>%
filter(year<=2021)
wd_stats <- wd_stats %>%
group_by(country,sector) %>%
mutate(change=growth_rate(year,value)$rate) %>%
mutate(change=round(change*100,1)) %>%
mutate(change=ifelse(change>0,paste0("+",change),paste0(change))) %>%
filter(year==2021)
wd_stats$sector <- as.factor(wd_stats$sector)
wd_stats$sector <- fct_relevel(wd_stats$sector,"Power","Industry","Buildings","Transport")
wd_stats <- wd_stats %>%
arrange(sector) %>%
select(-value,-units,-iso,-year)
wd_stats <- spread(wd_stats,country,change)
write.xlsx(wd_stats,"results/UNEP-Gap-Report-2024-Sector-Demand-Change.xlsx")
## fossil vs non-fossil
wd_stats <- wd_data %>%
filter(category!="Total") %>%
mutate(category_group=ifelse(grepl("Fossil",category),"Fossil","non-Fossil")) %>%
group_by(country,iso,sector,category_group,units,year) %>%
summarise(value=sum(value)) %>%
filter(year>=2017) %>%
filter(year<=2021)
wd_stats <- wd_stats %>%
group_by(country,iso,sector,units,year) %>%
mutate(sector_total=sum(value)) %>%
ungroup() %>%
mutate(sector_ratio=(value/sector_total)*100) %>%
mutate(sector_ratio=signif(sector_ratio,2))
wd_stats$sector <- as.factor(wd_stats$sector)
wd_stats$sector <- fct_relevel(wd_stats$sector,"Power","Industry","Buildings","Transport")
wd_stats <- wd_stats %>%
filter(year==2021) %>%
filter(category_group=="Fossil") %>%
arrange(sector) %>%
select(-value,-units,-iso,-year,-category_group,-sector_total)
wd_stats <- spread(wd_stats,country,sector_ratio)
wd_stats <- wd_data %>%
filter(category!="Total") %>%
mutate(category_group=ifelse(grepl("Fossil",category),"Fossil","non-Fossil")) %>%
group_by(country,iso,sector,category_group,units,year) %>%
summarise(value=sum(value)) %>%
filter(year>=2017) %>%
filter(year<=2021)
wd_stats <- wd_stats %>%
group_by(country,iso,sector,units,year) %>%
mutate(sector_total=sum(value)) %>%
ungroup() %>%
mutate(sector_ratio=(value/sector_total)*100) %>%
mutate(sector_ratio=signif(sector_ratio,2))
wd_stats$sector <- as.factor(wd_stats$sector)
wd_stats$sector <- fct_relevel(wd_stats$sector,"Power","Industry","Buildings","Transport")
wd_stats <- wd_data %>%
filter(sector=="Power") %>%
filter(category=="Fossil (coal") %>%
filter(year>=2017) %>%
filter(year<=2021)
wd_stats <- wd_data %>%
filter(sector=="Power") %>%
filter(category=="Fossil (coal)") %>%
filter(year>=2017) %>%
filter(year<=2021)
wd_stats <- wd_data %>%
filter(sector=="Power") %>%
filter(category=="Wind and solar") %>%
filter(year>=2017) %>%
filter(year<=2021)
wd_stats <- wd_data %>%
filter(sector=="Power") %>%
filter(category=="Wind and Solar") %>%
filter(year>=2017) %>%
filter(year<=2021)
View(wd_power)
wd_stats <- wd_data %>%
filter(category!="Total") %>%
mutate(category_group=ifelse(grepl("Fossil",category),"Fossil","non-Fossil")) %>%
group_by(country,iso,sector,category_group,units,year) %>%
summarise(value=sum(value)) %>%
filter(year>=2017) %>%
filter(year<=2021)
wd_stats <- wd_stats %>%
group_by(country,iso,sector,units,year) %>%
mutate(sector_total=sum(value)) %>%
ungroup() %>%
mutate(sector_ratio=(value/sector_total)*100) %>%
mutate(sector_ratio=signif(sector_ratio,2))
wd_stats$sector <- as.factor(wd_stats$sector)
wd_stats$sector <- fct_relevel(wd_stats$sector,"Power","Industry","Buildings","Transport")
wd_stats <- wd_stats %>%
filter(year==2021) %>%
filter(category_group=="Fossil") %>%
arrange(sector) %>%
select(-value,-units,-iso,-year,-category_group,-sector_total)
wd_stats <- spread(wd_stats,country,sector_ratio)
View(wd_power)
wd_stats <- wd_data %>%
filter(category!="Total") %>%
mutate(category_group=ifelse(grepl("Wind and Solar",category),"Wind and Solar","Other")) %>%
group_by(country,iso,sector,category_group,units,year) %>%
summarise(value=sum(value)) %>%
filter(year>=2017) %>%
filter(year<=2021)
wd_stats <- wd_data %>%
filter(category!="Total") %>%
mutate(category_group=ifelse(grepl("Wind and Solar",category),"Wind and Solar","Other")) %>%
group_by(country,iso,sector,category_group,units,year) %>%
summarise(value=sum(value)) %>%
filter(year>=2018) %>%
filter(year<=2022)
wd_stats <- wd_data %>%
filter(category!="Total") %>%
mutate(category_group=ifelse(grepl("Fossil",category),"Fossil","non-Fossil")) %>%
group_by(country,iso,sector,category_group,units,year) %>%
summarise(value=sum(value)) %>%
filter(year>=2018) %>%
filter(year<=2022)
wd_stats <- wd_stats %>%
group_by(country,iso,sector,units,year) %>%
mutate(sector_total=sum(value)) %>%
ungroup() %>%
mutate(sector_ratio=(value/sector_total)*100) %>%
mutate(sector_ratio=signif(sector_ratio,2))
wd_stats$sector <- as.factor(wd_stats$sector)
wd_stats$sector <- fct_relevel(wd_stats$sector,"Power","Industry","Buildings","Transport")
wd_stats <- wd_stats %>%
filter(year==2022) %>%
filter(category_group=="Fossil") %>%
arrange(sector) %>%
select(-value,-units,-iso,-year,-category_group,-sector_total)
wd_stats <- spread(wd_stats,country,sector_ratio)
wd_stats <- wd_data %>%
filter(category!="Total") %>%
mutate(category_group=ifelse(grepl("Fossil",category),"Fossil","non-Fossil")) %>%
group_by(country,iso,sector,category_group,units,year) %>%
summarise(value=sum(value)) %>%
filter(year>=2018) %>%
filter(year<=2022)
wd_stats <- wd_stats %>%
group_by(country,iso,sector,units,year) %>%
mutate(sector_total=sum(value)) %>%
ungroup() %>%
mutate(sector_ratio=(value/sector_total)*100) %>%
mutate(sector_ratio=signif(sector_ratio,2))
wd_stats$sector <- as.factor(wd_stats$sector)
wd_stats$sector <- fct_relevel(wd_stats$sector,"Power","Industry","Buildings","Transport")
wd_stats <- wd_data %>%
filter(category!="Total") %>%
mutate(category_group=ifelse(grepl("Wind and Solar",category),"Wind and Solar","Other")) %>%
group_by(country,iso,sector,category_group,units,year) %>%
summarise(value=sum(value)) %>%
filter(year>=2018) %>%
filter(year<=2022)
wd_stats <- wd_stats %>%
group_by(country,iso,sector,units,year) %>%
mutate(sector_total=sum(value)) %>%
ungroup() %>%
mutate(sector_ratio=(value/sector_total)*100) %>%
mutate(sector_ratio=signif(sector_ratio,2))
wd_stats <- wd_data %>%
filter(sector=="Power") %>%
filter(category!="Total") %>%
mutate(category_group=ifelse(grepl("Wind and Solar",category),"Wind and Solar","Other")) %>%
group_by(country,iso,sector,category_group,units,year) %>%
summarise(value=sum(value)) %>%
filter(year>=2018) %>%
filter(year<=2022)
wd_stats <- wd_stats %>%
group_by(country,iso,sector,units,year) %>%
mutate(sector_total=sum(value)) %>%
ungroup() %>%
mutate(sector_ratio=(value/sector_total)*100) %>%
mutate(sector_ratio=signif(sector_ratio,2))
wd_stats$sector <- as.factor(wd_stats$sector)
wd_stats$sector <- fct_relevel(wd_stats$sector,"Power","Industry","Buildings","Transport")
wd_stats <- wd_stats %>%
filter(year==2022) %>%
filter(category_group=="Wind and Solar") %>%
arrange(sector) %>%
select(-value,-units,-iso,-year,-category_group,-sector_total)
wd_stats <- spread(wd_stats,country,sector_ratio)
wd_stats <- wd_ember
View(wd_stats)
wd_stats <- wd_ember
wd_stats <- wd_ember %>%
filter(category!="Total") %>%
mutate(category_group=ifelse(grepl("Wind and Solar",category),"Wind and Solar","Other")) %>%
group_by(country,iso,sector,category_group,units,year) %>%
summarise(value=sum(value)) %>%
filter(year>=2018) %>%
filter(year<=2022)
wd_stats <- wd_ember %>%
filter(category!="Total") %>%
mutate(category_group=ifelse(grepl("Wind and Solar",category),"Wind and Solar","Other")) %>%
group_by(country,sector,category_group,units,year) %>%
summarise(value=sum(value)) %>%
filter(year<=2022)
wd_stats <- wd_stats %>%
group_by(country,sector,units,year) %>%
mutate(sector_total=sum(value)) %>%
ungroup() %>%
mutate(sector_ratio=(value/sector_total)*100) %>%
mutate(sector_ratio=signif(sector_ratio,2))
wd_stats <- wd_stats %>%
filter(category_group=="Wind and Solar") %>%
arrange(desc(sector_ratio))
wd_stats <- wd_ember %>%
filter(category!="Total") %>%
mutate(category_group=ifelse(grepl("Wind and Solar",category),"Wind and Solar","Other")) %>%
group_by(country,sector,category_group,units,year) %>%
summarise(value=sum(value)) %>%
filter(year<=2022)
wd_stats <- wd_stats %>%
group_by(country,sector,units,year) %>%
mutate(sector_total=sum(value)) %>%
ungroup() %>%
mutate(sector_ratio=(value/sector_total)*100) %>%
mutate(sector_ratio=signif(sector_ratio,2))
wd_stats <- wd_stats %>%
filter(year==2022)
filter(category_group=="Wind and Solar") %>%
arrange(desc(sector_ratio))
wd_stats <- wd_stats %>%
filter(year==2022) %>%
filter(category_group=="Wind and Solar") %>%
arrange(desc(sector_ratio))
