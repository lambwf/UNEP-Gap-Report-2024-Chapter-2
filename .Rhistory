data_ghg <- left_join(data_ghg,read.xlsx("sources/cc_sectors.xlsx"),by=join_by(code, code_description))
data_ghg$gas <- as.factor(data_ghg$gas)
data_ghg$gas <- fct_relevel(data_ghg$gas,"CO2","CH4","N2O","Fgases")
data_ghg$sector_tier_2 <- as.factor(data_ghg$sector_tier_2)
data_ghg$sector_tier_2 <- fct_reorder(data_ghg$sector_tier_2,data_ghg$sector_tier_2_order)
data_ghg <- data_ghg %>%
mutate(year=as.numeric(year)) %>%
group_by(iso,country,sector_tier_1,sector_tier_2,sector_tier_2_codes,sector_tier_3,gas,year) %>%
summarise(value=sum(value,na.rm=TRUE))
## aggregate EU
data_ghg_eu <- left_join(data_ghg,cc_EU,by="iso") %>%
filter(is.na(EU)) %>%
mutate(iso="EU27") %>%
select(-EU) %>%
mutate(country="European Union") #%>%
## aggregate EU
data_ghg_eu <- left_join(data_ghg,cc_EU,by="iso") %>%
filter(is.na(EU)) %>%
mutate(iso="EU27") %>%
select(-EU) %>%
mutate(country="European Union") %>%
group_by(iso,country,sector_tier_1,sector_tier_2,sector_tier_2_codes,sector_tier_3,gas,year) %>%
summarise(value=sum(value,na.rm=T))
blarg <- data_ghg_eu %>%
group_by(year) %>% summarise(value=sum(value))
View(blarg)
blarg <- data_ghg_eu %>%
group_by(year) %>% summarise(value=sum(value)/1e9)
blarg <- data_ghg_eu %>%
group_by(year) %>% summarise(value=sum(value)/1e6)
## aggregate EU
data_ghg_eu <- left_join(data_ghg,cc_EU,by="iso") %>%
filter(is.na(EU)) %>%
mutate(iso="EU27") %>%
select(-EU) %>%
mutate(country="European Union")# %>%
## aggregate EU
data_ghg_eu <- left_join(data_ghg,cc_EU,by="iso")# %>%
## aggregate EU
data_ghg_eu <- left_join(data_ghg,cc_EU,by="iso") %>%
filter(year==2021)
## aggregate EU
data_ghg_eu <- left_join(data_ghg,cc_EU,by="iso") %>%
filter(year==2021) %>%
filter(is.na(EU)) #%>%
## aggregate EU
data_ghg_eu <- left_join(data_ghg,cc_EU,by="iso") %>%
filter(!is.na(EU)) %>%
mutate(iso="EU27") %>%
select(-EU) %>%
mutate(country="European Union") %>%
group_by(iso,country,sector_tier_1,sector_tier_2,sector_tier_2_codes,sector_tier_3,gas,year) %>%
summarise(value=sum(value,na.rm=T))
blarg <- data_ghg_eu %>%
group_by(year) %>% summarise(value=sum(value)/1e6)
View(blarg)
## load EDGAR data (https://edgar.jrc.ec.europa.eu/dataset_ghg80)
data_edgar_co2_ffi <- read.xlsx("sources/IEA_EDGAR_CO2_1970_2022.xlsx",sheet=2,startRow = 10)
data_edgar_co2_ffi <- gather(data_edgar_co2_ffi,year,value,Y_1970:Y_2022)
data_edgar_co2_ffi$year <- gsub("Y_","",data_edgar_co2_ffi$year)
data_edgar_co2_ffi <- data_edgar_co2_ffi %>%
select(iso=Country_code_A3,country=Name,code=ipcc_code_2006_for_standard_report,code_description=ipcc_code_2006_for_standard_report_name,gas=Substance,fossil_bio,year,value)
data_edgar_ch4 <- read.xlsx("sources/EDGAR_CH4_1970_2022.xlsx",sheet=2,startRow = 10)
data_edgar_ch4 <- gather(data_edgar_ch4,year,value,Y_1970:Y_2022)
data_edgar_ch4$year <- gsub("Y_","",data_edgar_ch4$year)
data_edgar_ch4 <- data_edgar_ch4 %>%
select(iso=Country_code_A3,country=Name,code=ipcc_code_2006_for_standard_report,code_description=ipcc_code_2006_for_standard_report_name,gas=Substance,fossil_bio,year,value)
data_edgar_n2o <- read.xlsx("sources/EDGAR_N2O_1970_2022.xlsx",sheet=2,startRow = 10)
data_edgar_n2o <- gather(data_edgar_n2o,year,value,Y_1970:Y_2022)
data_edgar_n2o$year <- gsub("Y_","",data_edgar_n2o$year)
data_edgar_n2o <- data_edgar_n2o %>%
select(iso=Country_code_A3,country=Name,code=ipcc_code_2006_for_standard_report,code_description=ipcc_code_2006_for_standard_report_name,gas=Substance,fossil_bio,year,value)
data_edgar_fgas <- read.xlsx("sources/EDGAR_F-gases_1990_2022.xlsx",sheet=2,startRow = 10)
data_edgar_fgas <- gather(data_edgar_fgas,year,value,Y_1990:Y_2022)
data_edgar_fgas$year <- gsub("Y_","",data_edgar_fgas$year)
data_edgar_fgas <- data_edgar_fgas %>%
select(iso=Country_code_A3,country=Name,code=ipcc_code_2006_for_standard_report,code_description=ipcc_code_2006_for_standard_report_name,gas=Substance,fossil_bio,year,value)
data_edgar <- rbind(data_edgar_co2_ffi,data_edgar_ch4)
data_edgar <- rbind(data_edgar,data_edgar_n2o)
data_edgar <- rbind(data_edgar,data_edgar_fgas)
data_edgar$year <- as.numeric(data_edgar$year)
## join GWPs and calculate CO2e
gwps <- read.csv("https://raw.githubusercontent.com/openclimatedata/globalwarmingpotentials/main/globalwarmingpotentials.csv",skip = 9)
data_edgar$gas <- gsub("-","",data_edgar$gas)
data_edgar <- left_join(data_edgar,gwps %>% select(gas=Species,AR6GWP100)) %>%
mutate(AR6GWP100=ifelse(gas=="CO2",1,AR6GWP100))
# check all gwps joined
check <- data_edgar %>% filter(is.na(AR6GWP100))
check <- data_edgar %>% select(gas,AR6GWP100) %>% distinct()
data_edgar <- data_edgar %>%
mutate(value_gwp=value*AR6GWP100)
# list_fgases <- data.frame(gas=unique(data_edgar$gas))
# list_fgases <- list_fgases %>%
#   mutate(group=ifelse(grepl("CFC",gas),"ODS F-gases",NA)) %>%
#   mutate(group=ifelse(grepl("HCFC",gas),"ODS F-gases",group)) %>%
#   mutate(group=ifelse(grepl("HFC",gas),"UNFCCC F-gases",group)) %>%
#   mutate(group=ifelse(grepl("Halon",gas),"ODS F-gases",group)) %>%
#   mutate(group=ifelse(grepl("NF3",gas),"UNFCCC F-gases",group)) %>%
#   mutate(group=ifelse(grepl("SF6",gas),"UNFCCC F-gases",group)) #%>%
#   mutate(group=ifelse(is.na(group),"UNFCCC F-gases",group))
list_fgases <- data_edgar %>%
select(gas) %>%
distinct() %>%
mutate(group=ifelse(gas=="CO2","CO2",NA)) %>%
mutate(group=ifelse(gas=="CH4","CH4",group)) %>%
mutate(group=ifelse(gas=="N2O","N2O",group)) %>%
mutate(group=ifelse(is.na(group),"Fgases",group))
data_edgar <- left_join(data_edgar,list_fgases,by="gas")
data_edgar <- data_edgar %>%
mutate(gas=group) %>%
group_by(iso,country,code,code_description,gas,year) %>%
summarise(value=sum(value_gwp,na.rm=TRUE))
## Gg to tons
data_edgar$value = data_edgar$value*1000
# check global totals
check <- data_edgar %>% filter(year==2022) %>% group_by(gas) %>% summarise(value=sum(value,na.rm=T))
## Grassi et al. LULUCF data (https://zenodo.org/records/7190601)
data_lulucf <- read.xlsx('sources/LULUCF NGHGI database August 2022.xlsx',sheet=7,startRow = 5)
data_lulucf <- data_lulucf %>%
rename(country=X1) %>%
mutate(iso=countrycode(country,"country.name","iso3c"))
data_lulucf <- gather(data_lulucf,year,value,-country,-iso)
data_lulucf <- data_lulucf %>%
mutate(year=as.numeric(year)) %>%
filter(!is.na(year)) %>%
mutate(value=as.numeric(value)) %>%
mutate(value=value*1e6) %>%
mutate(code="3B") %>%
mutate(code_description="Land use change") %>%
mutate(gas="CO2") %>%
select(iso,country,code,code_description,gas,year,value)
data_ghg <- rbind(data_edgar,data_lulucf)
### consistent names
newnames <- data_ghg %>%
ungroup() %>%
select(iso) %>%
distinct() %>%
mutate(newname=countrycode(iso,"iso3c","country.name")) %>%
mutate(newname=ifelse(iso=="AIR","Intl. Aviation",newname)) %>%
mutate(newname=ifelse(iso=="SEA","Intl. Shipping",newname)) %>%
mutate(newname=ifelse(iso=="SCG","Serbia and Montenegro",newname)) %>%
mutate(newname=ifelse(iso=="ANT","Netherlands Antilles",newname))
data_ghg <- left_join(data_ghg,newnames,by="iso") %>%
mutate(country=newname) %>%
select(-newname) %>%
filter(!is.na(iso))
### aggregate sectors
write.xlsx(data_ghg %>% ungroup() %>% select(code,code_description) %>% distinct() %>% arrange(code),"cc_sectors.xlsx")
data_ghg <- left_join(data_ghg,read.xlsx("sources/cc_sectors.xlsx"),by=join_by(code, code_description))
data_ghg$gas <- as.factor(data_ghg$gas)
data_ghg$gas <- fct_relevel(data_ghg$gas,"CO2","CH4","N2O","Fgases")
data_ghg$sector_tier_2 <- as.factor(data_ghg$sector_tier_2)
data_ghg$sector_tier_2 <- fct_reorder(data_ghg$sector_tier_2,data_ghg$sector_tier_2_order)
data_ghg <- data_ghg %>%
mutate(year=as.numeric(year)) %>%
group_by(iso,country,sector_tier_1,sector_tier_2,sector_tier_2_codes,sector_tier_3,gas,year) %>%
summarise(value=sum(value,na.rm=TRUE))
## aggregate EU
data_ghg_eu <- left_join(data_ghg,cc_EU,by="iso") %>%
filter(!is.na(EU)) %>%
mutate(iso="EU27") %>%
select(-EU) %>%
mutate(country="European Union") %>%
group_by(iso,country,sector_tier_1,sector_tier_2,sector_tier_2_codes,sector_tier_3,gas,year) %>%
summarise(value=sum(value,na.rm=T))
data_ghg <- rbind(data_ghg,data_ghg_eu)
top_emitters <- data_ghg %>%
filter(year==2022) %>%
group_by(iso) %>%
summarise(value=sum(value)) %>%
arrange(desc(value))
View(top_emitters)
data_world <- data_ghg %>%
filter(year>=1990) %>%
rename(sector=sector_tier_2) %>%
group_by(sector,year) %>%
summarise(value=sum(value,na.rm=TRUE)/1e6)
labels <- read.xlsx("sources/cc_sectors.xlsx",sheet=2)
labels <- labels %>%
arrange(desc(position)) %>%
mutate(position=1) %>%
mutate(position=cumsum(position))
labels$sector <- fct_reorder(labels$sector,labels$position)
data_countries$sector <- fct_relevel(data_countries$sector,"Land use")
labels <- read.xlsx("sources/cc_sectors.xlsx",sheet=2)
labels <- labels %>%
arrange(desc(position)) %>%
mutate(position=1) %>%
mutate(position=cumsum(position))
labels$sector <- fct_reorder(labels$sector,labels$position)
data_world$sector <- fct_relevel(data_world$sector,"Land use")
my_colours <- labels %>% select(sector,colour)
my_colours$sector <- gsub("   ","",my_colours$sector)
my_colours <- left_join(data_world %>%
ungroup() %>%
select(sector) %>%
distinct() %>%
arrange(sector),my_colours)
p1 <- data_world %>% ggplot(aes(x=year,y=value,fill=sector)) +
geom_area(color="#636363") +
theme_wl() +
scale_fill_manual(values = my_colours$colour) +
ylab("GHG Emissions (MtCO2e/year)") +
theme(axis.title.x = element_blank(),
panel.grid.major.x = element_blank(),
panel.border = element_blank(),
axis.line.x=element_line(colour='#636363'),
axis.line.y=element_line(colour='#636363'),
legend.position = "none",panel.background = element_blank())
p2 <- labels %>%  ggplot(.,aes(y=position,label=sector)) +
geom_point(aes(x=ifelse(sector %in% c("Energy","Industrial processes","AFOLU","Waste & Other"),1.9,2),fill=sector),
shape=22,size=3,color='#636363') +
geom_text(hjust=0,aes(x=2.1),color='#636363',vjust=0.5) +
geom_vline(xintercept = 4,color='#636363') +
theme_wl() +
#scale_color_manual(values = c("white",'#636363','#636363','#636363','#636363','#636363','#636363','#636363','#636363','#636363','#636363')) +
scale_fill_manual(values = c(labels$colour)) +
scale_x_continuous(limits=c(1.9,4)) +
theme(axis.title = element_blank(),
panel.border = element_blank(),
legend.position="none",
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks = element_blank(),
panel.grid.major = element_blank(),
plot.background = element_blank(),
plot.margin = unit(c(0,0,0,0),"cm"))
p1 + p2
View(data_world)
## replace land use emissions
data_world <- data_world %>%
filter(sector!="Land use")
View(data_gcb_co2_luc)
data_world <- rbind(data_world,data_gcb_co2_luc %>% select(year,value) %>% filter(year>=1990) %>% mutate(sector="Land use"))
## replace land use emissions
data_world <- data_world %>%
filter(sector!="Land use")
data_world <- rbind(data_world,data_gcb_co2_luc %>% select(year,value=mean) %>% filter(year>=1990) %>% mutate(sector="Land use"))
data_world <- rbind(data_world,data_gcb_co2_luc %>% select(year,value=mean) %>% filter(year>=1990) %>% mutate(sector="Land use") %>% mutate(year=as.numeric(year)))
View(data_gcb_co2_luc)
data_world <- data_ghg %>%
filter(year>=1990) %>%
rename(sector=sector_tier_2) %>%
group_by(sector,year) %>%
summarise(value=sum(value,na.rm=TRUE)/1e9)
## replace land use emissions
data_world <- data_world %>%
filter(sector!="Land use")
data_world <- rbind(data_world,data_gcb_co2_luc %>% select(year,value=mean) %>% filter(year>=1990) %>% mutate(sector="Land use") %>% mutate(year=as.numeric(year)))
labels <- read.xlsx("sources/cc_sectors.xlsx",sheet=2)
labels <- labels %>%
arrange(desc(position)) %>%
mutate(position=1) %>%
mutate(position=cumsum(position))
labels$sector <- fct_reorder(labels$sector,labels$position)
## GHG emissions trend plot
data_world <- data_ghg %>%
filter(year>=1990) %>%
rename(sector=sector_tier_2) %>%
group_by(sector,year) %>%
summarise(value=sum(value,na.rm=TRUE)/1e9)
## replace land use emissions
data_world <- data_world %>%
filter(sector!="Land use")
data_world <- rbind(data_world,data_gcb_co2_luc %>% select(year,value=mean) %>% filter(year>=1990) %>% mutate(sector="Land use") %>% mutate(year=as.numeric(year)))
labels <- read.xlsx("sources/cc_sectors.xlsx",sheet=2)
labels <- labels %>%
arrange(desc(position)) %>%
mutate(position=1) %>%
mutate(position=cumsum(position))
labels$sector <- fct_reorder(labels$sector,labels$position)
data_world$sector <- fct_relevel(data_world$sector,"Land use")
my_colours <- labels %>% select(sector,colour)
my_colours$sector <- gsub("   ","",my_colours$sector)
my_colours <- left_join(data_world %>%
ungroup() %>%
select(sector) %>%
distinct() %>%
arrange(sector),my_colours)
p1 <- data_world %>% ggplot(aes(x=year,y=value,fill=sector)) +
geom_area(color="#636363") +
theme_wl() +
scale_fill_manual(values = my_colours$colour) +
ylab("GHG Emissions (MtCO2e/year)") +
theme(axis.title.x = element_blank(),
panel.grid.major.x = element_blank(),
panel.border = element_blank(),
axis.line.x=element_line(colour='#636363'),
axis.line.y=element_line(colour='#636363'),
legend.position = "none",panel.background = element_blank())
p2 <- labels %>%  ggplot(.,aes(y=position,label=sector)) +
geom_point(aes(x=ifelse(sector %in% c("Energy","Industrial processes","AFOLU","Waste & Other"),1.9,2),fill=sector),
shape=22,size=3,color='#636363') +
geom_text(hjust=0,aes(x=2.1),color='#636363',vjust=0.5) +
geom_vline(xintercept = 4,color='#636363') +
theme_wl() +
#scale_color_manual(values = c("white",'#636363','#636363','#636363','#636363','#636363','#636363','#636363','#636363','#636363','#636363')) +
scale_fill_manual(values = c(labels$colour)) +
scale_x_continuous(limits=c(1.9,4)) +
theme(axis.title = element_blank(),
panel.border = element_blank(),
legend.position="none",
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks = element_blank(),
panel.grid.major = element_blank(),
plot.background = element_blank(),
plot.margin = unit(c(0,0,0,0),"cm"))
p1 + p2
## replace land use emissions
data_world <- data_world %>%
filter(sector!="Land use")
data_world <- data_ghg %>%
filter(year>=1990) %>%
rename(sector=sector_tier_2) %>%
group_by(sector,year) %>%
summarise(value=sum(value,na.rm=TRUE)/1e9)
## replace land use emissions
data_world <- data_world %>%
filter(sector!="Land use")
## GHG emissions trend plot
data_world <- data_ghg %>%
filter(year>=1990) %>%
rename(sector=sector_tier_2) %>%
group_by(sector,year) %>%
summarise(value=sum(value,na.rm=TRUE)/1e9)
## replace land use emissions
data_world <- data_world %>%
filter(sector!="Land use")
data_world <- rbind(data_world,data_gcb_co2_luc %>% filter(year>=1990) %>% group_by(year) %>% summarise(value=sum(mean,na.rm=T)) %>% mutate(sector="Land use") %>% mutate(year=as.numeric(year)))
labels <- read.xlsx("sources/cc_sectors.xlsx",sheet=2)
labels <- labels %>%
arrange(desc(position)) %>%
mutate(position=1) %>%
mutate(position=cumsum(position))
labels$sector <- fct_reorder(labels$sector,labels$position)
data_world$sector <- fct_relevel(data_world$sector,"Land use")
my_colours <- labels %>% select(sector,colour)
my_colours$sector <- gsub("   ","",my_colours$sector)
my_colours <- left_join(data_world %>%
ungroup() %>%
select(sector) %>%
distinct() %>%
arrange(sector),my_colours)
p1 <- data_world %>% ggplot(aes(x=year,y=value,fill=sector)) +
geom_area(color="#636363") +
theme_wl() +
scale_fill_manual(values = my_colours$colour) +
ylab("GHG Emissions (MtCO2e/year)") +
theme(axis.title.x = element_blank(),
panel.grid.major.x = element_blank(),
panel.border = element_blank(),
axis.line.x=element_line(colour='#636363'),
axis.line.y=element_line(colour='#636363'),
legend.position = "none",panel.background = element_blank())
p2 <- labels %>%  ggplot(.,aes(y=position,label=sector)) +
geom_point(aes(x=ifelse(sector %in% c("Energy","Industrial processes","AFOLU","Waste & Other"),1.9,2),fill=sector),
shape=22,size=3,color='#636363') +
geom_text(hjust=0,aes(x=2.1),color='#636363',vjust=0.5) +
geom_vline(xintercept = 4,color='#636363') +
theme_wl() +
#scale_color_manual(values = c("white",'#636363','#636363','#636363','#636363','#636363','#636363','#636363','#636363','#636363','#636363')) +
scale_fill_manual(values = c(labels$colour)) +
scale_x_continuous(limits=c(1.9,4)) +
theme(axis.title = element_blank(),
panel.border = element_blank(),
legend.position="none",
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks = element_blank(),
panel.grid.major = element_blank(),
plot.background = element_blank(),
plot.margin = unit(c(0,0,0,0),"cm"))
p1 + p2
blarg <- data_gcb_co2_luc %>% group_by(year) %>% summarise(mean=sum(mean,na.rm=TRUE))
View(blarg)
knitr::opts_chunk$set(echo = FALSE)
rm(list = ls())
library(tidyverse)
library(openxlsx)
library(countrycode)
library(ggrepel)
library(patchwork)
library(zoo)
library(RColorBrewer)
library(WDI)
library(labelled)
library(grid)
source("https://raw.githubusercontent.com/lambwf/Codebase/main/figure_style.R")
source("https://raw.githubusercontent.com/lambwf/Codebase/main/reshape_with_labels.R")
source("https://raw.githubusercontent.com/lambwf/Codebase/main/locate_shares.R")
source("https://raw.githubusercontent.com/lambwf/Codebase/main/load_gcb_countries_v2023.R")
cc_EU <- read.csv("https://raw.githubusercontent.com/openclimatedata/countrygroups/main/data/european-union.csv") %>%
select(iso=Code) %>%
mutate(EU="EU27")
data_edgar_co2_ffi <- read.xlsx("sources/IEA_EDGAR_CO2_1970_2022.xlsx",sheet=2,startRow = 10)
data_edgar_co2_ffi <- gather(data_edgar_co2_ffi,year,value,Y_1970:Y_2022)
data_edgar_co2_ffi$year <- gsub("Y_","",data_edgar_co2_ffi$year)
data_edgar_co2_ffi <- data_edgar_co2_ffi %>%
select(iso=Country_code_A3,country=Name,code=ipcc_code_2006_for_standard_report,code_description=ipcc_code_2006_for_standard_report_name,gas=Substance,fossil_bio,year,value)
data_edgar_ch4 <- read.xlsx("sources/EDGAR_CH4_1970_2022.xlsx",sheet=2,startRow = 10)
data_edgar_ch4 <- gather(data_edgar_ch4,year,value,Y_1970:Y_2022)
data_edgar_ch4$year <- gsub("Y_","",data_edgar_ch4$year)
data_edgar_ch4 <- data_edgar_ch4 %>%
select(iso=Country_code_A3,country=Name,code=ipcc_code_2006_for_standard_report,code_description=ipcc_code_2006_for_standard_report_name,gas=Substance,fossil_bio,year,value)
data_edgar_n2o <- read.xlsx("sources/EDGAR_N2O_1970_2022.xlsx",sheet=2,startRow = 10)
data_edgar_n2o <- gather(data_edgar_n2o,year,value,Y_1970:Y_2022)
data_edgar_n2o$year <- gsub("Y_","",data_edgar_n2o$year)
data_edgar_n2o <- data_edgar_n2o %>%
select(iso=Country_code_A3,country=Name,code=ipcc_code_2006_for_standard_report,code_description=ipcc_code_2006_for_standard_report_name,gas=Substance,fossil_bio,year,value)
data_edgar_fgas <- read.xlsx("sources/EDGAR_F-gases_1990_2022.xlsx",sheet=2,startRow = 10)
data_edgar_fgas <- gather(data_edgar_fgas,year,value,Y_1990:Y_2022)
data_edgar_fgas$year <- gsub("Y_","",data_edgar_fgas$year)
data_edgar_fgas <- data_edgar_fgas %>%
select(iso=Country_code_A3,country=Name,code=ipcc_code_2006_for_standard_report,code_description=ipcc_code_2006_for_standard_report_name,gas=Substance,fossil_bio,year,value)
data_edgar <- rbind(data_edgar_co2_ffi,data_edgar_ch4)
data_edgar <- rbind(data_edgar,data_edgar_n2o)
data_edgar <- rbind(data_edgar,data_edgar_fgas)
data_edgar$year <- as.numeric(data_edgar$year)
gwps <- read.csv("https://raw.githubusercontent.com/openclimatedata/globalwarmingpotentials/main/globalwarmingpotentials.csv",skip = 9)
data_edgar$gas <- gsub("-","",data_edgar$gas)
data_edgar <- left_join(data_edgar,gwps %>% select(gas=Species,AR6GWP100)) %>%
mutate(AR6GWP100=ifelse(gas=="CO2",1,AR6GWP100))
# check all gwps joined
check <- data_edgar %>% filter(is.na(AR6GWP100))
check <- data_edgar %>% select(gas,AR6GWP100) %>% distinct()
data_edgar <- data_edgar %>%
mutate(value_gwp=value*AR6GWP100)
# list_fgases <- data.frame(gas=unique(data_edgar$gas))
# list_fgases <- list_fgases %>%
#   mutate(group=ifelse(grepl("CFC",gas),"ODS F-gases",NA)) %>%
#   mutate(group=ifelse(grepl("HCFC",gas),"ODS F-gases",group)) %>%
#   mutate(group=ifelse(grepl("HFC",gas),"UNFCCC F-gases",group)) %>%
#   mutate(group=ifelse(grepl("Halon",gas),"ODS F-gases",group)) %>%
#   mutate(group=ifelse(grepl("NF3",gas),"UNFCCC F-gases",group)) %>%
#   mutate(group=ifelse(grepl("SF6",gas),"UNFCCC F-gases",group)) #%>%
#   mutate(group=ifelse(is.na(group),"UNFCCC F-gases",group))
list_fgases <- data_edgar %>%
select(gas) %>%
distinct() %>%
mutate(group=ifelse(gas=="CO2","CO2",NA)) %>%
mutate(group=ifelse(gas=="CH4","CH4",group)) %>%
mutate(group=ifelse(gas=="N2O","N2O",group)) %>%
mutate(group=ifelse(is.na(group),"Fgases",group))
data_edgar <- left_join(data_edgar,list_fgases,by="gas")
data_edgar <- data_edgar %>%
mutate(gas=group) %>%
group_by(iso,country,code,code_description,gas,year) %>%
summarise(value=sum(value_gwp,na.rm=TRUE))
## Gg to tons
data_edgar$value = data_edgar$value*1000
# check global totals
check <- data_edgar %>% filter(year==2022) %>% group_by(gas) %>% summarise(value=sum(value,na.rm=T))
## Grassi et al. LULUCF data (https://zenodo.org/records/7190601)
data_lulucf <- read.xlsx('sources/LULUCF NGHGI database August 2022.xlsx',sheet=7,startRow = 5)
data_lulucf <- data_lulucf %>%
rename(country=X1) %>%
mutate(iso=countrycode(country,"country.name","iso3c"))
data_lulucf <- gather(data_lulucf,year,value,-country,-iso)
data_lulucf <- data_lulucf %>%
mutate(year=as.numeric(year)) %>%
filter(!is.na(year)) %>%
mutate(value=as.numeric(value)) %>%
mutate(value=value*1e6) %>%
mutate(code="3B") %>%
mutate(code_description="Land use change") %>%
mutate(gas="CO2") %>%
select(iso,country,code,code_description,gas,year,value)
data_ghg <- rbind(data_edgar,data_lulucf)
### consistent names
newnames <- data_ghg %>%
ungroup() %>%
select(iso) %>%
distinct() %>%
mutate(newname=countrycode(iso,"iso3c","country.name")) %>%
mutate(newname=ifelse(iso=="AIR","Intl. Aviation",newname)) %>%
mutate(newname=ifelse(iso=="SEA","Intl. Shipping",newname)) %>%
mutate(newname=ifelse(iso=="SCG","Serbia and Montenegro",newname)) %>%
mutate(newname=ifelse(iso=="ANT","Netherlands Antilles",newname))
data_ghg <- left_join(data_ghg,newnames,by="iso") %>%
mutate(country=newname) %>%
select(-newname) %>%
filter(!is.na(iso))
### aggregate sectors
write.xlsx(data_ghg %>% ungroup() %>% select(code,code_description) %>% distinct() %>% arrange(code),"cc_sectors.xlsx")
data_ghg <- left_join(data_ghg,read.xlsx("sources/cc_sectors.xlsx"),by=join_by(code, code_description))
data_ghg$gas <- as.factor(data_ghg$gas)
data_ghg$gas <- fct_relevel(data_ghg$gas,"CO2","CH4","N2O","Fgases")
data_ghg$sector_tier_2 <- as.factor(data_ghg$sector_tier_2)
data_ghg$sector_tier_2 <- fct_reorder(data_ghg$sector_tier_2,data_ghg$sector_tier_2_order)
data_ghg <- data_ghg %>%
mutate(year=as.numeric(year)) %>%
group_by(iso,country,sector_tier_1,sector_tier_2,sector_tier_2_codes,sector_tier_3,gas,year) %>%
summarise(value=sum(value,na.rm=TRUE))
## aggregate EU
data_ghg_eu <- left_join(data_ghg,cc_EU,by="iso") %>%
filter(!is.na(EU)) %>%
mutate(iso="EU27") %>%
select(-EU) %>%
mutate(country="European Union") %>%
group_by(iso,country,sector_tier_1,sector_tier_2,sector_tier_2_codes,sector_tier_3,gas,year) %>%
summarise(value=sum(value,na.rm=T))
data_ghg <- rbind(data_ghg,data_ghg_eu)
data_wdi_pop<-WDI(country = "all",indicator = "SP.POP.TOTL",start = 1970,end = 2022,extra=TRUE,language = "en")%>%
select(iso3c, country, year, SP.POP.TOTL) %>%
filter(!is.na(iso3c))
data_wdi_pop$population <- data_wdi_pop$SP.POP.TOTL
data_wdi_pop$iso <- data_wdi_pop$iso3c
data_wdi_pop<-data_wdi_pop %>% select(-SP.POP.TOTL,-iso3c)
## Global Carbon Project CO2 FFI (https://globalcarbonbudget.org/carbonbudget2023/)
data_gcb_co2_ffi <- load_gcb_countries_ffi(read.xlsx("sources/National_Fossil_Carbon_Emissions_2023v1.0.xlsx",sheet=2,startRow = 12))
data_gcb_co2_ffi$iso[grepl("Türkiye",data_gcb_co2_ffi$country)] <- "TUR"
