data_changes$change_abs[data_changes$year == i & data_changes$country == countries[j]] <-
data_changes$value[data_changes$year == i & data_changes$country == countries[j]] -
data_changes$value[data_changes$year == i - 1 & data_changes$country == countries[j]]
}
}
data_changes %>%
filter(year>=2015) %>%
mutate(year=as.factor(year)) %>%
ggplot(.,aes(x=year,y=change_abs)) +
geom_col(color="#636363") +
geom_hline(yintercept=0) +
geom_point(data=data_changes %>% filter(year>=2015) %>% mutate(year=as.factor(year)) %>%  group_by(year) %>% summarise(change_abs=sum(change_abs)),
inherit.aes=FALSE,aes(x=year,y=change_abs)) +
theme_wl() +
labs(title="Change in total emissions by year and country",
subtitle="GtCO2e") +
theme(axis.title = element_blank(),
legend.title = element_blank())
data_changes %>%
filter(year>=2015) %>%
mutate(year=as.factor(year)) %>%
ggplot(.,aes(x=year,y=change_abs)) +
geom_col(color="#636363",fill="white") +
geom_hline(yintercept=0) +
geom_point(data=data_changes %>% filter(year>=2015) %>% mutate(year=as.factor(year)) %>%  group_by(year) %>% summarise(change_abs=sum(change_abs)),
inherit.aes=FALSE,aes(x=year,y=change_abs)) +
theme_wl() +
labs(title="Change in total emissions by year and country",
subtitle="GtCO2e") +
theme(axis.title = element_blank(),
legend.title = element_blank())
data_changes %>%
filter(year>=2010) %>%
mutate(year=as.factor(year)) %>%
ggplot(.,aes(x=year,y=change_abs)) +
geom_col(color="#636363",fill="white") +
geom_hline(yintercept=0) +
geom_point(data=data_changes %>% filter(year>=2010) %>% mutate(year=as.factor(year)) %>%  group_by(year) %>% summarise(change_abs=sum(change_abs)),
inherit.aes=FALSE,aes(x=year,y=change_abs)) +
theme_wl() +
labs(title="Change in total emissions by year and country",
subtitle="GtCO2e") +
theme(axis.title = element_blank(),
legend.title = element_blank())
knitr::opts_chunk$set(echo = FALSE)
options(dplyr.summarise.inform = FALSE)
rm(list = ls())
library(tidyverse)
library(openxlsx)
library(countrycode)
library(ggrepel)
library(patchwork)
library(zoo)
library(RColorBrewer)
library(WDI)
library(labelled)
library(grid)
library(ggimage)
source("https://raw.githubusercontent.com/lambwf/Codebase/main/figure_style.R")
source("https://raw.githubusercontent.com/lambwf/Codebase/main/reshape_with_labels.R")
source("https://raw.githubusercontent.com/lambwf/Codebase/main/locate_shares.R")
source("https://raw.githubusercontent.com/lambwf/Codebase/main/load_gcb_countries_v2023.R")
source("https://raw.githubusercontent.com/lambwf/Codebase/main/load_edgar_v9.R")
wb <- createWorkbook()
data_unep_2024 <- read.xlsx('results/UNEP-Gap-Report-2024-Chapter-2-Data-Global.xlsx',sheet=2)
data_unep_2024 <- gather(data_unep_2024,year,value,`1990`:`2023`) %>% select(gas,year,unep_2024=value) %>% mutate(year=as.numeric(year))
unique(data_unep_2024$gas)
data_unep_2023 <- read.xlsx('../UNEP Gap Report 2023/Results/UNEP-Gap-Report-2023-Chapter-2-Global-Data.xlsx',sheet=2)
data_unep_2023 <- data_unep_2023 %>% select(gas,year,unep_2023=value)
unique(data_unep_2023$gas)
View(data_unep_2023)
data_unep_2023 <- data_unep_2023 %>%
mutate(gas=ifelse(gas=="CO2_fossil","CO2 Fossil",gas)) %>%
mutate(gas=ifelse(gas=="CO2_LULUCF_NGHGI","CO2 LULUCF (Inventory)",gas)) %>%
mutate(gas=ifelse(gas=="CO2_LULUCF_bookkeeping","CO2 LULUCF (Bookkeeping)",gas)) %>%
mutate(gas=ifelse(gas=="Fgas","F-gases",gas))
data_unep_2022 <- read.xlsx('../UNEP Gap Report 2022/Results/egr_chapter_data.xlsx',sheet=1)
data_unep_2022 <- gather(data_unep_2022,gas,unep_2022,-year)
unique(data_unep_2022$gas)
data_unep_2022 <- data_unep_2022 %>%
mutate(gas=ifelse(gas=="CO2_FFI","CO2 Fossil",gas)) %>%
mutate(gas=ifelse(gas=="CO2_LULUCF_NGHGI","CO2 LULUCF (Inventory)",gas)) %>%
mutate(gas=ifelse(gas=="CO2_LULUCF_GCB","CO2 LULUCF (Bookkeeping)",gas)) %>%
mutate(gas=ifelse(gas=="Fgas","F-gases",gas))
data <- left_join(data_unep_2022,data_unep_2023,by=join_by(year,gas))
data <- left_join(data,data_unep_2024,by=join_by(year,gas))
View(data)
data_unep_2024 <- read.xlsx('results/UNEP-Gap-Report-2024-Chapter-2-Data-Global.xlsx',sheet=2)
data_unep_2024 <- gather(data_unep_2024,year,value,`1990`:`2023`) %>% select(gas,year,unep_2024=value) %>% mutate(year=as.numeric(year))
data_unep_2023 <- read.xlsx('../UNEP Gap Report 2023/Results/UNEP-Gap-Report-2023-Chapter-2-Global-Data.xlsx',sheet=2)
data_unep_2023 <- data_unep_2023 %>% select(gas,year,unep_2023=value)
data_unep_2023 <- data_unep_2023 %>%
mutate(gas=ifelse(gas=="CO2_fossil","CO2 Fossil",gas)) %>%
mutate(gas=ifelse(gas=="CO2_LULUCF_NGHGI","CO2 LULUCF (Inventory)",gas)) %>%
mutate(gas=ifelse(gas=="CO2_LULUCF_bookkeeping","CO2 LULUCF (Bookkeeping)",gas)) %>%
mutate(gas=ifelse(gas=="Fgas","F-gases",gas))
data_unep_2022 <- read.xlsx('../UNEP Gap Report 2022/Results/egr_chapter_data.xlsx',sheet=1)
data_unep_2022 <- gather(data_unep_2022,gas,unep_2022,-year)
data_unep_2022 <- data_unep_2022 %>%
mutate(gas=ifelse(gas=="CO2_FFI","CO2 Fossil",gas)) %>%
mutate(gas=ifelse(gas=="CO2_LULUCF_NGHGI","CO2 LULUCF (Inventory)",gas)) %>%
mutate(gas=ifelse(gas=="CO2_LULUCF_GCB","CO2 LULUCF (Bookkeeping)",gas)) %>%
mutate(gas=ifelse(gas=="Fgas","F-gases",gas)) %>%
filter(!gas %in% c('GHG_ex_LULUCF','GHG_incl_LULUCF_NGHGI'))
data <- left_join(data_unep_2022,data_unep_2023,by=join_by(year,gas))
data <- left_join(data,data_unep_2024,by=join_by(year,gas))
data_unep_2024 <- read.xlsx('results/UNEP-Gap-Report-2024-Chapter-2-Data-Global.xlsx',sheet=2)
data_unep_2024 <- gather(data_unep_2024,year,value,`1990`:`2023`) %>% select(gas,year,unep_2024=value) %>% mutate(year=as.numeric(year))
data_unep_2023 <- read.xlsx('../UNEP Gap Report 2023/Results/UNEP-Gap-Report-2023-Chapter-2-Global-Data.xlsx',sheet=2)
data_unep_2023 <- data_unep_2023 %>% select(gas,year,unep_2023=value)
data_unep_2023 <- data_unep_2023 %>%
mutate(gas=ifelse(gas=="CO2_fossil","CO2 Fossil",gas)) %>%
mutate(gas=ifelse(gas=="CO2_LULUCF_NGHGI","CO2 LULUCF (Inventory)",gas)) %>%
mutate(gas=ifelse(gas=="CO2_LULUCF_bookkeeping","CO2 LULUCF (Bookkeeping)",gas)) %>%
mutate(gas=ifelse(gas=="Fgas","F-gases",gas)) %>%
mutate(gas=ifelse(gas=="GHG_incl_LULUCF_NGHGI","GHG",gas))
data_unep_2022 <- read.xlsx('../UNEP Gap Report 2022/Results/egr_chapter_data.xlsx',sheet=1)
data_unep_2022 <- gather(data_unep_2022,gas,unep_2022,-year)
data_unep_2022 <- data_unep_2022 %>%
mutate(gas=ifelse(gas=="CO2_FFI","CO2 Fossil",gas)) %>%
mutate(gas=ifelse(gas=="CO2_LULUCF_NGHGI","CO2 LULUCF (Inventory)",gas)) %>%
mutate(gas=ifelse(gas=="CO2_LULUCF_GCB","CO2 LULUCF (Bookkeeping)",gas)) %>%
mutate(gas=ifelse(gas=="Fgas","F-gases",gas)) %>%
filter(!gas %in% c('GHG_ex_LULUCF','GHG_incl_LULUCF_NGHGI'))
data <- left_join(data_unep_2022,data_unep_2023,by=join_by(year,gas))
data <- left_join(data,data_unep_2024,by=join_by(year,gas))
data_unep_2024 <- read.xlsx('results/UNEP-Gap-Report-2024-Chapter-2-Data-Global.xlsx',sheet=2)
data_unep_2024 <- gather(data_unep_2024,year,value,`1990`:`2023`) %>% select(gas,year,unep_2024=value) %>% mutate(year=as.numeric(year))
data_unep_2023 <- read.xlsx('../UNEP Gap Report 2023/Results/UNEP-Gap-Report-2023-Chapter-2-Global-Data.xlsx',sheet=2)
data_unep_2023 <- data_unep_2023 %>% select(gas,year,unep_2023=value)
data_unep_2023 <- data_unep_2023 %>%
mutate(gas=ifelse(gas=="CO2_fossil","CO2 Fossil",gas)) %>%
mutate(gas=ifelse(gas=="CO2_LULUCF_NGHGI","CO2 LULUCF (Inventory)",gas)) %>%
mutate(gas=ifelse(gas=="CO2_LULUCF_bookkeeping","CO2 LULUCF (Bookkeeping)",gas)) %>%
mutate(gas=ifelse(gas=="Fgas","F-gases",gas))
data_unep_2022 <- read.xlsx('../UNEP Gap Report 2022/Results/egr_chapter_data.xlsx',sheet=1)
data_unep_2022 <- gather(data_unep_2022,gas,unep_2022,-year)
data_unep_2022 <- data_unep_2022 %>%
mutate(gas=ifelse(gas=="CO2_FFI","CO2 Fossil",gas)) %>%
mutate(gas=ifelse(gas=="CO2_LULUCF_NGHGI","CO2 LULUCF (Inventory)",gas)) %>%
mutate(gas=ifelse(gas=="CO2_LULUCF_GCB","CO2 LULUCF (Bookkeeping)",gas)) %>%
mutate(gas=ifelse(gas=="Fgas","F-gases",gas)) %>%
filter(!gas %in% c('GHG_ex_LULUCF','GHG_incl_LULUCF_NGHGI')) %>%
mutate(gas=ifelse(gas=="GHG_incl_LULUCF_NGHGI","GHG",gas))
data <- left_join(data_unep_2022,data_unep_2023,by=join_by(year,gas))
data <- left_join(data,data_unep_2024,by=join_by(year,gas))
data_unep_2024 <- read.xlsx('results/UNEP-Gap-Report-2024-Chapter-2-Data-Global.xlsx',sheet=2)
data_unep_2024 <- gather(data_unep_2024,year,value,`1990`:`2023`) %>% select(gas,year,unep_2024=value) %>% mutate(year=as.numeric(year))
data_unep_2023 <- read.xlsx('../UNEP Gap Report 2023/Results/UNEP-Gap-Report-2023-Chapter-2-Global-Data.xlsx',sheet=2)
data_unep_2023 <- data_unep_2023 %>% select(gas,year,unep_2023=value)
data_unep_2023 <- data_unep_2023 %>%
mutate(gas=ifelse(gas=="CO2_fossil","CO2 Fossil",gas)) %>%
mutate(gas=ifelse(gas=="CO2_LULUCF_NGHGI","CO2 LULUCF (Inventory)",gas)) %>%
mutate(gas=ifelse(gas=="CO2_LULUCF_bookkeeping","CO2 LULUCF (Bookkeeping)",gas)) %>%
mutate(gas=ifelse(gas=="Fgas","F-gases",gas))
data_unep_2022 <- read.xlsx('../UNEP Gap Report 2022/Results/egr_chapter_data.xlsx',sheet=1)
data_unep_2022 <- gather(data_unep_2022,gas,unep_2022,-year)
data_unep_2022 <- data_unep_2022 %>%
mutate(gas=ifelse(gas=="CO2_FFI","CO2 Fossil",gas)) %>%
mutate(gas=ifelse(gas=="CO2_LULUCF_NGHGI","CO2 LULUCF (Inventory)",gas)) %>%
mutate(gas=ifelse(gas=="CO2_LULUCF_GCB","CO2 LULUCF (Bookkeeping)",gas)) %>%
mutate(gas=ifelse(gas=="Fgas","F-gases",gas)) %>%
mutate(gas=ifelse(gas=="GHG_incl_LULUCF_NGHGI","GHG",gas)) %>%
filter(!gas %in% c('GHG_ex_LULUCF','GHG_incl_LULUCF_NGHGI'))
data <- left_join(data_unep_2022,data_unep_2023,by=join_by(year,gas))
data <- left_join(data,data_unep_2024,by=join_by(year,gas))
data_unep_2024 <- read.xlsx('results/UNEP-Gap-Report-2024-Chapter-2-Data-Global.xlsx',sheet=2)
data_unep_2024 <- gather(data_unep_2024,year,value,`1990`:`2023`) %>% select(gas,year,unep_2024=value) %>% mutate(year=as.numeric(year))
data_unep_2023 <- read.xlsx('../UNEP Gap Report 2023/Results/UNEP-Gap-Report-2023-Chapter-2-Global-Data.xlsx',sheet=2)
data_unep_2023 <- data_unep_2023 %>% select(gas,year,unep_2023=value)
data_unep_2023 <- data_unep_2023 %>%
mutate(gas=ifelse(gas=="CO2_fossil","CO2 Fossil",gas)) %>%
mutate(gas=ifelse(gas=="CO2_LULUCF_NGHGI","CO2 LULUCF (Inventory)",gas)) %>%
mutate(gas=ifelse(gas=="CO2_LULUCF_bookkeeping","CO2 LULUCF (Bookkeeping)",gas)) %>%
mutate(gas=ifelse(gas=="Fgas","F-gases",gas))
data_unep_2022 <- read.xlsx('../UNEP Gap Report 2022/Results/egr_chapter_data.xlsx',sheet=1)
data_unep_2022 <- gather(data_unep_2022,gas,unep_2022,-year)
data_unep_2022 <- data_unep_2022 %>%
mutate(gas=ifelse(gas=="CO2_FFI","CO2 Fossil",gas)) %>%
mutate(gas=ifelse(gas=="CO2_LULUCF_NGHGI","CO2 LULUCF (Inventory)",gas)) %>%
mutate(gas=ifelse(gas=="CO2_LULUCF_GCB","CO2 LULUCF (Bookkeeping)",gas)) %>%
mutate(gas=ifelse(gas=="Fgas","F-gases",gas)) %>%
mutate(gas=ifelse(gas=="GHG_incl_LULUCF_GCB","GHG",gas)) %>%
filter(!gas %in% c('GHG_ex_LULUCF','GHG_incl_LULUCF_NGHGI'))
data <- left_join(data_unep_2022,data_unep_2023,by=join_by(year,gas))
data <- left_join(data,data_unep_2024,by=join_by(year,gas))
data_unep_2024 <- read.xlsx('results/UNEP-Gap-Report-2024-Chapter-2-Data-Global.xlsx',sheet=2)
data_unep_2024 <- gather(data_unep_2024,year,value,`1990`:`2023`) %>% select(gas,year,unep_2024=value) %>% mutate(year=as.numeric(year))
data_unep_2023 <- read.xlsx('../UNEP Gap Report 2023/Results/UNEP-Gap-Report-2023-Chapter-2-Global-Data.xlsx',sheet=2)
data_unep_2023 <- data_unep_2023 %>% select(gas,year,unep_2023=value)
data_unep_2023 <- data_unep_2023 %>%
mutate(gas=ifelse(gas=="CO2_fossil","CO2 Fossil",gas)) %>%
mutate(gas=ifelse(gas=="CO2_LULUCF_NGHGI","CO2 LULUCF (Inventory)",gas)) %>%
mutate(gas=ifelse(gas=="CO2_LULUCF_bookkeeping","CO2 LULUCF (Bookkeeping)",gas)) %>%
mutate(gas=ifelse(gas=="Fgas","F-gases",gas))
data_unep_2023 <- rbind(data_unep_2023,data_unep_2023 %>%
filter(gas %in% c("CO2 Fossil","CH4","N2O","F-gases","CO2 LULUCF (Bookkeeping)")) %>%
group_by(year) %>%
summarise(unep_2023=sum(unep_2023,na.rm=TRUE)) %>%
mutate(gas="GHG"))
data_unep_2022 <- read.xlsx('../UNEP Gap Report 2022/Results/egr_chapter_data.xlsx',sheet=1)
data_unep_2022 <- gather(data_unep_2022,gas,unep_2022,-year)
data_unep_2022 <- data_unep_2022 %>%
mutate(gas=ifelse(gas=="CO2_FFI","CO2 Fossil",gas)) %>%
mutate(gas=ifelse(gas=="CO2_LULUCF_NGHGI","CO2 LULUCF (Inventory)",gas)) %>%
mutate(gas=ifelse(gas=="CO2_LULUCF_GCB","CO2 LULUCF (Bookkeeping)",gas)) %>%
mutate(gas=ifelse(gas=="Fgas","F-gases",gas)) %>%
mutate(gas=ifelse(gas=="GHG_incl_LULUCF_GCB","GHG",gas)) %>%
filter(!gas %in% c('GHG_ex_LULUCF','GHG_incl_LULUCF_NGHGI'))
data <- left_join(data_unep_2022,data_unep_2023,by=join_by(year,gas))
data <- left_join(data,data_unep_2024,by=join_by(year,gas))
View(data_unep_2024)
data_unep_2024 <- data_unep_2024 %>%
filter(!gas %in% c("CO2 Fossil","GHG"))
data_unep_2024 <- data_unep_2024 %>%
filter(!gas %in% c("CO2 Fossil","GHG")) %>%
mutate(gas=ifelse(gas=="CO2 Fossil (excl. cement carbonation)","CO2 Fossil",gas))
data_unep_2024 <- read.xlsx('results/UNEP-Gap-Report-2024-Chapter-2-Data-Global.xlsx',sheet=2)
data_unep_2024 <- gather(data_unep_2024,year,value,`1990`:`2023`) %>% select(gas,year,unep_2024=value) %>% mutate(year=as.numeric(year))
data_unep_2024 <- data_unep_2024 %>%
filter(!gas %in% c("CO2 Fossil","GHG")) %>%
mutate(gas=ifelse(gas=="CO2 Fossil (excl. cement carbonation)","CO2 Fossil",gas))
data_unep_2024 <- rbind(data_unep_2024,data_unep_2024 %>%
filter(gas %in% c("CO2 Fossil","CH4","N2O","F-gases","CO2 LULUCF (Bookkeeping)")) %>%
group_by(year) %>%
summarise(unep_2024=sum(unep_2024,na.rm=TRUE)) %>%
mutate(gas="GHG"))
data_unep_2023 <- read.xlsx('../UNEP Gap Report 2023/Results/UNEP-Gap-Report-2023-Chapter-2-Global-Data.xlsx',sheet=2)
data_unep_2023 <- data_unep_2023 %>% select(gas,year,unep_2023=value)
data_unep_2023 <- data_unep_2023 %>%
mutate(gas=ifelse(gas=="CO2_fossil","CO2 Fossil",gas)) %>%
mutate(gas=ifelse(gas=="CO2_LULUCF_NGHGI","CO2 LULUCF (Inventory)",gas)) %>%
mutate(gas=ifelse(gas=="CO2_LULUCF_bookkeeping","CO2 LULUCF (Bookkeeping)",gas)) %>%
mutate(gas=ifelse(gas=="Fgas","F-gases",gas))
data_unep_2023 <- rbind(data_unep_2023,data_unep_2023 %>%
filter(gas %in% c("CO2 Fossil","CH4","N2O","F-gases","CO2 LULUCF (Bookkeeping)")) %>%
group_by(year) %>%
summarise(unep_2023=sum(unep_2023,na.rm=TRUE)) %>%
mutate(gas="GHG"))
data_unep_2022 <- read.xlsx('../UNEP Gap Report 2022/Results/egr_chapter_data.xlsx',sheet=1)
data_unep_2022 <- gather(data_unep_2022,gas,unep_2022,-year)
data_unep_2022 <- data_unep_2022 %>%
mutate(gas=ifelse(gas=="CO2_FFI","CO2 Fossil",gas)) %>%
mutate(gas=ifelse(gas=="CO2_LULUCF_NGHGI","CO2 LULUCF (Inventory)",gas)) %>%
mutate(gas=ifelse(gas=="CO2_LULUCF_GCB","CO2 LULUCF (Bookkeeping)",gas)) %>%
mutate(gas=ifelse(gas=="Fgas","F-gases",gas)) %>%
mutate(gas=ifelse(gas=="GHG_incl_LULUCF_GCB","GHG",gas)) %>%
filter(!gas %in% c('GHG_ex_LULUCF','GHG_incl_LULUCF_NGHGI'))
data <- left_join(data_unep_2022,data_unep_2023,by=join_by(year,gas))
data <- left_join(data,data_unep_2024,by=join_by(year,gas))
data <- gather(data,var,value,-year)
data_unep_2024 <- read.xlsx('results/UNEP-Gap-Report-2024-Chapter-2-Data-Global.xlsx',sheet=2)
data_unep_2024 <- gather(data_unep_2024,year,value,`1990`:`2023`) %>% select(gas,year,unep_2024=value) %>% mutate(year=as.numeric(year))
data_unep_2024 <- data_unep_2024 %>%
filter(!gas %in% c("CO2 Fossil","GHG")) %>%
mutate(gas=ifelse(gas=="CO2 Fossil (excl. cement carbonation)","CO2 Fossil",gas))
data_unep_2024 <- rbind(data_unep_2024,data_unep_2024 %>%
filter(gas %in% c("CO2 Fossil","CH4","N2O","F-gases","CO2 LULUCF (Bookkeeping)")) %>%
group_by(year) %>%
summarise(unep_2024=sum(unep_2024,na.rm=TRUE)) %>%
mutate(gas="GHG"))
data_unep_2023 <- read.xlsx('../UNEP Gap Report 2023/Results/UNEP-Gap-Report-2023-Chapter-2-Global-Data.xlsx',sheet=2)
data_unep_2023 <- data_unep_2023 %>% select(gas,year,unep_2023=value)
data_unep_2023 <- data_unep_2023 %>%
mutate(gas=ifelse(gas=="CO2_fossil","CO2 Fossil",gas)) %>%
mutate(gas=ifelse(gas=="CO2_LULUCF_NGHGI","CO2 LULUCF (Inventory)",gas)) %>%
mutate(gas=ifelse(gas=="CO2_LULUCF_bookkeeping","CO2 LULUCF (Bookkeeping)",gas)) %>%
mutate(gas=ifelse(gas=="Fgas","F-gases",gas))
data_unep_2023 <- rbind(data_unep_2023,data_unep_2023 %>%
filter(gas %in% c("CO2 Fossil","CH4","N2O","F-gases","CO2 LULUCF (Bookkeeping)")) %>%
group_by(year) %>%
summarise(unep_2023=sum(unep_2023,na.rm=TRUE)) %>%
mutate(gas="GHG"))
data_unep_2022 <- read.xlsx('../UNEP Gap Report 2022/Results/egr_chapter_data.xlsx',sheet=1)
data_unep_2022 <- gather(data_unep_2022,gas,unep_2022,-year)
data_unep_2022 <- data_unep_2022 %>%
mutate(gas=ifelse(gas=="CO2_FFI","CO2 Fossil",gas)) %>%
mutate(gas=ifelse(gas=="CO2_LULUCF_NGHGI","CO2 LULUCF (Inventory)",gas)) %>%
mutate(gas=ifelse(gas=="CO2_LULUCF_GCB","CO2 LULUCF (Bookkeeping)",gas)) %>%
mutate(gas=ifelse(gas=="Fgas","F-gases",gas)) %>%
mutate(gas=ifelse(gas=="GHG_incl_LULUCF_GCB","GHG",gas)) %>%
filter(!gas %in% c('GHG_ex_LULUCF','GHG_incl_LULUCF_NGHGI'))
data <- left_join(data_unep_2022,data_unep_2023,by=join_by(year,gas))
data <- left_join(data,data_unep_2024,by=join_by(year,gas))
data <- gather(data,dataset,value,-year,-gas)
data %>% ggplot(.,aes(x=year,y=value,color=dataset,group=dataset)) +
geom_path() +
facet_wrap(.~gas,scales="free") +
theme_wl()
data %>% filter(year==2019) %>%
ggplot(.,aes(x=dataset,y=value,fill=dataset)) +
geom_col()
data %>% filter(year==2019) %>%
ggplot(.,aes(x=dataset,y=value,fill=dataset)) +
geom_col() +
facet_wrap(.~gas)
data %>% filter(year==2019) %>%
ggplot(.,aes(x=dataset,y=value,fill=dataset)) +
geom_col() +
facet_wrap(.~gas,scales="free")
data %>% filter(year==2019) %>%
ggplot(.,aes(x=dataset,y=value,fill=dataset)) +
geom_col() +
facet_wrap(.~gas,scales="free") +
theme_wl()
data %>% filter(year==2019) %>%
ggplot(.,aes(x=dataset,y=value,fill=dataset)) +
geom_col() +
facet_wrap(.~gas,scales="free") +
theme_wl() +
theme(legend.position="none")
data$gas <- as.factor(data$gas)
data$gas <- fct_relevel(data$gas,"GHG","CO2 Fossil","CH4","N2O","F-gases","CO2 LULUCF (Bookkeeping)","CO2 LULUCF (Inventory)")
data %>% ggplot(.,aes(x=year,y=value,color=dataset,group=dataset)) +
geom_path() +
facet_wrap(.~gas,scales="free") +
theme_wl()
data %>% filter(year==2019) %>%
ggplot(.,aes(x=dataset,y=value,fill=dataset)) +
geom_col() +
facet_wrap(.~gas,scales="free") +
theme_wl() +
theme(legend.position="none")
data %>% filter(year==2019) %>% filter(!gas %in% C("GHG","CO2 LULUCF (Inventory)")) %>%
ggplot(.,aes(x=dataset,y=value,fill=gas)) +
geom_col() +
theme_wl()
data %>% filter(year==2019) %>% filter(gas!="GHG") %>%
ggplot(.,aes(x=dataset,y=value,fill=gas)) +
geom_col() +
theme_wl()
data %>% filter(year==2019) %>% filter(gas!="GHG") %>%
filter(gas!="CO2 LULUCF (Inventory)") %>%
ggplot(.,aes(x=dataset,y=value,fill=gas)) +
geom_col() +
theme_wl()
data %>% filter(year==2019) %>% filter(gas!="GHG") %>%
filter(gas!="CO2 LULUCF (Inventory)") %>%
ggplot(.,aes(x=dataset,y=value,fill=gas)) +
geom_col(color="#636363") +
theme_wl()
data_table <- data %>%
filter(year>=2019)
View(data_table)
data_table <- spread(data_table,year,value)
write.xlsx(data_table,'results/UNEP-Gap-Report-2024-Chapter-2-Data-Differences.xlsx')
data_gcb <- read.csv('sources/GCB2023v43_MtCO2_flat.csv')
View(data_gcb)
data_gcb <- data_gcb %>%
select(iso=ISO.3166.1.alpha.3,year=Year,value=Total)
data_gcb <- read.csv('sources/GCB2023v43_MtCO2_flat.csv')
data_gcb <- data_gcb %>%
select(iso=ISO.3166.1.alpha.3,year=Year,value=Total) %>%
filter(year>=1990)
data_edgar <- read.xlsx("sources/not public/EDGAR_2024_CO2_1970_2023_v2.xlsx",sheet=2,startRow=9)
View(data_edgar)
source("https://raw.githubusercontent.com/lambwf/Codebase/main/load_edgar_v9.R")
edgar_co2 <- read.xlsx("sources/not public/EDGAR_2024_CO2_1970_2023_v2.xlsx",sheet=2,startRow=9)
edgar_ch4 <- read.xlsx("sources/not public/EDGAR_2024_CH4_1970_2023_v2.xlsx",sheet=2,startRow = 9)
edgar_n2o <- read.xlsx("sources/not public/EDGAR_2024_N2O_1970_2023_v2.xlsx",sheet=2,startRow = 9)
edgar_fgas <- read.xlsx("sources/not public/EDGAR_2024_F-gases_1970_2023_v2.xlsx",sheet=2,startRow = 9)
data_ghg <- load_edgar(edgar_co2,edgar_ch4,edgar_n2o,edgar_fgas)
data_edgar <- load_edgar(edgar_co2,edgar_ch4,edgar_n2o,edgar_fgas)
View(data_edgar)
data_edgar <- data_edgar %>%
filter(gas=="CO2") %>%
filter(fossil_bio=="fossil")
data_edgar <- load_edgar(edgar_co2,edgar_ch4,edgar_n2o,edgar_fgas)
data_edgar <- data_edgar %>%
filter(gas=="CO2") %>%
filter(fossil_bio=="fossil") %>%
group_by(country,iso,year) %>%
summarise(value=sum(value,na.rm=T))
data_gcb <- read.csv('sources/GCB2023v43_MtCO2_flat.csv')
data_gcb <- data_gcb %>%
select(iso=ISO.3166.1.alpha.3,year=Year,value_gcb=Total) %>%
filter(year>=1990)
source("https://raw.githubusercontent.com/lambwf/Codebase/main/load_edgar_v9.R")
edgar_co2 <- read.xlsx("sources/not public/EDGAR_2024_CO2_1970_2023_v2.xlsx",sheet=2,startRow=9)
edgar_ch4 <- read.xlsx("sources/not public/EDGAR_2024_CH4_1970_2023_v2.xlsx",sheet=2,startRow = 9)
edgar_n2o <- read.xlsx("sources/not public/EDGAR_2024_N2O_1970_2023_v2.xlsx",sheet=2,startRow = 9)
edgar_fgas <- read.xlsx("sources/not public/EDGAR_2024_F-gases_1970_2023_v2.xlsx",sheet=2,startRow = 9)
data_edgar <- load_edgar(edgar_co2,edgar_ch4,edgar_n2o,edgar_fgas)
data_edgar <- data_edgar %>%
filter(gas=="CO2") %>%
filter(fossil_bio=="fossil") %>%
group_by(country,iso,year) %>%
summarise(value_edgar=sum(value,na.rm=T)*1000)
data_comparison <- left_join(data_edgar,data_gcb,by=join_by(year,iso))
View(data_comparison)
data_gcb <- read.csv('sources/GCB2023v43_MtCO2_flat.csv')
data_gcb <- data_gcb %>%
select(iso=ISO.3166.1.alpha.3,year=Year,value_gcb=Total) %>%
filter(year>=1990)
source("https://raw.githubusercontent.com/lambwf/Codebase/main/load_edgar_v9.R")
edgar_co2 <- read.xlsx("sources/not public/EDGAR_2024_CO2_1970_2023_v2.xlsx",sheet=2,startRow=9)
edgar_ch4 <- read.xlsx("sources/not public/EDGAR_2024_CH4_1970_2023_v2.xlsx",sheet=2,startRow = 9)
edgar_n2o <- read.xlsx("sources/not public/EDGAR_2024_N2O_1970_2023_v2.xlsx",sheet=2,startRow = 9)
edgar_fgas <- read.xlsx("sources/not public/EDGAR_2024_F-gases_1970_2023_v2.xlsx",sheet=2,startRow = 9)
data_edgar <- load_edgar(edgar_co2,edgar_ch4,edgar_n2o,edgar_fgas)
data_edgar <- data_edgar %>%
filter(gas=="CO2") %>%
filter(fossil_bio=="fossil") %>%
group_by(country,iso,year) %>%
summarise(value_edgar=sum(value,na.rm=T)*1000/1e6)
data_comparison <- left_join(data_edgar,data_gcb,by=join_by(year,iso))
data_comparison <- left_join(data_comparison,data_comparison %>%
filter(year==2022) %>%
group_by(iso,country) %>%
summarise(value=sum(value)) %>%
arrange(desc(value)) %>%
mutate(rank=1) %>%
mutate(rank=cumsum(rank)),by=join_by(iso,country))
data_comparison <- left_join(data_comparison,data_comparison %>%
filter(year==2022) %>%
group_by(iso,country) %>%
summarise(value=sum(value)) %>%
arrange(desc(value)) %>%
mutate(rank=1) %>%
mutate(rank=cumsum(rank)) %>%
select(iso,rank),by=join_by(iso))
data_comparison <- left_join(data_comparison,data_comparison %>%
filter(year==2022) %>%
group_by(iso,country) %>%
summarise(value=sum(value_edgar)) %>%
arrange(desc(value)) %>%
mutate(rank=1) %>%
mutate(rank=cumsum(rank)) %>%
select(iso,rank),by=join_by(iso))
blarg <- data_comparison %>%
filter(year==2022) %>%
group_by(iso,country) %>%
summarise(value=sum(value_edgar)) %>%
arrange(desc(value)) %>%
mutate(rank=1) %>%
mutate(rank=cumsum(rank)) %>%
select(iso,rank)
View(blarg)
blarg <- data_comparison %>%
filter(year==2022) %>%
group_by(iso,country) %>%
summarise(value=sum(value_edgar)) %>%
arrange(desc(value)) %>%
mutate(rank=1) %>%
mutate(rank=cumsum(1)) %>%
select(iso,rank)
blarg <- data_comparison %>%
filter(year==2022) %>%
group_by(iso,country) %>%
summarise(value=sum(value_edgar)) %>%
ungroup()
blarg <- data_comparison %>%
filter(year==2022) %>%
group_by(iso,country) %>%
summarise(value=sum(value_edgar)) %>%
ungroup() %>%
arrange(desc(value)) %>%
mutate(rank=1) %>%
mutate(rank=cumsum(1)) %>%
select(iso,rank)
blarg <- data_comparison %>%
filter(year==2022) %>%
group_by(iso,country) %>%
summarise(value=sum(value_edgar)) %>%
ungroup() %>%
arrange(desc(value)) %>%
mutate(rank=1)# %>%
blarg$rank=cumsum(blarg$rank)
blarg <- data_comparison %>%
filter(year==2022) %>%
group_by(iso,country) %>%
summarise(value=sum(value_edgar)) %>%
ungroup() %>%
arrange(desc(value)) %>%
mutate(rank=1)# %>%
blarg <- blarg %>% mutate(rank=cumsum(rank))
rank <- data_comparison %>%
filter(year==2022) %>%
group_by(iso,country) %>%
summarise(value=sum(value_edgar)) %>%
ungroup() %>%
arrange(desc(value)) %>%
mutate(rank=1) %>%
select(iso,rank)
data_comparison <- left_join(data_comparison,rank,by=join_by(iso))
data_gcb <- read.csv('sources/GCB2023v43_MtCO2_flat.csv')
data_gcb <- data_gcb %>%
select(iso=ISO.3166.1.alpha.3,year=Year,value_gcb=Total) %>%
filter(year>=1990)
source("https://raw.githubusercontent.com/lambwf/Codebase/main/load_edgar_v9.R")
edgar_co2 <- read.xlsx("sources/not public/EDGAR_2024_CO2_1970_2023_v2.xlsx",sheet=2,startRow=9)
edgar_ch4 <- read.xlsx("sources/not public/EDGAR_2024_CH4_1970_2023_v2.xlsx",sheet=2,startRow = 9)
edgar_n2o <- read.xlsx("sources/not public/EDGAR_2024_N2O_1970_2023_v2.xlsx",sheet=2,startRow = 9)
edgar_fgas <- read.xlsx("sources/not public/EDGAR_2024_F-gases_1970_2023_v2.xlsx",sheet=2,startRow = 9)
data_edgar <- load_edgar(edgar_co2,edgar_ch4,edgar_n2o,edgar_fgas)
data_edgar <- data_edgar %>%
filter(gas=="CO2") %>%
filter(fossil_bio=="fossil") %>%
group_by(country,iso,year) %>%
summarise(value_edgar=sum(value,na.rm=T)*1000/1e6) %>%
filter(year>=1990)
data_comparison <- left_join(data_edgar,data_gcb,by=join_by(year,iso))
rank <- data_comparison %>%
filter(year==2022) %>%
group_by(iso,country) %>%
summarise(value=sum(value_edgar)) %>%
ungroup() %>%
arrange(desc(value)) %>%
mutate(rank=1) %>%
select(iso,rank)
rank$rank=cumsum(rank$rank)
data_comparison <- left_join(data_comparison,rank,by=join_by(iso))
