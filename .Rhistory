coord_cartesian(clip = "off")
plot <- plot_spacer() + p3 + plot_spacer() + p1 + plot_spacer() + p2 + plot_layout(widths=c(-0.26,1,-0.26,6,-0.26,1))
plot
return(plot)
}
plot_country_change("European Union",3,data_countries_change)
## Aggregate emissions
data_countries_change <- data_edgar %>%
group_by(iso,country,sector_lv2,year) %>%
summarise(value=sum(value,na.rm=T)/1e6)
## Add land use change emissions
data_countries_luc <- read.xlsx('sources/not public/LULUCF NGHGI data for UNEP 2024.xlsx',startRow = 3) %>%
rename(category=LAND.CATEGORY,country=UNFCCC.country,iso=country.code) %>%
filter(category=="LULUCF net")
data_countries_luc <- gather(data_countries_luc,year,`Land use change (LULUCF)`,`2000`:`2023`) %>%
mutate(year=as.numeric(year)) %>%
filter(!is.na(iso)) %>%
select(iso,year,`Land use change (LULUCF)`)
data_countries_change <- data_countries_change %>%
spread(.,sector_lv2,value) %>%
left_join(.,data_countries_luc,by=join_by(iso,year)) %>%
gather(.,sector_lv2,value,-iso,-country,-year)
## Add Europe
data_countries_eu <- data_countries_change %>%
left_join(.,cc_EU,by="iso") %>%
filter(!is.na(EU)) %>%
mutate(iso="EU27",country="European Union") %>%
group_by(iso,country,sector_lv2,year) %>%
summarise(value=sum(value))
data_countries_change <- rbind(data_countries_change,data_countries_eu)
## Plot
plot_country_change <- function(countries,t,data_countries_change) {
## Filter
data_countries_change <- data_countries_change %>%
filter(country==countries) %>%
filter(year %in% c(max(data_countries_change$year),max(data_countries_change$year)-t))
## Calculate changes and rank
data_countries_change <- data_countries_change %>%
group_by(sector_lv2) %>%
mutate(change_abs=last(value)-first(value),
change_rel=change_abs/first(value))
# Re-arrange order of sectors so that net additions come first, net reductions last
data_countries_change_order <- data_countries_change %>%
ungroup() %>%
filter(year==max(data_countries_change$year)) %>%
arrange(desc(change_abs)) %>%
mutate(order=row_number()) %>%
select(sector_lv2,order)
data_countries_change <- left_join(data_countries_change,data_countries_change_order,by=join_by(sector_lv2)) %>%
arrange(order,year)
## Get totals
data_countries_change_tot <- data_countries_change %>%
group_by(year) %>%
summarise(value=sum(value,na.rm=T)) %>%
mutate(label=paste0("Emissions in ",year,": ",signif(value,3)))
## Arrange data for waterfall
data_countries_change <- data_countries_change  %>%
ungroup() %>%
filter(year==max(data_countries_change$year)-t) %>%
add_row(order=0,change_abs=data_countries_change_tot$value[1]) %>%
arrange(order) %>%
ungroup() %>%
mutate(end = cumsum(change_abs),
start = c(0, head(end, -1))) %>%
filter(order!=0)
## Arrange levels, add labels
data_countries_change$sector_lv2 <- gsub("\\| ","",data_countries_change$sector_lv2)
data_countries_change$sector_lv2 <- as.factor(data_countries_change$sector_lv2)
data_countries_change$sector_lv2 <- fct_reorder(data_countries_change$sector_lv2,data_countries_change$order)
colours_custom <- c(
"Energy Power" = "#17becfff",
"Energy Industry" = "#3a5e91ff",
"Energy Transport" = "#5185b5ff",
"Energy Buildings & other" = "#74a6d4ff",
"Energy Fuel production" = "#ff9055ff",
"Industrial processes" = "#e5b82cff",
"Agriculture" = "#4f8455ff",
"Land use change (LULUCF)" = "#7dd396ff",
"Waste" = "#818181ff")
data_countries_change <- data_countries_change %>%
mutate(labels=signif(change_abs,t)) %>%
mutate(labels=ifelse(labels>0,paste0("+",labels),labels))
## Plot
p1 <- data_countries_change %>%
ggplot(.,aes(fill = sector_lv2)) +
geom_rect(aes(x = sector_lv2,xmin = order - 0.2, xmax = order + 0.2, ymin = end, ymax = start),
color="#252525",linewidth=0.25) +
geom_segment(data=data_countries_change %>% filter(order!=max(data_countries_change$order)),
aes(x = order + 0.2, xend = order + 0.8,y = end, yend = end),
color = "#252525",linewidth=0.25) +
# geom_text(aes(x=sector_lv2,y=ifelse(change_abs>0,end+100,end+100-change_abs),label=labels),
#           color="#636363",
#           size=3.5) +
scale_x_discrete(labels = function(x) str_wrap(x, width = 10),expand = expansion(mult = c(0.05, 0.05))) +
scale_y_continuous(breaks=data_countries_change_tot$value) +
scale_fill_manual(values=colours_custom) +
theme_wl() +
theme(legend.position="none",
axis.title = element_blank(),
panel.grid.major.x = element_blank(),
axis.text.x = element_text(vjust = 1),
plot.title = element_text(margin=margin(t=15)),
axis.text.y = element_blank(),
axis.ticks.y = element_blank()) +
# panel.grid.major.y = element_blank(),
# axis.ticks.y = element_blank(),
# axis.line.y = element_blank()) +
labs(title=countries,
subtitle=bquote(paste("Change in recent emissions (MtCO"[2], "e)")),
caption="⌂ UNEP Emissions Gap Report 2024    ⌂ Data: EDGARv9, Grassi et al. 2024 \n⌂ Note: GWP100 AR6; net land use change (LULUCF) emissions based on inventories") +
coord_cartesian(clip = "off")
y_range_scaling <- layer_scales(p1)$y$range$range
y_range_scaling <- diff(y_range_scaling) * 0.08
p1 <- p1 +
geom_text(aes(x=sector_lv2,y=ifelse(change_abs>0,end+y_range_scaling,end+y_range_scaling-change_abs),label=labels),
color="#636363",
size=3.5)
y_range_scaling_2 <- layer_scales(p1)$y$range$range
y_range_expanded <- y_range_scaling_2 + c(-0.001 * diff(y_range_scaling_2),0.001 * diff(y_range_scaling_2))
p2 <- data_countries_change_tot %>%
filter(year==data_countries_change_tot$year[2]) %>%
ggplot(.,aes(x=1.5,y=value,label=str_wrap(label,15))) +
geom_text(size=3.5,colour="#636363",hjust=0) +
geom_segment(aes(x = 1.4, xend = 1, yend = value),
arrow = arrow(length = unit(0.2, "cm")),
colour = "#636363") +
scale_y_continuous(limits = y_range_expanded) +
scale_x_continuous(limits = c(1,4.5),expand = expansion(mult = c(0, 0.05))) +
theme_wl_empty() +
coord_cartesian(clip = "off")
p3 <- data_countries_change_tot %>%
filter(year==data_countries_change_tot$year[1]) %>%
ggplot(.,aes(x=4,y=value,label=str_wrap(label,15))) +
geom_text(size=3.5,colour="#636363",hjust=1) +
geom_segment(aes(x = 4.1, xend = 4.5, yend = value),
arrow = arrow(length = unit(0.2, "cm")),
colour = "#636363") +
scale_y_continuous(limits = y_range_expanded) +
scale_x_continuous(limits = c(1,4.5),expand = expansion(mult = c(0.05, 0))) +
theme_wl_empty() +
coord_cartesian(clip = "off")
plot <- plot_spacer() + p3 + plot_spacer() + p1 + plot_spacer() + p2 + plot_layout(widths=c(-0.26,1,-0.26,6,-0.26,1))
plot
return(plot)
}
plot_country_change("European Union",3,data_countries_change)
## Filter to G20 countries
countries <- data_countries_change %>%
select(iso,country) %>%
distinct() %>%
left_join(.,read.csv("https://raw.githubusercontent.com/openclimatedata/countrygroups/main/data/g20.csv") %>%
select(iso=Code) %>%
mutate(G20="1")) %>%
filter(G20==1)
countries <- c(countries$country,"European Union")
for (i in 1:length(countries)){
plot <- plot_country_change(countries[i],3,data_countries_change)
ggsave(plot,filename = paste0("UNEP-EGR-2024-",countries[i],"-change.png"),
path = "results/standard/countries/",device = "png",height = 4,width=8,dpi=300)
ggsave(plot,filename = paste0("UNEP-EGR-2024-",countries[i],"-change.pdf"),
path = "results/standard/countries/",device = cairo_pdf,height = 4,width=8)
ggsave(plot,filename = paste0("UNEP-EGR-2024-",countries[i],"-change.svg"),
path = "results/standard/countries/",device = 'svg',height = 4,width=8)
}
plot_country_change("European Union",3,data_countries_change)
plot_country_change("European Union",2,data_countries_change)
## Aggregate emissions
data_countries_change <- data_edgar %>%
group_by(iso,country,sector_lv2,year) %>%
summarise(value=sum(value,na.rm=T)/1e6)
## Add land use change emissions
data_countries_luc <- read.xlsx('sources/not public/LULUCF NGHGI data for UNEP 2024.xlsx',startRow = 3) %>%
rename(category=LAND.CATEGORY,country=UNFCCC.country,iso=country.code) %>%
filter(category=="LULUCF net")
data_countries_luc <- gather(data_countries_luc,year,`Land use change (LULUCF)`,`2000`:`2023`) %>%
mutate(year=as.numeric(year)) %>%
filter(!is.na(iso)) %>%
select(iso,year,`Land use change (LULUCF)`)
data_countries_change <- data_countries_change %>%
spread(.,sector_lv2,value) %>%
left_join(.,data_countries_luc,by=join_by(iso,year)) %>%
gather(.,sector_lv2,value,-iso,-country,-year)
## Add Europe
data_countries_eu <- data_countries_change %>%
left_join(.,cc_EU,by="iso") %>%
filter(!is.na(EU)) %>%
mutate(iso="EU27",country="European Union") %>%
group_by(iso,country,sector_lv2,year) %>%
summarise(value=sum(value))
data_countries_change <- rbind(data_countries_change,data_countries_eu)
## Plot
plot_country_change <- function(countries,t,data_countries_change) {
## Filter
data_countries_change <- data_countries_change %>%
filter(country==countries) %>%
filter(year %in% c(max(data_countries_change$year),max(data_countries_change$year)-t))
## Calculate changes and rank
data_countries_change <- data_countries_change %>%
group_by(sector_lv2) %>%
mutate(change_abs=last(value)-first(value),
change_rel=change_abs/first(value))
# Re-arrange order of sectors so that net additions come first, net reductions last
data_countries_change_order <- data_countries_change %>%
ungroup() %>%
filter(year==max(data_countries_change$year)) %>%
arrange(desc(change_abs)) %>%
mutate(order=row_number()) %>%
select(sector_lv2,order)
data_countries_change <- left_join(data_countries_change,data_countries_change_order,by=join_by(sector_lv2)) %>%
arrange(order,year)
## Get totals
data_countries_change_tot <- data_countries_change %>%
group_by(year) %>%
summarise(value=sum(value,na.rm=T)) %>%
mutate(label=paste0("Emissions in ",year,": ",signif(value,3)))
## Arrange data for waterfall
data_countries_change <- data_countries_change  %>%
ungroup() %>%
filter(year==max(data_countries_change$year)-t) %>%
add_row(order=0,change_abs=data_countries_change_tot$value[1]) %>%
arrange(order) %>%
ungroup() %>%
mutate(end = cumsum(change_abs),
start = c(0, head(end, -1))) %>%
filter(order!=0)
## Arrange levels, add labels
data_countries_change$sector_lv2 <- gsub("\\| ","",data_countries_change$sector_lv2)
data_countries_change$sector_lv2 <- as.factor(data_countries_change$sector_lv2)
data_countries_change$sector_lv2 <- fct_reorder(data_countries_change$sector_lv2,data_countries_change$order)
colours_custom <- c(
"Energy Power" = "#17becfff",
"Energy Industry" = "#3a5e91ff",
"Energy Transport" = "#5185b5ff",
"Energy Buildings & other" = "#74a6d4ff",
"Energy Fuel production" = "#ff9055ff",
"Industrial processes" = "#e5b82cff",
"Agriculture" = "#4f8455ff",
"Land use change (LULUCF)" = "#7dd396ff",
"Waste" = "#818181ff")
data_countries_change <- data_countries_change %>%
mutate(labels=signif(change_abs,t)) %>%
mutate(labels=ifelse(labels>0,paste0("+",labels),labels))
## Plot
p1 <- data_countries_change %>%
ggplot(.,aes(fill = sector_lv2)) +
geom_rect(aes(x = sector_lv2,xmin = order - 0.2, xmax = order + 0.2, ymin = end, ymax = start),
color="#252525",linewidth=0.25) +
geom_segment(data=data_countries_change %>% filter(order!=max(data_countries_change$order)),
aes(x = order + 0.2, xend = order + 0.8,y = end, yend = end),
color = "#252525",linewidth=0.25) +
# geom_text(aes(x=sector_lv2,y=ifelse(change_abs>0,end+100,end+100-change_abs),label=labels),
#           color="#636363",
#           size=3.5) +
scale_x_discrete(labels = function(x) str_wrap(x, width = 10),expand = expansion(mult = c(0.05, 0.05))) +
scale_y_continuous(breaks=data_countries_change_tot$value) +
scale_fill_manual(values=colours_custom) +
theme_wl() +
theme(legend.position="none",
axis.title = element_blank(),
panel.grid.major.x = element_blank(),
axis.text.x = element_text(vjust = 1),
plot.title = element_text(margin=margin(t=15)),
axis.text.y = element_blank(),
axis.ticks.y = element_blank()) +
# panel.grid.major.y = element_blank(),
# axis.ticks.y = element_blank(),
# axis.line.y = element_blank()) +
labs(title=countries,
subtitle=bquote(paste("Change in recent emissions (MtCO"[2], "e)")),
caption="⌂ UNEP Emissions Gap Report 2024    ⌂ Data: EDGARv9, Grassi et al. 2024 \n⌂ Note: GWP100 AR6; net land use change (LULUCF) emissions based on inventories") +
coord_cartesian(clip = "off")
y_range_scaling <- layer_scales(p1)$y$range$range
y_range_scaling <- diff(y_range_scaling) * 0.08
p1 <- p1 +
geom_text(aes(x=sector_lv2,y=ifelse(change_abs>0,end+y_range_scaling,end+y_range_scaling-change_abs),label=labels),
color="#636363",
size=3.5)
y_range_scaling_2 <- layer_scales(p1)$y$range$range
y_range_expanded <- y_range_scaling_2 + c(-0.001 * diff(y_range_scaling_2),0.001 * diff(y_range_scaling_2))
p2 <- data_countries_change_tot %>%
filter(year==data_countries_change_tot$year[2]) %>%
ggplot(.,aes(x=1.5,y=value,label=str_wrap(label,15))) +
geom_text(size=3.5,colour="#636363",hjust=0) +
geom_segment(aes(x = 1.4, xend = 1, yend = value),
arrow = arrow(length = unit(0.2, "cm")),
colour = "#636363") +
scale_y_continuous(limits = y_range_expanded) +
scale_x_continuous(limits = c(1,4.5),expand = expansion(mult = c(0, 0.05))) +
theme_wl_empty() +
coord_cartesian(clip = "off")
p3 <- data_countries_change_tot %>%
filter(year==data_countries_change_tot$year[1]) %>%
ggplot(.,aes(x=4,y=value,label=str_wrap(label,15))) +
geom_text(size=3.5,colour="#636363",hjust=1) +
geom_segment(aes(x = 4.1, xend = 4.5, yend = value),
arrow = arrow(length = unit(0.2, "cm")),
colour = "#636363") +
scale_y_continuous(limits = y_range_expanded) +
scale_x_continuous(limits = c(1,4.5),expand = expansion(mult = c(0.05, 0))) +
theme_wl_empty() +
coord_cartesian(clip = "off")
plot <- plot_spacer() + p3 + plot_spacer() + p1 + plot_spacer() + p2 + plot_layout(widths=c(-0.26,1,-0.26,6,-0.26,1))
plot
return(plot)
}
plot_country_change("European Union",2,data_countries_change)
## Filter to G20 countries
countries <- data_countries_change %>%
select(iso,country) %>%
distinct() %>%
left_join(.,read.csv("https://raw.githubusercontent.com/openclimatedata/countrygroups/main/data/g20.csv") %>%
select(iso=Code) %>%
mutate(G20="1")) %>%
filter(G20==1)
countries <- c(countries$country,"European Union")
for (i in 1:length(countries)){
plot <- plot_country_change(countries[i],2,data_countries_change)
ggsave(plot,filename = paste0("UNEP-EGR-2024-",countries[i],"-change.png"),
path = "results/standard/countries/",device = "png",height = 4,width=8,dpi=300)
ggsave(plot,filename = paste0("UNEP-EGR-2024-",countries[i],"-change.pdf"),
path = "results/standard/countries/",device = cairo_pdf,height = 4,width=8)
ggsave(plot,filename = paste0("UNEP-EGR-2024-",countries[i],"-change.svg"),
path = "results/standard/countries/",device = 'svg',height = 4,width=8)
}
## Save data
wb <- createWorkbook()
addWorksheet(wb,"info")
addWorksheet(wb,"data")
info = data.frame(a=c("Author","Contact","Data sources","See also"),
b=c("William F. Lamb",
"william.lamb@pik-potsdam.de",
"EDGARv9 (https://edgar.jrc.ec.europa.eu/report_2024); Grassi et al. 2024 (https://zenodo.org/records/7190601)",
"https://lambwf.github.io/UNEP-Gap-Report-2024-Chapter-2/"))
writeData(wb, sheet = "info",info,colNames = F, rowNames = F)
writeData(wb, sheet = "data",data_countries_change %>%
filter(year %in% c(max(data_countries_change$year),max(data_countries_change$year)-3)) %>%
mutate(units="MtCO2e (GWP100 AR6)") %>%
arrange(iso,country,year,sector_lv2),colNames = T, rowNames = F)
saveWorkbook(wb,paste0("results/standard/countries/UNEP-EGR-2024-country-change.xlsx"),overwrite=T)
## Aggregate emissions
data_countries_change <- data_edgar %>%
group_by(iso,country,sector_lv2,year) %>%
summarise(value=sum(value,na.rm=T)/1e6)
## Add land use change emissions
data_countries_luc <- read.xlsx('sources/not public/LULUCF NGHGI data for UNEP 2024.xlsx',startRow = 3) %>%
rename(category=LAND.CATEGORY,country=UNFCCC.country,iso=country.code) %>%
filter(category=="LULUCF net")
data_countries_luc <- gather(data_countries_luc,year,`Land use change (LULUCF)`,`2000`:`2023`) %>%
mutate(year=as.numeric(year)) %>%
filter(!is.na(iso)) %>%
select(iso,year,`Land use change (LULUCF)`)
data_countries_change <- data_countries_change %>%
spread(.,sector_lv2,value) %>%
left_join(.,data_countries_luc,by=join_by(iso,year)) %>%
gather(.,sector_lv2,value,-iso,-country,-year)
## Add Europe
data_countries_eu <- data_countries_change %>%
left_join(.,cc_EU,by="iso") %>%
filter(!is.na(EU)) %>%
mutate(iso="EU27",country="European Union") %>%
group_by(iso,country,sector_lv2,year) %>%
summarise(value=sum(value))
data_countries_change <- rbind(data_countries_change,data_countries_eu)
## Plot
plot_country_change <- function(countries,t,data_countries_change) {
## Filter
data_countries_change <- data_countries_change %>%
filter(country==countries) %>%
filter(year %in% c(max(data_countries_change$year),max(data_countries_change$year)-t))
## Calculate changes and rank
data_countries_change <- data_countries_change %>%
group_by(sector_lv2) %>%
mutate(change_abs=last(value)-first(value),
change_rel=change_abs/first(value))
# Re-arrange order of sectors so that net additions come first, net reductions last
data_countries_change_order <- data_countries_change %>%
ungroup() %>%
filter(year==max(data_countries_change$year)) %>%
arrange(desc(change_abs)) %>%
mutate(order=row_number()) %>%
select(sector_lv2,order)
data_countries_change <- left_join(data_countries_change,data_countries_change_order,by=join_by(sector_lv2)) %>%
arrange(order,year)
## Get totals
data_countries_change_tot <- data_countries_change %>%
group_by(year) %>%
summarise(value=sum(value,na.rm=T)) %>%
mutate(label=paste0("Emissions in ",year,": ",signif(value,3)))
## Arrange data for waterfall
data_countries_change <- data_countries_change  %>%
ungroup() %>%
filter(year==max(data_countries_change$year)-t) %>%
add_row(order=0,change_abs=data_countries_change_tot$value[1]) %>%
arrange(order) %>%
ungroup() %>%
mutate(end = cumsum(change_abs),
start = c(0, head(end, -1))) %>%
filter(order!=0)
## Arrange levels, add labels
data_countries_change$sector_lv2 <- gsub("\\| ","",data_countries_change$sector_lv2)
data_countries_change$sector_lv2 <- as.factor(data_countries_change$sector_lv2)
data_countries_change$sector_lv2 <- fct_reorder(data_countries_change$sector_lv2,data_countries_change$order)
colours_custom <- c(
"Energy Power" = "#17becfff",
"Energy Industry" = "#3a5e91ff",
"Energy Transport" = "#5185b5ff",
"Energy Buildings & other" = "#74a6d4ff",
"Energy Fuel production" = "#ff9055ff",
"Industrial processes" = "#e5b82cff",
"Agriculture" = "#4f8455ff",
"Land use change (LULUCF)" = "#7dd396ff",
"Waste" = "#818181ff")
data_countries_change <- data_countries_change %>%
mutate(labels=signif(change_abs,t)) %>%
mutate(labels=ifelse(labels>0,paste0("+",labels),labels))
## Plot
p1 <- data_countries_change %>%
ggplot(.,aes(fill = sector_lv2)) +
geom_rect(aes(x = sector_lv2,xmin = order - 0.2, xmax = order + 0.2, ymin = end, ymax = start),
color="#252525",linewidth=0.25) +
geom_segment(data=data_countries_change %>% filter(order!=max(data_countries_change$order)),
aes(x = order + 0.2, xend = order + 0.8,y = end, yend = end),
color = "#252525",linewidth=0.25) +
# geom_text(aes(x=sector_lv2,y=ifelse(change_abs>0,end+100,end+100-change_abs),label=labels),
#           color="#636363",
#           size=3.5) +
scale_x_discrete(labels = function(x) str_wrap(x, width = 10),expand = expansion(mult = c(0.05, 0.05))) +
scale_y_continuous(breaks=data_countries_change_tot$value) +
scale_fill_manual(values=colours_custom) +
theme_wl() +
theme(legend.position="none",
axis.title = element_blank(),
panel.grid.major.x = element_blank(),
axis.text.x = element_text(vjust = 1),
plot.title = element_text(margin=margin(t=15)),
axis.text.y = element_blank(),
axis.ticks.y = element_blank()) +
# panel.grid.major.y = element_blank(),
# axis.ticks.y = element_blank(),
# axis.line.y = element_blank()) +
labs(title=countries,
subtitle=bquote(paste("Change in recent emissions (MtCO"[2], "e)")),
caption="⌂ UNEP Emissions Gap Report 2024    ⌂ Data: EDGARv9, Grassi et al. 2024 \n⌂ Note: GWP100 AR6; net land use change (LULUCF) emissions based on inventories") +
coord_cartesian(clip = "off")
y_range_scaling <- layer_scales(p1)$y$range$range
y_range_scaling <- diff(y_range_scaling) * 0.08
p1 <- p1 +
geom_text(aes(x=sector_lv2,y=ifelse(change_abs>0,end+y_range_scaling,end+y_range_scaling-change_abs),label=labels),
color="#636363",
size=3.5)
y_range_scaling_2 <- layer_scales(p1)$y$range$range
y_range_expanded <- y_range_scaling_2 + c(-0.001 * diff(y_range_scaling_2),0.001 * diff(y_range_scaling_2))
p2 <- data_countries_change_tot %>%
filter(year==data_countries_change_tot$year[2]) %>%
ggplot(.,aes(x=1.5,y=value,label=str_wrap(label,15))) +
geom_text(size=3.5,colour="#636363",hjust=0) +
geom_segment(aes(x = 1.4, xend = 1, yend = value),
arrow = arrow(length = unit(0.2, "cm")),
colour = "#636363") +
scale_y_continuous(limits = y_range_expanded) +
scale_x_continuous(limits = c(1,4.5),expand = expansion(mult = c(0, 0.05))) +
theme_wl_empty() +
coord_cartesian(clip = "off")
p3 <- data_countries_change_tot %>%
filter(year==data_countries_change_tot$year[1]) %>%
ggplot(.,aes(x=4,y=value,label=str_wrap(label,15))) +
geom_text(size=3.5,colour="#636363",hjust=1) +
geom_segment(aes(x = 4.1, xend = 4.5, yend = value),
arrow = arrow(length = unit(0.2, "cm")),
colour = "#636363") +
scale_y_continuous(limits = y_range_expanded) +
scale_x_continuous(limits = c(1,4.5),expand = expansion(mult = c(0.05, 0))) +
theme_wl_empty() +
coord_cartesian(clip = "off")
plot <- plot_spacer() + p3 + plot_spacer() + p1 + plot_spacer() + p2 + plot_layout(widths=c(-0.26,1,-0.26,6,-0.26,1))
plot
return(plot)
}
plot_country_change("European Union",2,data_countries_change)
## Filter to G20 countries
countries <- data_countries_change %>%
select(iso,country) %>%
distinct() %>%
left_join(.,read.csv("https://raw.githubusercontent.com/openclimatedata/countrygroups/main/data/g20.csv") %>%
select(iso=Code) %>%
mutate(G20="1")) %>%
filter(G20==1)
countries <- c(countries$country,"European Union")
for (i in 1:length(countries)){
plot <- plot_country_change(countries[i],3,data_countries_change)
ggsave(plot,filename = paste0("UNEP-EGR-2024-",countries[i],"-change.png"),
path = "results/standard/countries/",device = "png",height = 4,width=8,dpi=300)
ggsave(plot,filename = paste0("UNEP-EGR-2024-",countries[i],"-change.pdf"),
path = "results/standard/countries/",device = cairo_pdf,height = 4,width=8)
ggsave(plot,filename = paste0("UNEP-EGR-2024-",countries[i],"-change.svg"),
path = "results/standard/countries/",device = 'svg',height = 4,width=8)
}
## Save data
wb <- createWorkbook()
addWorksheet(wb,"info")
addWorksheet(wb,"data")
info = data.frame(a=c("Author","Contact","Data sources","See also"),
b=c("William F. Lamb",
"william.lamb@pik-potsdam.de",
"EDGARv9 (https://edgar.jrc.ec.europa.eu/report_2024); Grassi et al. 2024 (https://zenodo.org/records/7190601)",
"https://lambwf.github.io/UNEP-Gap-Report-2024-Chapter-2/"))
writeData(wb, sheet = "info",info,colNames = F, rowNames = F)
writeData(wb, sheet = "data",data_countries_change %>%
filter(year %in% c(max(data_countries_change$year),max(data_countries_change$year)-3)) %>%
mutate(units="MtCO2e (GWP100 AR6)") %>%
arrange(iso,country,year,sector_lv2),colNames = T, rowNames = F)
saveWorkbook(wb,paste0("results/standard/countries/UNEP-EGR-2024-country-change.xlsx"),overwrite=T)
