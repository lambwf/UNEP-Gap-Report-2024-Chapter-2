"0",""
"0","wd_data <- rbind(wd_iea,wd_ember)"
"0",""
"0",""
"0","########## country harmonisation"
"0",""
"0","wd_data_isos <- wd_data %>% "
"0","  filter(!grepl(""OECD"",country)) %>% "
"0","  filter(!grepl(""Memo"",country)) %>% "
"0","  filter(!grepl(""Africa"",country)) %>% "
"0","  filter(!grepl(""Soviet Union"",country)) %>% "
"0","  ungroup() %>% "
"0","  select(country) %>% "
"0","  distinct() %>% "
"0","  mutate(iso=countrycode(country,""country.name"",""iso3c""))"
"2","Warnung:"
"2"," [38;5;232mThere was 1 warning in `mutate()`.[39m
[38;5;232m[36mi[38;5;232m In argument: `iso = countrycode(country, ""country.name"", ""iso3c"")`.[39m
Caused by warning in `countrycode_convert()`:
[33m![39m Some values were not matched unambiguously: CuraÃƒÂ§ao/Netherlands Antilles, Former Yugoslavia (if no detail), Kosovo, Middle East, Republic of Turkiye, World, World aviation bunkers, World marine bunkers
"
"0","wd_data <- left_join(wd_data,wd_data_isos,by = join_by(country))"
"0","wd_data <- wd_data %>% mutate(iso=ifelse(country==""World"",""WLD"",iso))"
"0",""
"0","wd_data_isos <- wd_data %>% "
"0","  ungroup() %>% "
"0","  select(iso) %>% "
"0","  distinct() %>% "
"0","  mutate(name=countrycode(iso,""iso3c"",""country.name"")) %>% "
"0","  mutate(name=ifelse(iso==""WLD"",""World"",name))"
"2","Warnung:"
"2"," [38;5;232mThere was 1 warning in `mutate()`.[39m
[38;5;232m[36mi[38;5;232m In argument: `name = countrycode(iso, ""iso3c"", ""country.name"")`.[39m
Caused by warning in `countrycode_convert()`:
[33m![39m Some values were not matched unambiguously: WLD
"
"0","wd_data <- left_join(wd_data,wd_data_isos)"
"1","[38;5;232mJoining with `by = join_by(iso)`[39m
"
"0","wd_data <- wd_data %>% "
"0","  mutate(country=name) %>% "
"0","  select(-name)"
"0",""
"0","########### merge EU"
"0",""
"0","cc_EU <- read.csv(""https://raw.githubusercontent.com/openclimatedata/countrygroups/main/data/european-union.csv"") %>% "
"0","  select(iso=Code) %>% "
"0","  mutate(EU=""EU27"")"
"0",""
"0","wd_data <- left_join(wd_data,cc_EU,by=""iso"")"
"0","wd_data <- wd_data %>% "
"0","  mutate(iso=ifelse(!is.na(EU),EU,iso)) %>% "
"0","  mutate(country=ifelse(!is.na(EU),EU,country))"
"0",""
"0","wd_data <- wd_data %>% "
"0","  group_by(country,iso,sector,category,units,year) %>% "
"0","  summarise(value=sum(value,na.rm=T))"
"1","[38;5;232m`summarise()` has grouped output by 'country', 'iso', 'sector', 'category', 'units'. You can override using the `.groups` argument.[39m
"
"0","########### get G20"
"0",""
"0","cc_G20 <- read.csv(""https://raw.githubusercontent.com/openclimatedata/countrygroups/main/data/g20.csv"") %>% "
"0","  select(iso=Code) %>% "
"0","  mutate(G20=""G20"")"
"0",""
"0","wd_data <- left_join(wd_data,cc_G20,by=""iso"")"
"0","wd_data <- wd_data %>% "
"0","  mutate(G20=ifelse(iso==""EU27"",""G20"",G20))"
"0",""
"0","########### choose countries"
"0",""
"0","wd_data <- wd_data %>% "
"0","  mutate(regions=ifelse(iso %in% c(""USA"",""CHN"",""IND"",""EU27"",""RUS"",""BRA""),country,NA)) %>% "
"0","  mutate(regions=ifelse(country==""World"",country,regions))"
"0",""
"0","# wd_data_g20 <- wd_data %>%"
"0","#   filter(G20==""G20"") %>%"
"0","#   filter(is.na(regions)) %>%"
"0","#   mutate(iso=""G20 (other)"") %>%"
"0","#   mutate(country=""G20 (other)"") %>%"
"0","#   mutate(regions=""G20 (other)"") %>%"
"0","#   group_by(iso,country,regions,sector,category,units,year) %>%"
"0","#   summarise(value=sum(value,na.rm=T))"
"0","# "
"0","# wd_data <- rbind(wd_data,wd_data_g20)"
"0",""
"0","wd_data <- wd_data %>% "
"0","  filter(!is.na(regions)) %>% "
"0","  select(country,iso,sector,category,units,year,value)"
"0",""
"0","blarg <- wd_data %>% filter(country==""World"") %>% filter(year==2019)"
"0",""
"0",""
"0","wd_data$country <- as.factor(wd_data$country)"
"0","#wd_data$country <- fct_relevel(wd_data$country,""World"",""China"",""United States"",""India"",""EU27"",""G20 (other)"")"
"0","wd_data$country <- fct_relevel(wd_data$country,""World"",""China"",""United States"",""India"",""EU27"",""Russia"",""Brazil"")"
"0",""
