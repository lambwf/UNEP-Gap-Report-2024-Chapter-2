"0",""
"0","## load EDGAR data (https://edgar.jrc.ec.europa.eu/dataset_ghg80)"
"0",""
"0","data_edgar_co2_ffi <- read.xlsx(""sources/IEA_EDGAR_CO2_1970_2022.xlsx"",sheet=2,startRow = 10)"
"0","data_edgar_co2_ffi <- gather(data_edgar_co2_ffi,year,value,Y_1970:Y_2022)"
"0","data_edgar_co2_ffi$year <- gsub(""Y_"","""",data_edgar_co2_ffi$year)"
"0","data_edgar_co2_ffi <- data_edgar_co2_ffi %>% "
"0","  select(iso=Country_code_A3,country=Name,code=ipcc_code_2006_for_standard_report,code_description=ipcc_code_2006_for_standard_report_name,gas=Substance,fossil_bio,year,value)"
"0",""
"0","data_edgar_ch4 <- read.xlsx(""sources/EDGAR_CH4_1970_2022.xlsx"",sheet=2,startRow = 10)"
"0","data_edgar_ch4 <- gather(data_edgar_ch4,year,value,Y_1970:Y_2022)"
"0","data_edgar_ch4$year <- gsub(""Y_"","""",data_edgar_ch4$year)"
"0","data_edgar_ch4 <- data_edgar_ch4 %>% "
"0","  select(iso=Country_code_A3,country=Name,code=ipcc_code_2006_for_standard_report,code_description=ipcc_code_2006_for_standard_report_name,gas=Substance,fossil_bio,year,value)"
"0",""
"0","data_edgar_n2o <- read.xlsx(""sources/EDGAR_N2O_1970_2022.xlsx"",sheet=2,startRow = 10)"
"0","data_edgar_n2o <- gather(data_edgar_n2o,year,value,Y_1970:Y_2022)"
"0","data_edgar_n2o$year <- gsub(""Y_"","""",data_edgar_n2o$year)"
"0","data_edgar_n2o <- data_edgar_n2o %>% "
"0","  select(iso=Country_code_A3,country=Name,code=ipcc_code_2006_for_standard_report,code_description=ipcc_code_2006_for_standard_report_name,gas=Substance,fossil_bio,year,value)"
"0",""
"0","data_edgar_fgas <- read.xlsx(""sources/EDGAR_F-gases_1990_2022.xlsx"",sheet=2,startRow = 10)"
"0","data_edgar_fgas <- gather(data_edgar_fgas,year,value,Y_1990:Y_2022)"
"0","data_edgar_fgas$year <- gsub(""Y_"","""",data_edgar_fgas$year)"
"0","data_edgar_fgas <- data_edgar_fgas %>% "
"0","  select(iso=Country_code_A3,country=Name,code=ipcc_code_2006_for_standard_report,code_description=ipcc_code_2006_for_standard_report_name,gas=Substance,fossil_bio,year,value)"
"0",""
"0","data_edgar <- rbind(data_edgar_co2_ffi,data_edgar_ch4)"
"0","data_edgar <- rbind(data_edgar,data_edgar_n2o)"
"0","data_edgar <- rbind(data_edgar,data_edgar_fgas)"
"0",""
"0",""
"0","## join GWPs and calculate CO2e"
"0",""
"0","gwps <- read.csv(""https://raw.githubusercontent.com/openclimatedata/globalwarmingpotentials/main/globalwarmingpotentials.csv"",skip = 9)"
"0",""
"0","data_edgar$gas <- gsub(""-"","""",data_edgar$gas)"
"0","data_edgar <- left_join(data_edgar,gwps %>% select(gas=Species,AR6GWP100)) %>% "
"0","  mutate(AR6GWP100=ifelse(gas==""CO2"",1,AR6GWP100))"
"1","[38;5;232mJoining with `by = join_by(gas)`[39m
"
"0","# check all gwps joined"
"0","check <- data_edgar %>% filter(is.na(AR6GWP100))"
"0","check <- data_edgar %>% select(gas,AR6GWP100) %>% distinct()"
"0",""
"0","data_edgar <- data_edgar %>% "
"0","  mutate(value_gwp=value*AR6GWP100)"
"0",""
"0",""
"0","# list_fgases <- data.frame(gas=unique(data_edgar$gas))"
"0","# list_fgases <- list_fgases %>% "
"0","#   mutate(group=ifelse(grepl(""CFC"",gas),""ODS F-gases"",NA)) %>% "
"0","#   mutate(group=ifelse(grepl(""HCFC"",gas),""ODS F-gases"",group)) %>% "
"0","#   mutate(group=ifelse(grepl(""HFC"",gas),""UNFCCC F-gases"",group)) %>% "
"0","#   mutate(group=ifelse(grepl(""Halon"",gas),""ODS F-gases"",group)) %>% "
"0","#   mutate(group=ifelse(grepl(""NF3"",gas),""UNFCCC F-gases"",group)) %>% "
"0","#   mutate(group=ifelse(grepl(""SF6"",gas),""UNFCCC F-gases"",group)) #%>% "
"0","#   mutate(group=ifelse(is.na(group),""UNFCCC F-gases"",group))"
"0",""
"0",""
"0","list_fgases <- data_edgar %>% "
"0","  select(gas) %>% "
"0","  distinct() %>% "
"0","  mutate(group=ifelse(gas==""CO2"",""CO2"",NA)) %>% "
"0","  mutate(group=ifelse(gas==""CH4"",""CH4"",group)) %>% "
"0","  mutate(group=ifelse(gas==""N2O"",""N2O"",group)) %>% "
"0","  mutate(group=ifelse(is.na(group),""Fgases"",group))"
"0",""
"0","data_edgar <- left_join(data_edgar,list_fgases,by=""gas"")"
"0","data_edgar <- data_edgar %>% "
"0","  mutate(gas=group) %>% "
"0","  group_by(iso,country,code,code_description,gas,year) %>% "
"0","  summarise(value=sum(value_gwp,na.rm=TRUE))"
"1","[38;5;232m`summarise()` has grouped output by 'iso', 'country', 'code', 'code_description', 'gas'. You can override using the `.groups` argument.[39m
"
"0","# check global totals"
"0","check <- data_edgar %>% filter(year==2022) %>% group_by(gas) %>% summarise(value=sum(value,na.rm=T))"
"0",""
"0",""
"0","### aggregate sectors"
"0",""
"0","write.xlsx(data_edgar %>% ungroup() %>% select(code,code_description) %>% distinct() %>% arrange(code),""cc_sectors.xlsx"")"
"0","data_edgar <- left_join(data_edgar,read.xlsx(""sources/cc_sectors.xlsx""))"
"1","[38;5;232mJoining with `by = join_by(code, code_description)`[39m
"
"0","data_edgar$gas <- as.factor(data_edgar$gas)"
"0","data_edgar$gas <- fct_relevel(data_edgar$gas,""CO2"",""CH4"",""N2O"",""Fgases"")"
"0",""
"0","data_edgar$sector <- as.factor(data_edgar$sector)"
"0","data_edgar$sector <- fct_reorder(data_edgar$sector,data_edgar$sector_order)"
"0",""
"0","data_edgar <- data_edgar %>% "
"0","  mutate(year=as.numeric(year)) %>% "
"0","  group_by(iso,country,sector,sector_codes,subsector,gas,year) %>% "
"0","  summarise(value=sum(value,na.rm=TRUE))"
"1","[38;5;232m`summarise()` has grouped output by 'iso', 'country', 'sector', 'sector_codes', 'subsector', 'gas'. You can override using the `.groups` argument.[39m
"
