"0",""
"0","country_iso=c(""CHN"")"
"0",""
"0","plot_country <- function(country_iso,data_edgar,data_indicators) {"
"0","  "
"0","  ## GHG emissions trend plot"
"0","  "
"0","  data_countries <- data_edgar %>% "
"0","    filter(iso==country_iso) %>% "
"0","    filter(year>=1990) %>% "
"0","    group_by(iso,country,sector,sector_codes,year) %>%"
"0","    summarise(value=sum(value,na.rm=TRUE)/1e3)"
"0","  "
"0","  my_colours <- more_set2_colors(length(unique(data_countries$sector)))"
"0","  "
"0","  p1 <- data_countries %>% ggplot(aes(x=year,y=value,fill=sector)) +"
"0","    geom_area(color=""#636363"") +"
"0","    theme_wl() +"
"0","    scale_fill_manual(values = my_colours) +"
"0","    ylab(""GHG Emissions (MtCO2e/year)"") +"
"0","    theme(axis.title.x = element_blank(),"
"0","          panel.grid.major.x = element_blank(),"
"0","          panel.border = element_blank(),"
"0","          axis.line.x=element_line(),"
"0","          axis.line.y=element_line(colour='#636363'),"
"0","          legend.position = ""none"",panel.background = element_blank())"
"0","  "
"0","  "
"0","  # data_countries_labels <- data_countries %>% "
"0","  #   group_by(year,sector) %>% "
"0","  #   summarise(value=sum(value,na.rm=TRUE))"
"0","  # data_countries_labels <- locate_shares(data_countries_labels,""sector"",2022)"
"0","  # data_countries_labels <- data_countries %>% "
"0","  #   filter(year==2022) %>% "
"0","  #   arrange(desc(sector)) %>% "
"0","  #   group_by(year) %>% "
"0","  #   mutate(cumsum=cumsum(value)) %>% "
"0","  #   ungroup() %>% "
"0","  #   mutate(position=value/2) %>% "
"0","  #   arrange(sector) %>% "
"0","  #   mutate(location=cumsum-position)"
"0","  "
"0","  # p2 <- data_countries_labels %>%"
"0","  #   ggplot(.,aes(x=1,y=location,label=str_wrap(sector,18),color=sector)) +"
"0","  #   geom_text_repel("
"0","  #     nudge_x      = 0.25,"
"0","  #     direction    = ""y"","
"0","  #     hjust        = 1,"
"0","  #     segment.size = 0.2,"
"0","  #     size=3.75"
"0","  #   ) +"
"0","  #   geom_blank(data=data_countries %>% filter(year==2022) %>% group_by(year) %>% summarise(value=sum(value)),inherit.aes=FALSE,aes(x=1,y=value)) +"
"0","  #   theme_wl() +"
"0","  #   #expand_limits(x = 0, y = 0) +"
"0","  #   scale_color_manual(values = my_colours) + "
"0","  #     theme(axis.title = element_blank(),"
"0","  #         panel.border = element_blank(),"
"0","  #         legend.position=""none"","
"0","  #         axis.text.x = element_blank(),"
"0","  #         axis.text.y = element_blank(),"
"0","  #         axis.ticks = element_blank(),"
"0","  #         panel.grid.major = element_blank(),"
"0","  #         plot.background = element_blank(),"
"0","  #         plot.margin = unit(c(0,0,0,0),""cm""))"
"0","  "
"0","  # labels <- data_countries_labels %>% "
"0","  #   select(sector) %>% "
"0","  #   distinct() %>% "
"0","  #   add_row(sector=""Energy"",.before=1) %>% "
"0","  #   mutate(position_b=1) %>% "
"0","  #   mutate(position_b=cumsum(position_b)) %>% "
"0","  #   mutate(sector=as.factor(sector))"
"0","  # "
"0","  # labels$sector <- fct_reorder(labels$sector,labels$position_b)"
"0","  # labels <- left_join(labels,data_countries_labels %>% select(sector,position_a=location))"
"0","  "
"0","  "
"0","  ## legend for the ghg trend plot"
"0","  "
"0","  labels <- data_countries %>% "
"0","    ungroup() %>% "
"0","    select(sector) %>% "
"0","    distinct() %>% "
"0","    add_row(sector=""Energy"",.before=1) %>% "
"0","    mutate(position_b=1) %>% "
"0","    mutate(position_b=cumsum(position_b)) %>% "
"0","    mutate(sector=as.factor(sector))"
"0","  "
"0","  labels$sector <- fct_reorder(labels$sector,labels$position_b)"
"0","  "
"0","  labels <- labels %>% "
"0","    mutate(label=as.character(sector)) %>% "
"0","    mutate(label=ifelse(label %in% c(""Power sector"",""Fossil production"",""Buildings"",""Transport"",""Industry""),paste0(""  "",label),label)) %>% "
"0","    arrange(desc(sector)) %>% "
"0","    mutate(position_b=1) %>% "
"0","    mutate(position_b=cumsum(position_b))"
"0","  "
"0","  p2 <- labels %>%  ggplot(.,aes(y=position_b,label=label)) +"
"0","    geom_point(aes(x=ifelse(sector %in% c(""Power sector"",""Fossil production"",""Transport"",""Buildings"",""Industry""),2,1.9),fill=sector),"
"0","               shape=22,size=3,color='#636363') +"
"0","    geom_text(hjust=0,aes(x=2.1),color='#636363',vjust=0.5) +"
"0","    theme_wl() +"
"0","    scale_color_manual(values = c(""white"",my_colours)) +"
"0","    scale_fill_manual(values = c(""white"",my_colours)) +"
"0","    scale_x_continuous(limits=c(1.9,4)) +"
"0","    theme(axis.title = element_blank(),"
"0","          panel.border = element_blank(),"
"0","          legend.position=""none"","
"0","          axis.text.x = element_blank(),"
"0","          axis.text.y = element_blank(),"
"0","          axis.ticks = element_blank(),"
"0","          panel.grid.major = element_blank(),"
"0","          plot.background = element_blank(),"
"0","          plot.margin = unit(c(0,0,0,0),""cm""))"
"0","  "
"0","  ## indicators plot"
"0","  "
"0","  p3 <- data_indicators %>% "
"0","    filter(iso==country_iso) %>% "
"0","    ggplot(.,aes(x=1,y=label,label=value)) +"
"0","    geom_text(size=10*(0.36),hjust=0,vjust=1,color='#636363')  +"
"0","    scale_y_discrete(labels = function(x) str_wrap(x, width = 20))+"
"0","    scale_x_continuous(limits=c(1,3)) +"
"0","    theme_wl()+"
"0","    theme(axis.title = element_blank(),"
"0","          axis.ticks = element_blank(),"
"0","          panel.background = element_blank(),"
"0","          panel.border = element_blank(),"
"0","          panel.grid = element_blank(),"
"0","          axis.text.x = element_blank(),"
"0","          axis.text.y = element_text(size=10))"
"0","  "
"0","  name <- countrycode(sourcevar = country_iso,origin=""iso3c"",""country.name"")"
"0","  "
"0","  p <- p1 + p2 + plot_spacer() + (p3 /plot_spacer() + plot_layout(heights=c(4,1))) + plot_layout(widths=c(4.5,2,0.1,2)) +"
"0","    plot_annotation(title=name,theme=theme_wl() + theme(plot.title=element_text(vjust=1,size=16),plot.background = element_rect(fill = NA, colour = '#636363', size = 0.5)))"
"0","  "
"0","  "
"0","  return(p)"
"0","  "
"0","  "
"0","  "
"0","}"
"0",""
