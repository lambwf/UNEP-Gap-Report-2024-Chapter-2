---
title: "UNEP-Gap-Report-2024-Global-Totals"
author: "William F. Lamb"
date: "16 5 2024"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```




``` {r figure_global_sectors,fig.width=8,fig.height=4, fig.path="results/",dev=c('png','pdf','svg')}

## GHG emissions trend plot

data_world <- data_ghg %>% 
  filter(iso!="EU27") %>% 
  filter(year>=1990) %>% 
  rename(sector=sector_tier_2) %>% 
  group_by(sector,year) %>%
  summarise(value=sum(value,na.rm=TRUE)/1e9)


## replace land use emissions
data_world <- data_world %>% 
  filter(sector!="LULUCF")
data_world <- rbind(data_world,data_gcb_co2_luc %>% 
                      filter(year>=1990) %>% 
                      filter(country=="Global") %>% 
                      select(year,value=mean) %>% 
                      mutate(sector="LULUCF") %>% 
                      mutate(year=as.numeric(year)) %>% 
                      mutate(sector=as.factor(sector)))


labels <- read.xlsx("sources/cc_sectors.xlsx",sheet=2)
labels <- labels %>% 
  arrange(desc(position)) %>% 
  mutate(position=1) %>% 
  mutate(position=cumsum(position))

labels$sector <- fct_reorder(labels$sector,labels$position)

my_colours <- labels %>% select(sector,colour)
my_colours$sector <- gsub("   ","",my_colours$sector)
my_colours <- left_join(data_world %>% 
                          ungroup() %>% 
                          select(sector) %>% 
                          distinct() %>% 
                          arrange(sector),my_colours)

p1 <- data_world %>% ggplot(aes(x=year,y=value,fill=sector)) +
  geom_area(color="#636363") +
  theme_wl() +
  scale_fill_manual(values = my_colours$colour) +
  ylab("GHG Emissions (MtCO2e/year)") +
  theme(axis.title.x = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.border = element_blank(),
        axis.line.x=element_line(colour='#636363'),
        axis.line.y=element_line(colour='#636363'),
        legend.position = "none",panel.background = element_blank())


p2 <- labels %>%  ggplot(.,aes(y=position,label=sector)) +
  geom_point(aes(x=ifelse(sector %in% c("Energy","Industrial processes","AFOLU","Waste & Other"),1.9,2),fill=sector),
             shape=22,size=3,color='#636363') +
  geom_text(hjust=0,aes(x=2.1),color='#636363',vjust=0.5) +
  theme_wl() +
  #scale_color_manual(values = c("white",'#636363','#636363','#636363','#636363','#636363','#636363','#636363','#636363','#636363','#636363')) +
  scale_fill_manual(values = c(labels$colour)) +
  scale_x_continuous(limits=c(1.9,4)) +
  theme(axis.title = element_blank(),
        panel.border = element_blank(),
        legend.position="none",
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        panel.grid.major = element_blank(),
        plot.background = element_blank(),
        plot.margin = unit(c(0,0,0,0),"cm"))

p1 + p2 + plot_layout(widths=c(4,2))

```
